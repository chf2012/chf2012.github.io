<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="软件应用,程序编程,r," />





  <link rel="alternate" href="/atom.xml" title="Jimmy那些事儿" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Rggplot2可视化手册

每一个图层都是按照ggplot对象的先后顺序绘制的；在覆盖的问题上，可参考该顺序">
<meta property="og:type" content="article">
<meta property="og:title" content="R_ggplot2_可视化手册">
<meta property="og:url" content="http://yoursite.com/2017/08/09/软件应用_程序编程/R/R_专题总结/R_ggplot2_可视化手册/index.html">
<meta property="og:site_name" content="Jimmy那些事儿">
<meta property="og:description" content="Rggplot2可视化手册

每一个图层都是按照ggplot对象的先后顺序绘制的；在覆盖的问题上，可参考该顺序">
<meta property="og:updated_time" content="2018-02-13T13:09:47.975Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R_ggplot2_可视化手册">
<meta name="twitter:description" content="Rggplot2可视化手册

每一个图层都是按照ggplot对象的先后顺序绘制的；在覆盖的问题上，可参考该顺序">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/08/09/软件应用_程序编程/R/R_专题总结/R_ggplot2_可视化手册/"/>





  <title> R_ggplot2_可视化手册 | Jimmy那些事儿 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jimmy那些事儿</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/09/软件应用_程序编程/R/R_专题总结/R_ggplot2_可视化手册/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Jimmy_Cai">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Jimmy那些事儿">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Jimmy那些事儿" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                R_ggplot2_可视化手册
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-09T00:00:00+08:00">
                2017-08-09
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新</span>
              
              <time title="更新" itemprop="dateModified" datetime="2018-02-13T21:09:47+08:00">
                2018-02-13
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/" itemprop="url" rel="index">
                    <span itemprop="name">软件应用</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/程序编程/" itemprop="url" rel="index">
                    <span itemprop="name">程序编程</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/程序编程/r/" itemprop="url" rel="index">
                    <span itemprop="name">r</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/08/09/软件应用_程序编程/R/R_专题总结/R_ggplot2_可视化手册/" class="leancloud_visitors" data-flag-title="R_ggplot2_可视化手册">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>R<em>ggplot2</em>可视化手册</strong></p>
<ul>
<li>每一个图层都是按照ggplot对象的先后顺序绘制的；在覆盖的问题上，可参考该顺序</li>
</ul>
<a id="more"></a>
<h1 id="输出图形"><a href="#输出图形" class="headerlink" title="输出图形"></a>输出图形</h1><blockquote>
<p>输出图形为PDF、矢量图、其他图形</p>
<p>width与height 默认单位为 英寸；</p>
</blockquote>
<ul>
<li><strong>ggsave(filename, plot=last_plot, device=NULL, path=NULL, scale=1, width=NA, height=NA, units=””, dpi=300, limitsize=TRUE,…)</strong> ：保存图形<ul>
<li>使用ggsave时无需打印ggplot对象，并且在创建过程中若出现错误也无需手动关闭设备</li>
</ul>
</li>
</ul>
<blockquote>
<p>filename : 保存的文件名</p>
<p>device ：使用的设备； 可为 <code>&quot;eps&quot;,&quot;ps&quot;,&quot;tex&quot;(pictex),&quot;pdf&quot;, &quot;jpeg&quot;, &quot;tiff&quot;, &quot;png&quot;, &quot;bmp&quot;, &quot;svg&quot;, &quot;wmf&quot;(windows only)</code></p>
<p>units = c(“in”, “cm”, “mm”) ：可选的单位；默认为 英寸(in)</p>
<p>limitsize= TRUE ：大小限制；若为TRUE，将不会保存大于50 $\times$50 英寸的图形</p>
</blockquote>
<ul>
<li><strong>使用传统方法调用时可能出现的问题</strong><ul>
<li>在使用某个脚本来创建图形的过程中抛出一个错误，则R可能无法执行到dev.off() ，并可能停留在设备pdf/png等仍然开启的状态。</li>
<li>当这种情况发生时，直到你手动调用dev.off() 之前，pdf/png文件将无法用程序正常打开</li>
</ul>
</li>
</ul>
<p><br></p>
<h2 id="PDF"><a href="#PDF" class="headerlink" title="PDF"></a>PDF</h2><ul>
<li>使用ggplot2的语法<code>ggsave()</code> ：保存使用ggplot() 创建的<strong>最后一幅</strong>图形<ul>
<li>ggsave无法用于创建多页图形</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point()</div><div class="line"></div><div class="line"><span class="comment">## 默认单位为英寸，但可以修改</span></div><div class="line">ggsave(<span class="string">"myplot.pdf"</span>, width=<span class="number">8</span>, height=<span class="number">8</span> ,units=<span class="string">"cm"</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>可能会出现字体无法匹配的情况，可通过添加 <code>useDingbats=FALSE</code> 来处理</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; pdf(<span class="string">""</span>, useDingbats=<span class="literal">FALSE</span>)</div><div class="line">&gt;</div><div class="line">&gt; ggsave(<span class="string">""</span>, useDingbats=<span class="literal">FALSE</span>)</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>打开设备 — 绘制图形 — 关闭图形设备（适用于R中大多数图形，包括ggplot2 和 lattice绘制的图形）    <ul>
<li>绘制多幅图形，希望每一幅占据一页</li>
</ul>
</li>
</ul>
<blockquote>
<p>对ggplot调用print，确保这段代码即使在一段脚本中也能调用</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 打开设备</span></div><div class="line">pdf(<span class="string">"myplot.pdf"</span>, width=<span class="number">4</span>, height=<span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="comment"># 绘制图形</span></div><div class="line">plot(mtcars$wt, mtcars$mpg)</div><div class="line">print(ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point() )  <span class="comment"># 对ggplot调用print，确保这段代码即使在一段脚本中也能调用</span></div><div class="line"></div><div class="line"><span class="comment"># 关闭设备</span></div><div class="line">dev.off()</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="矢量图"><a href="#矢量图" class="headerlink" title="矢量图"></a>矢量图</h2><ul>
<li><strong>eps &amp; svg格式</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 使用ggsave</span></div><div class="line">ggsave(<span class="string">"myplot.svg"</span>, width=, height=, units=<span class="string">""</span>)</div><div class="line"></div><div class="line"><span class="comment">## 常规方法</span></div><div class="line">svg(<span class="string">"myplot.svg"</span>, width=, height=)</div><div class="line">plot()</div><div class="line">dev.off()</div></pre></td></tr></table></figure>
<ul>
<li><strong>wmf</strong> : Windows图元文件<ul>
<li>不支持透明</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ggsave</span></div><div class="line">ggsave(<span class="string">"myplot.wmf"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 常规方法</span></div><div class="line">win.metafile(<span class="string">""</span>)</div><div class="line">plot();</div><div class="line">dev.off()</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="位图"><a href="#位图" class="headerlink" title="位图"></a>位图</h2><ul>
<li><strong>png / tiff</strong></li>
</ul>
<blockquote>
<p>默认单位为 <strong>像素</strong> ，默认的输出分辨率为72像素(pi)；这一分辨率适合在屏幕上显示，但在打印时会显得模糊；</p>
<ul>
<li>对于高质量的打印输出，分辨率至少应该在 300ppi</li>
</ul>
<p>使用ggsave()中的参数虽名为<code>dpi</code>， 但它实际上控制的是每英寸的像素数(pixels per inch ,ppi) ，而非每英寸的点数(dots per inch, dpi)。</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point()</div><div class="line">ggsave(<span class="string">"myplot.png"</span>, width=<span class="number">4</span>, height=<span class="number">4</span>, units=<span class="string">"cm"</span>, dpi=<span class="number">300</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">### 传统方法-----------------------------------------------------------</span></div><div class="line"><span class="comment"># 默认单位为 像素</span></div><div class="line">png(<span class="string">"filename.png"</span>, widht=<span class="number">400</span>, height=<span class="number">400</span>)</div><div class="line">plot()</div><div class="line">dev.off()</div><div class="line"></div><div class="line"><span class="comment"># 输出多幅图形，可在文件名后加入 %d</span></div><div class="line">png(<span class="string">"myplot-%d.png"</span>, widht=<span class="number">400</span>, height=<span class="number">400</span>)</div><div class="line">plot()</div><div class="line">print(ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point() )</div><div class="line">dev.off()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">## ----修改分辨率--------</span></div><div class="line">ppi &lt;- <span class="number">300</span></div><div class="line"></div><div class="line"><span class="comment"># 计算一幅4英寸 × 4英寸 300ppi图像的高度和宽度（以像素为单位）</span></div><div class="line">png(<span class="string">"myplot.png"</span>, width=<span class="number">4</span>*ppi, height=<span class="number">4</span>*ppi, res=ppi)</div><div class="line">plot(mtcars$wt, mtcars$mpg)</div><div class="line">dev.off()</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="图形的默认属性"><a href="#图形的默认属性" class="headerlink" title="图形的默认属性"></a>图形的默认属性</h2><table>
<thead>
<tr>
<th>参数</th>
<th>默认值</th>
<th>图形</th>
</tr>
</thead>
<tbody>
<tr>
<td>position =</td>
<td>“stack”</td>
<td>geom_histogram</td>
</tr>
<tr>
<td>position_dodge()</td>
<td>0.9</td>
<td></td>
</tr>
<tr>
<td>position =</td>
<td>“dodge”</td>
<td>geom_bar</td>
</tr>
<tr>
<td>width =</td>
<td>0.9</td>
<td>geom_bar</td>
</tr>
<tr>
<td>size =</td>
<td>5</td>
<td>geom_text</td>
</tr>
<tr>
<td>size =</td>
<td>2</td>
<td>geom_point</td>
</tr>
<tr>
<td>scales =</td>
<td>“fixed”</td>
<td>facet_grid</td>
</tr>
<tr>
<td>bins =</td>
<td>30</td>
<td>stat_bin2d</td>
</tr>
<tr>
<td>method =</td>
<td>loess</td>
<td>stat_smooth</td>
</tr>
<tr>
<td>level =</td>
<td>0.95</td>
<td>stat_smooth</td>
</tr>
</tbody>
</table>
<h3 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a>条形图</h3><ul>
<li>width =0.9</li>
<li>position = position_dodge(0.9)</li>
</ul>
<h3 id="文本标签"><a href="#文本标签" class="headerlink" title="文本标签"></a>文本标签</h3><ul>
<li>size = 0.9； size= rel(0.9)</li>
</ul>
<p><br></p>
<h1 id="描述数据分布"><a href="#描述数据分布" class="headerlink" title="描述数据分布"></a>描述数据分布</h1><h2 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h2><ul>
<li>geom_histogram()：映射一个连续变量到参数x</li>
</ul>
<blockquote>
<p><strong>bins = n</strong>；组的数量（即出现<strong>n条柱子</strong>）</p>
<p><strong>binwidth = n</strong> ；组距宽度，（看做分隔范围的大小；表示<strong>每个柱子的宽度</strong>）</p>
<p><strong>position = “stack”</strong> （默认）；位置调整</p>
<ul>
<li>position= “identity”  ：不做任何调整</li>
<li>position= “dodge” ：避免重叠，并列排放；</li>
</ul>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars, aes(x=wt)) + geom_histogram(bins=<span class="number">30</span>, binwidth=<span class="number">0.3</span>)</div><div class="line"><span class="comment"># bins=30 （默认）；</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分组直方图"><a href="#分组直方图" class="headerlink" title="分组直方图"></a>分组直方图</h3><blockquote>
<p>多组数据的直方图；geom_histogram()</p>
</blockquote>
<h4 id="分面-facet-grid-wrap"><a href="#分面-facet-grid-wrap" class="headerlink" title="分面 - facet_grid/wrap"></a>分面 - facet_grid/wrap</h4><ul>
<li><strong>faect_grid(smoke.~ , scales = “free”, position=)</strong></li>
</ul>
<blockquote>
<p><strong>smoke ~ .</strong> ：一列多行，根据变量smoke进行分面为n行</p>
<blockquote>
<p>. ~ a  # 一行多列，根据变量a进行分面为n列</p>
<p>a ~.   #  一列多行，根据变量a进行分面n行</p>
<p>a~b    # 多行多列</p>
<p>.~a+b / a+b~.  # 多个变量的多个水平在行/列上(或同时)</p>
</blockquote>
<p><strong>scales = “fixed”</strong> (默认) ； 标度控制；即所有面板中x/y标度相同</p>
<blockquote>
<p>scales = “free” ；x/y每个面板的标度都可以变化; 自由标度，用于发现更多的细节</p>
<p>scales = “free_x” / “free_y” </p>
</blockquote>
</blockquote>
<ul>
<li><strong>facet_wrap(~a, ncol=n)</strong><ul>
<li>处理<strong>单个多水平</strong>变量时更适用，因为可以自定义行列数；</li>
<li>此时结合 scales=”free” 更容易看出图形的趋势</li>
</ul>
</li>
</ul>
<blockquote>
<p>~ a, ncol=n</p>
<p>~a, nrow=n</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS) <span class="comment"># 为了使用数据</span></div><div class="line"></div><div class="line"><span class="comment"># 使用smoke作为分面变量</span></div><div class="line">ggplot(birthwt, aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>, color=<span class="string">"black"</span>) + facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<ul>
<li><strong>分面标签</strong>：分面绘图有一个问题：即分面标签只有0和1，且<strong>没有指明这个标签变量smoke的取值</strong>；因此需要<strong>修改标签</strong>，即修改<strong>因子水平的名称</strong>；<ol>
<li>列出现有的因子水平 <u>(因为分面没有指明这个标签的取值，重要)</u></li>
<li>依据相同的顺序赋予新的名字</li>
</ol>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">birthwt1 &lt;- birthwt  <span class="comment"># 复制一个数据副本</span></div><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke); levels(birthwt1$smoke);</div><div class="line"></div><div class="line"><span class="comment"># 依据相同的顺序赋予新的名字</span></div><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke, levels=c(<span class="string">"0"</span>,<span class="string">"1"</span>), labels=c(<span class="string">"No Smoke"</span>,<span class="string">"Smoke"</span>))</div><div class="line"><span class="comment">## 亦可以用 plyr::revalue 进行</span></div><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">birthwt1$smoke &lt;-revalue(birthwt1$smoke, c(<span class="string">"0"</span>=<span class="string">"No Smoke"</span>, <span class="string">"1"</span>=<span class="string">"Smoke"</span>))</div><div class="line"></div><div class="line"><span class="comment"># 重新作图</span></div><div class="line">ggplot(birthwt1, aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>, color=<span class="string">"black"</span>) + facet_grid(smoke~.)</div></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li><strong>分面y轴刻度</strong>：可选择根据不同面板自动调整标度；选择 <code>scales=&quot;free&quot;</code> <ul>
<li>可以<strong>单独设定分面y轴/x轴的标度</strong>；但这种设定根据分面的形式而有所不同<ol>
<li><code>smoke ~ .</code>  ：一列多行，此时x轴是固定的；此时 <code>scales=&quot;free&quot;</code>等价于<code>scales=&quot;free_y&quot;</code></li>
<li><code>. ~ smoke</code>：一行多列，此时y轴是固定的；此时 <code>scales=&quot;free&quot;</code>等价于<code>scales=&quot;free_x&quot;</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 因分面的形式为一行多列，故x轴是固定的；y轴标度自由变换</span></div><div class="line">ggplot(birthwt1, aes(x=bwt)) + geom_histogram(fill=<span class="string">"white"</span>, color=<span class="string">"black"</span>) + facet_grid(race~., scales=<span class="string">"free"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="分组-fill"><a href="#分组-fill" class="headerlink" title="分组 - fill"></a>分组 - fill</h4><blockquote>
<p>将分组变量映射给 <code>fill</code>；此处分组变量必须是 <strong><u>因子型 或 字符型</u></strong> 向量</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 因子化</span></div><div class="line">birthwt1$smoke &lt;- factor(birthwt1$smoke)</div><div class="line"></div><div class="line"><span class="comment"># 将smoke映射给fill，取消条形 [堆叠]，并使图形半透明</span></div><div class="line">ggplot(birthwt1, aes(x=bwt, fill=smoke)) + geom_histogram(position = <span class="string">"identity"</span>, alpha=<span class="number">0.4</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="密度曲线"><a href="#密度曲线" class="headerlink" title="密度曲线"></a>密度曲线</h2><blockquote>
<p>核密度曲线是基于样本数据对总体分布做出的一个估计。</p>
<p>曲线的光滑程度取决于核函数的带宽：<strong>带宽越大，曲线越光滑</strong>；</p>
</blockquote>
<ul>
<li><strong>geom_density()</strong>：映射一个连续变量到x；<ul>
<li>绘制的为封闭的多边形</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 绘制核密度曲线</span></div><div class="line">ggplot(faithful, aes(x=waiting)) + geom_density()</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="开放的密度曲线"><a href="#开放的密度曲线" class="headerlink" title="开放的密度曲线"></a>开放的密度曲线</h3><ul>
<li><strong>geom_line(stat=”identity”)</strong>：绘制<strong>没有两侧与底部线段</strong>的核密度曲线</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用 expand_limits() 函数扩大y轴范围以包含0点</span></div><div class="line"></div><div class="line">ggplot(faithful, aes(x=waiting)) + geom_line(stat=<span class="string">"identity"</span>) + expand_limits(y=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分组密度曲线"><a href="#分组密度曲线" class="headerlink" title="分组密度曲线"></a>分组密度曲线</h3><p><br></p>
<p><br></p>
<h2 id="频数多边形"><a href="#频数多边形" class="headerlink" title="频数多边形"></a>频数多边形</h2><blockquote>
<p>频数多边形传递的信息类似直方图</p>
</blockquote>
<ul>
<li>geom_freqploy()</li>
</ul>
<blockquote>
<p>binwidth= n ；设定每组的组距（即宽度）</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 通过binwidth参数控制频数多边形的组距</span></div><div class="line">ggplot(faithful, aes(x=waiting)) + geom_freqploy(binwidth=<span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="comment"># 通过直接设定每组组距将数据dx轴范围切分为特定数据的组</span></div><div class="line">binsize &lt;- diff(range(faithful$waiting))/<span class="number">15</span></div><div class="line">ggplot(faithful, aes(x=waiting)) + geom_freqpoly(binwith = binsize)</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="箱线图"><a href="#箱线图" class="headerlink" title="箱线图"></a>箱线图</h2><ul>
<li>geom_boxplot()：分别映射<strong>一个连续型变量</strong> 和 <strong>一个离散型变量</strong>到 y 和 x ；<ul>
<li>绘制单组数据的箱线图时，必须给x参数映射一个特定的取值；可以将其设为1</li>
</ul>
</li>
</ul>
<blockquote>
<p>width = ；修改箱线图的宽度</p>
<p>outlier.size = ；设置异常值的大小</p>
<p>outlier.shape = ；设置异常值的形状</p>
<p>notch= TRUE ； 显示槽口（<u>槽口(notch)的目的是易于比较各组数据的<strong>中位数</strong>的差异</u>；）</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS) <span class="comment"># 为了使用数据</span></div><div class="line"></div><div class="line"><span class="comment"># 使用factor将数值型变量转为离散型</span></div><div class="line">ggplot(birthwt, aes(x=factor(race), y=bwt)) + geom_boxplot()</div><div class="line"></div><div class="line"><span class="comment"># 绘制单组数据箱线图，可令x=1</span></div><div class="line">ggplot(birthwt, aes(x=<span class="number">1</span>, y=bwt)) + geom_boxplot() + scale_x_continuous(breaks =<span class="literal">NULL</span>) + theme(axis.title.x=element_blank())</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="添加均值"><a href="#添加均值" class="headerlink" title="添加均值"></a>添加均值</h3><ul>
<li>stat_summary()：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS) <span class="comment"># 为了使用数据</span></div><div class="line">ggplot(birthwt, aes(x=factor(race), y=bwt)) + geom_boxplot() </div><div class="line">+ stat_summary(fun.y=<span class="string">"mean"</span>, geom=<span class="string">"point"</span>, shape = <span class="number">23</span>, size = <span class="number">3</span>, fill = <span class="string">"white"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h1 id="常规图形"><a href="#常规图形" class="headerlink" title="常规图形"></a>常规图形</h1><blockquote>
<p>条形图、折线图、面积图、散点图</p>
</blockquote>
<h2 id="条形图-1"><a href="#条形图-1" class="headerlink" title="条形图"></a>条形图</h2><ul>
<li><p><strong>geom_bar(stat=”identity”)</strong> ：一列数据表示条形在x轴上的位置，另一列数据表示每个条形在y轴上对应的高度</p>
<ul>
<li>当x为连续型变量，通过factor() 转为离散型变量</li>
</ul>
<blockquote>
<p>当x是连续型（数值型）变量时，ggplot不是只在实际取值处绘制条形，而是将在x轴上结余最大值和最小值之间所有可能的取值处绘制条形</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>fill = ； 条形的填充色</p>
<p>color =  ；添加并框线，并指定颜色</p>
<p>size = ；用来控制边框线宽度的参数，单位是毫米；（当设定了边框线颜色color）</p>
<p>position = “” </p>
<blockquote>
<p>stack - 堆叠；fill - 堆叠并标准化为1； dodge - 分组条形图； jitter - 扰动； identity - 不做调整</p>
</blockquote>
<p>width= ；条形的宽度</p>
<blockquote>
<p>最大宽度为1</p>
<p>簇状条形图组内的条形间距为0</p>
</blockquote>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(pg_mean, aes(group, weight)) + geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-簇状条形图"><a href="#条形图-簇状条形图" class="headerlink" title="条形图 - 簇状条形图"></a>条形图 - 簇状条形图</h3><blockquote>
<p>并排展示的条形图；</p>
<p>若分类变量个水平的组合中有确实项，绘图的条形会略去不进行绘制，并将条形自动扩充到相应的位置（即宽度变宽）</p>
</blockquote>
<ul>
<li>将<strong>分类变量映射到fill，并运行geom_bar(position=”dodge”)</strong></li>
</ul>
<blockquote>
<p>position=”dodge” 是默认参数0.9的position_dodge()的缩写；即默认组间宽度为0.9</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp, ase(Date, Weight, fill=Cultivar)) + </div><div class="line">	geom_bar(position=<span class="string">"dodge"</span>, stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-频数"><a href="#条形图-频数" class="headerlink" title="条形图 - 频数"></a>条形图 - 频数</h3><ul>
<li>geom_bar()，同时不映射任何变量到y参数<ul>
<li>当x为连续变量时，会得到一张直方图</li>
</ul>
</li>
</ul>
<blockquote>
<p>stat = “bin” （默认）；该操作会自动计算每组变量对应的频数</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ggplot(diamonds, aes(cut)) + geom_bar()</div><div class="line"><span class="comment"># 等价于使用 geom_bar(stat="bin")</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-正负分别着色"><a href="#条形图-正负分别着色" class="headerlink" title="条形图 - 正负分别着色"></a>条形图 - 正负分别着色</h3><ul>
<li>创建一个对取值正负情况进行标识的变量pos</li>
<li>将该变量作为映射给fill</li>
<li>通过<strong>scale_fill_manual(values=c(), guide=FALSE)</strong> ：指定正负条形图的颜色，去掉图示</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">csub &lt;- subset(climate, Source==<span class="string">"Berkely"</span> &amp; Year &gt;= <span class="number">1900</span>)</div><div class="line">cusb$pos &lt;- cusb$Anomaly10y &gt;= <span class="number">0</span> <span class="comment"># 创建一个标识变量</span></div><div class="line"></div><div class="line"><span class="comment"># 将该变量映射给分组变量fill</span></div><div class="line">ggplot(csub, aes(Year, Anomaly10y, fill=pos)) + </div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>, position=<span class="string">"identity"</span>)  <span class="comment"># 令position="identity" 可以避免系统因对负值绘制堆积条形图而发出警告信息</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-宽度与间距"><a href="#条形图-宽度与间距" class="headerlink" title="条形图 - 宽度与间距"></a>条形图 - 宽度与间距</h3><ul>
<li>通过geom_bar()的<strong>width</strong> 控制条形的宽度<ul>
<li>运行geom_bar(width=0.9)时，每组条形将在x轴上占据0.9个单位宽度</li>
<li>运行position_dodge(width=0.9)时，会自动调整图形位置，使每个条形的中心恰好位于当每组条形宽度为0.9，且组内条形紧贴在一起时的位置</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>width=0.9 (默认)</strong>；较窄的可设为0.5；最大宽度为1</p>
<p>簇状条形图组内的条形间距为0；若希望增加<strong>组内条形的间距</strong></p>
<blockquote>
<ol>
<li><strong>将widht 设定的小一点</strong></li>
<li><strong>并令 position_dodge的取值大于 width</strong>； position_dodge(width=0.9) 默认</li>
</ol>
</blockquote>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 簇状条形图 - 组内间距</span></div><div class="line">ggplot(cabbage_exp, aes(Date, Weight, fill=Cultivar)) + </div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>, width=<span class="number">0.5</span>, position=position_dodge(<span class="number">0.7</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-堆积条形图"><a href="#条形图-堆积条形图" class="headerlink" title="条形图 - 堆积条形图"></a>条形图 - 堆积条形图</h3><ul>
<li>使用geom_bar() ，并映射一个变量给填充色参数fill<ul>
<li>通过<strong>guides调整图例顺序</strong></li>
<li>通过<strong>order=desc() 来调整堆叠顺序</strong></li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ggplot(cabbage_exp, aes(Date, Weight, fill=Cultivar))  + </div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>) + </div><div class="line">	gudies(fill=guide_legend(reverse=<span class="literal">TRUE</span>))  <span class="comment"># 调整图例顺序</span></div><div class="line"></div><div class="line">ggplot(cabbage_exp, aes(Date, Weight, fill=Cultivar, order=desc(Cultivar)))  +  <span class="comment"># 调整堆叠顺序</span></div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="条形图-百分比堆积条形图"><a href="#条形图-百分比堆积条形图" class="headerlink" title="条形图 - 百分比堆积条形图"></a>条形图 - 百分比堆积条形图</h3><ul>
<li>先对每组条形对应的数据标准化为100%格式； ddply() 、 transform()</li>
<li>对之后的结果绘制堆积条形图</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ce &lt;- ddply(cabbage_exp, <span class="string">"Date"</span>, transform, percent_weight=Weight/sum(Weight)*<span class="number">100</span>)  <span class="comment"># ddply 根据指定的变量Date进行分组，并对各组执行transfrom操作</span></div><div class="line">ggplot(ce, aes(Date, percent_weight, fill=Cultivar)) + geom_bar(stat=<span class="string">"identity"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Cleveland图"><a href="#Cleveland图" class="headerlink" title="Cleveland图"></a>Cleveland图</h3><blockquote>
<p>使用Cleveland点图来替代条形图以减少图形造成的视觉混乱并使图形更具可读性</p>
</blockquote>
<ul>
<li><strong>geom_point()</strong><ul>
<li><strong>通过reorder()：实现排列的自定义</strong><ul>
<li><code>reorder(name,avg)</code> ：该命令会<strong>先将name转化为因子，然后根据avg对其进行排序</strong></li>
<li>为了使图形效果更好，可删除垂直网格线，并将水平网格线改为虚线</li>
</ul>
</li>
<li>涉及根据两个及以上变量进行分组与排序时，只能分步实现</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">tophit &lt;- tophitters2001[<span class="number">1</span>:<span class="number">25</span>, ]  <span class="comment"># 取出前25个数据</span></div><div class="line">ggplot(tophit, aes(x=avg, y=name)) + geom_ponit()</div><div class="line"></div><div class="line"><span class="comment"># 调整因子顺序，并调整外观</span></div><div class="line">ggplot(tophit, aes(x=avg, y=reorder(name, avg))) + </div><div class="line">	geom_point(size=<span class="number">3</span>) + theme_bw() + </div><div class="line">	theme(panel.grid.major.x=element_blank(), panel.grid.minor.x=element_blank(),panel.gird.major.y=element_line(color=<span class="string">"grey60"</span>, linetype=<span class="string">"dashed"</span>))</div></pre></td></tr></table></figure>
<ul>
<li><strong>geom_segment()：绘制数据点为端点的线段；</strong><ul>
<li>需要设定x /y /xend /yend 四个参数</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(tophit, aes(x=avg,y=name)) + </div><div class="line">	geom_segment(aes(yend=name, xend=<span class="number">0</span>, color=<span class="string">"grey50"</span>)) + </div><div class="line">	geom_point(size=<span class="number">3</span>, aes(color=lg)) + </div><div class="line">	scale_color_brewer(palette=<span class="string">"Set1"</span>, limits=c(<span class="string">"NL"</span>,<span class="string">"AL"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="环状图形"><a href="#环状图形" class="headerlink" title="环状图形"></a>环状图形</h2><blockquote>
<p><strong>饼图实际上就是柱状图，只不过是使用极坐标而已，柱状图的高度，对应于饼图的弧度</strong></p>
</blockquote>
<ul>
<li><strong>coord_polar(theta = “x”, start = 0, direction = 1)： 非笛卡尔坐标；</strong>使用环形图<ul>
<li>根据<strong>数据源的不同</strong>有不同的做法：<ul>
<li>长格式，<strong>映射的为列中某个变量的频数</strong>；</li>
<li>宽格式，映射为<strong>某个列中具体的值</strong>（同Excel，具体的值已经经过计算）</li>
</ul>
</li>
<li>先制作堆积条形图（1. 堆积条形图； 2. 簇状条形图）</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>theta</strong>： variable to map angle to (x or y)<br><strong>start</strong>：offset of starting point from 12 o’clock in radians<br><strong>direction</strong>, 1, clockwise; -1, anticlockwise</p>
</blockquote>
<ol>
<li><strong>长格式</strong></li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 数据源为长格式，y值为cyl列的频数，而非cyl中列的值</span></div><div class="line"><span class="comment"># 堆叠条形图</span></div><div class="line">pie &lt;- ggplot(mtcars, aes(x = factor(<span class="number">1</span>), fill = factor(cyl))) +  <span class="comment"># factor(1) 表示将y分为1组</span></div><div class="line"> geom_bar(width = <span class="number">1</span>)   <span class="comment"># width&gt;=1，中心的白点会去掉</span></div><div class="line">pie + coord_polar(theta = <span class="string">"y"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 簇状条形图</span></div><div class="line">cxc &lt;- ggplot(mtcars, aes(x = factor(cyl))) +</div><div class="line">  geom_bar(width = <span class="number">1</span>, colour = <span class="string">"black"</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>geom_bar() 中 <strong>width&gt;=1，中心的白点会去掉</strong></p>
</blockquote>
<ol>
<li><strong>宽格式</strong><ul>
<li>ggplot(x=””)  ；x为空，并且不要指定group</li>
<li>若x = colname ，饼图的长度（离圆心的距离）会根据比例不同而不同</li>
</ul>
</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">df &lt;- data.frame(</div><div class="line">  variable = c(<span class="string">"does not resemble"</span>, <span class="string">"resembles"</span>),</div><div class="line">  value = c(<span class="number">20</span>, <span class="number">80</span>)</div><div class="line">);df</div><div class="line"></div><div class="line">           variable value</div><div class="line"><span class="number">1</span> does not resemble    <span class="number">20</span></div><div class="line"><span class="number">2</span>         resembles    <span class="number">80</span></div><div class="line"></div><div class="line">ggplot(df, aes(x = <span class="string">""</span>, y = value, fill = variable)) +  <span class="comment"># x为空，y为具体的值，fill为填充色变量  [x必须为空格，即作为分组变量；使之堆叠在一个系列上]</span></div><div class="line">  geom_bar(stat=<span class="string">"identity"</span>,width = <span class="number">1</span>) +</div><div class="line">  scale_fill_manual(values = c(<span class="string">"red"</span>, <span class="string">"yellow"</span>)) +</div><div class="line">  coord_polar(<span class="string">"y"</span>) +</div><div class="line">  labs(title = <span class="string">"Pac man"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ coord_polar(theta=<span class="string">"x"</span>, direction=<span class="number">1</span>, start=<span class="number">0</span> ) <span class="comment"># 绘制饼图/雷达图</span></div><div class="line"><span class="comment"># direction= 1，顺时针，-1，逆时针   start=0 12点钟弧度的起点偏移量</span></div><div class="line"></div><div class="line"><span class="comment"># 地图投影</span></div><div class="line"><span class="keyword">library</span>(mapproj)</div><div class="line">coord_map</div><div class="line"></div><div class="line"><span class="comment"># 环形图</span></div><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(wind, aes(x=DirCat, fill=SpeedCat)) + </div><div class="line">	geom_histogram(binwidth=<span class="number">5</span>, origin=-<span class="number">7.5</span>) + </div><div class="line">	coord_polar() + scale_x_continuous(limits=c(<span class="number">0</span>,<span class="number">360</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="原始图形"><a href="#原始图形" class="headerlink" title="原始图形"></a>原始图形</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) + </div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>) + </div><div class="line">  coord_polar(theta = <span class="string">"y"</span>)   <span class="comment">## 把柱状图折叠成饼图（极坐标）</span></div><div class="line">p</div></pre></td></tr></table></figure>
<h3 id="去除饼图中心的杂点"><a href="#去除饼图中心的杂点" class="headerlink" title="去除饼图中心的杂点"></a>去除饼图中心的杂点</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) + </div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">1</span>) +    <span class="comment">## width &gt;= 1 时中心的杂点将消失</span></div><div class="line">  coord_polar(theta = <span class="string">"y"</span>)   </div><div class="line">p</div></pre></td></tr></table></figure>
<h3 id="去除饼图旁边的标签、刻度须线"><a href="#去除饼图旁边的标签、刻度须线" class="headerlink" title="去除饼图旁边的标签、刻度须线"></a>去除饼图旁边的标签、刻度须线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">theme(axis.ticks = element_blank())   <span class="comment">## 把左上角多出来的“小胡子”去掉</span></div></pre></td></tr></table></figure>
<h3 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 去掉图例的标题，并将图例放到上面</span></div><div class="line">+ theme(legend.title = element_blank(), legend.position = <span class="string">"top"</span>)   <span class="comment">## 将图例标题设为空，并把土方放在上方</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 对图例的标签加上百分比</span></div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line"></div><div class="line">myLabel = as.vector(dt$B)   <span class="comment">## 转成向量，否则图例的标签可能与实际顺序不一致</span></div><div class="line">myLabel = paste(myLabel, <span class="string">"("</span>, round(dt$A / sum(dt$A) * <span class="number">100</span>, <span class="number">2</span>), <span class="string">"%)        "</span>, sep = <span class="string">""</span>)   <span class="comment">## 用 round() 对结果保留两位小数</span></div><div class="line"></div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) + </div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">1</span>) +    </div><div class="line">  coord_polar(theta = <span class="string">"y"</span>) + </div><div class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">  theme(axis.ticks = element_blank()) + </div><div class="line">  theme(legend.title = element_blank(), legend.position = <span class="string">"top"</span>) + </div><div class="line">  scale_fill_discrete(breaks = dt$B, labels = myLabel)   <span class="comment">## 将原来的图例标签换成现在的myLabel</span></div><div class="line">p</div></pre></td></tr></table></figure>
<h3 id="按顺时针从大到小的顺序显示"><a href="#按顺时针从大到小的顺序显示" class="headerlink" title="按顺时针从大到小的顺序显示"></a>按顺时针从大到小的顺序显示</h3><ul>
<li><strong>数据源的排列顺序，需要与因子的顺序相同 或者 逆序排列</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line"></div><div class="line">dt = dt[order(dt$A, decreasing = <span class="literal">TRUE</span>),]   <span class="comment">## 用 order() 让数据框的数据按 A 列数据从大到小排序</span></div><div class="line"></div><div class="line"><span class="comment"># &gt; levels(dt$B)</span></div><div class="line"><span class="comment"># [1] "A" "B" "C" "D" "E"   </span></div><div class="line">   A B</div><div class="line"> <span class="number">10</span> D</div><div class="line">  <span class="number">7</span> A</div><div class="line">  <span class="number">4</span> C</div><div class="line">  <span class="number">2</span> B</div><div class="line">  <span class="number">1</span> E</div><div class="line"></div><div class="line">myLabel = as.vector(dt$B)   </div><div class="line">myLabel = paste(myLabel, <span class="string">"("</span>, round(dt$A / sum(dt$A) * <span class="number">100</span>, <span class="number">2</span>), <span class="string">"%)        "</span>, sep = <span class="string">""</span>)   </div><div class="line"></div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) + </div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">1</span>) +    </div><div class="line">  coord_polar(theta = <span class="string">"y"</span>) + </div><div class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">  theme(axis.ticks = element_blank()) + </div><div class="line">  theme(legend.title = element_blank(), legend.position = <span class="string">"top"</span>) + </div><div class="line">  scale_fill_discrete(breaks = dt$B, labels = myLabel)   </div><div class="line">p</div></pre></td></tr></table></figure>
<h3 id="去掉白色外框上的数字"><a href="#去掉白色外框上的数字" class="headerlink" title="去掉白色外框上的数字"></a>去掉白色外框上的数字</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ theme(axis.text.x = element_blank())   <span class="comment">## 白色的外框即是原柱状图的X轴，把X轴的刻度文字去掉即可</span></div></pre></td></tr></table></figure>
<h3 id="在图中加百分比"><a href="#在图中加百分比" class="headerlink" title="在图中加百分比"></a>在图中加百分比</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line"></div><div class="line">dt = dt[order(dt$A, decreasing = <span class="literal">TRUE</span>),]</div><div class="line">myLabel = as.vector(dt$B)   </div><div class="line">myLabel = paste(myLabel, <span class="string">"("</span>, round(dt$A / sum(dt$A) * <span class="number">100</span>, <span class="number">2</span>), <span class="string">"%)"</span>, sep = <span class="string">""</span>)   </div><div class="line"></div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) +</div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">1</span>) +    </div><div class="line">  coord_polar(theta = <span class="string">"y"</span>) + </div><div class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">  theme(axis.ticks = element_blank()) + </div><div class="line">  theme(legend.title = element_blank(), legend.position = <span class="string">"top"</span>) + </div><div class="line">  scale_fill_discrete(breaks = dt$B, labels = myLabel) + </div><div class="line">  theme(axis.text.x = element_blank()) + </div><div class="line">  geom_text(aes(y = A/<span class="number">2</span> + c(<span class="number">0</span>, cumsum(A)[-length(A)]), x = sum(A)/<span class="number">20</span>, label = myLabel), size = <span class="number">5</span>) <span class="comment"># 在图中加上百分比：</span></div><div class="line"><span class="comment">## x 调节标签到圆心的距离, y 调节标签的左右位置</span></div><div class="line"></div><div class="line"><span class="comment"># cunsum(A) 累计和 </span></div><div class="line"><span class="comment"># [-length(A)]  删除最后一个元素</span></div><div class="line"><span class="comment"># sum(A)=24  /20 =1.2</span></div><div class="line">p</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分面"><a href="#分面" class="headerlink" title="分面"></a>分面</h3><ul>
<li>在ggplot(aes()) 中不要指定group，其他正常即可。</li>
</ul>
<p><br></p>
<h3 id="生成饼环"><a href="#生成饼环" class="headerlink" title="生成饼环"></a>生成饼环</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> +   geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">0.2</span>) +    <span class="comment">## 当width &lt; 1 时饼图将变成饼环  </span></div><div class="line"></div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">dt = data.frame(A = c(<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>), B = c(<span class="string">'B'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>))</div><div class="line"></div><div class="line">dt = dt[order(dt$A, decreasing = <span class="literal">TRUE</span>),]</div><div class="line">myLabel = as.vector(dt$B)   </div><div class="line">myLabel = paste(myLabel, <span class="string">"("</span>, round(dt$A / sum(dt$A) * <span class="number">100</span>, <span class="number">2</span>), <span class="string">"%)"</span>, sep = <span class="string">""</span>)   </div><div class="line"></div><div class="line">p = ggplot(dt, aes(x = <span class="string">""</span>, y = A, fill = B)) +</div><div class="line">  geom_bar(stat = <span class="string">"identity"</span>, width = <span class="number">0.2</span>) +    <span class="comment">## 当width &lt; 1 时饼图将变成饼环   </span></div><div class="line">  coord_polar(theta = <span class="string">"y"</span>) + </div><div class="line">  theme_bw() + </div><div class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">  theme(axis.ticks = element_blank()) + </div><div class="line">  theme(legend.position = <span class="string">"none"</span>) + </div><div class="line">  theme(axis.text.x = element_blank()) + </div><div class="line">  geom_text(aes(y = A/<span class="number">2</span> + c(<span class="number">0</span>, cumsum(A)[-length(A)]), x = sum(A)/<span class="number">24.5</span>, label = myLabel), size = <span class="number">5</span>) </div><div class="line">p</div></pre></td></tr></table></figure>
<h3 id="去掉饼环之外的框框和中间的坐标线"><a href="#去掉饼环之外的框框和中间的坐标线" class="headerlink" title="去掉饼环之外的框框和中间的坐标线"></a>去掉饼环之外的框框和中间的坐标线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">theme(panel.grid=element_blank()) +    <span class="comment">## 去掉白色圆框和中间的坐标线</span></div><div class="line">theme(panel.border=element_blank())   <span class="comment">## 去掉最外层正方形的框框</span></div></pre></td></tr></table></figure>
<h3 id="饼环-geom-rect"><a href="#饼环-geom-rect" class="headerlink" title="饼环 - geom_rect()"></a>饼环 - geom_rect()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line"></div><div class="line">ad = data.frame(type = c(<span class="string">"Poster"</span>, <span class="string">"Billboard"</span>, <span class="string">"Bus"</span>, <span class="string">"Digital"</span>),n = c(<span class="number">529</span>, <span class="number">356</span>, <span class="number">59</span>, <span class="number">81</span>))</div><div class="line">ad$fraction = ad$n / sum(ad$n)</div><div class="line">ad$ymax = cumsum(ad$fraction)</div><div class="line">ad$ymin = c(<span class="number">0</span>, head(ad$ymax, n = -<span class="number">1</span>))</div><div class="line"></div><div class="line">ggplot(data = ad, aes(fill = type, ymax = ymax, ymin = ymin, xmax = <span class="number">4</span>, xmin = <span class="number">3</span>)) +</div><div class="line">  geom_rect(colour = <span class="string">"grey30"</span>, show_guide = <span class="literal">FALSE</span>) +</div><div class="line">  coord_polar(theta = <span class="string">"y"</span>) +</div><div class="line">  labs(x = <span class="string">""</span>, y = <span class="string">""</span>, title = <span class="string">""</span>) + </div><div class="line">  xlim(c(<span class="number">0</span>, <span class="number">4</span>)) +</div><div class="line">  theme_bw() +</div><div class="line">  theme(panel.grid=element_blank()) + <span class="comment">## 去掉白色外框</span></div><div class="line">  theme(axis.text=element_blank()) + <span class="comment">## 把图旁边的标签去掉</span></div><div class="line">  theme(axis.ticks=element_blank()) + <span class="comment">## 去掉左上角的坐标刻度线</span></div><div class="line">  theme(panel.border=element_blank()) + <span class="comment">## 去掉最外层的正方形边框</span></div><div class="line">  geom_text(aes(x = <span class="number">3.5</span>, y = ((ymin+ymax)/<span class="number">2</span>), label = type))</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="折线图"><a href="#折线图" class="headerlink" title="折线图"></a>折线图</h2><ul>
<li><p><strong>geom_line()：分别指定一个变量映射给x和y</strong></p>
<ul>
<li><p>x : 常规为<strong>连续变量</strong>；（显示为日期，但格式为字符串或因子，则必须转为 as_date() 格式）</p>
</li>
<li><p>若为离散型变量，需要通过<strong>factor()进行转换</strong>，<strong>此时</strong>必须使用<strong>aes(group=1)</strong>以确保知道这些数据点属于同一分组，从而应该用一条折现连在一起；</p>
<blockquote>
<p>并且此时x轴的刻度值仅为因子型变量对应的分类值；若分类变量只有[1,2,4]，此时x轴的刻度也仅显示[1,2,4] ，不会出现3</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>position = position_dodge(0.2)：微调；左右移动0.2，来避免重叠</p>
<p><strong>如果x变量时因子，必须同时告诉ggplot()用来分组的变量</strong></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># x 为连续型变量</span></div><div class="line">ggplot(BOD, aes(Time, demand)) + geom_line()</div><div class="line"></div><div class="line"><span class="comment"># x 为离散型变量</span></div><div class="line">ggplot(BOD, aes(x=factor(Time), y=demand, group=<span class="number">1</span>)) + geom_line()</div><div class="line"></div><div class="line"><span class="comment"># 通过expand_limit() 扩展y轴的范围</span></div><div class="line">ggplot(BOD, aes(Time, demand)) + geom_line() + </div><div class="line">	expand_limits(y=<span class="number">0</span>)  <span class="comment"># 等价于 ylim(0,max(BOD$demand))</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="折线图-多重折线图"><a href="#折线图-多重折线图" class="headerlink" title="折线图 - 多重折线图"></a>折线图 - 多重折线图</h3><ul>
<li>在分别设定一个映射给x和y的基础上，<strong>再将另一个（离散型）变量映射给颜色(color)或者线型(linetype) </strong></li>
<li>如果x变量时因子，必须同时告诉ggplot()用来分组的变量，否则ggplot()会不知道如何将数据组合在一起绘制折线图<ul>
<li>当分组不正确时，折线图会变成<strong>锯齿状</strong>；<strong>原因在于x在每个位置都对应于多个点，ggplot()误以为这些点属于同一组数据而将其用一条折现连接</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>当你的折线图看起来<strong>不太合理或呈现锯齿状</strong>时，是由于分组不明确，此时必须要用<code>group</code><strong>明确指定分组变量</strong></p>
<p>若当前数据无法实现，考虑转为<strong>长格式</strong>的数据结构</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)  <span class="comment"># 便于使用ddply()创建样本数据集</span></div><div class="line">tg &lt;- ddply(ToothGrowth, c(<span class="string">"supp"</span>,<span class="string">"dose"</span>), summarise, length=mean(len))</div><div class="line"></div><div class="line"><span class="comment"># 将supp映射给颜色 color</span></div><div class="line">ggplot(tg, aes(x=dose,y=length, color=supp)) + geom_line()</div><div class="line"><span class="comment"># 将supp映射给线型 linetype</span></div><div class="line">ggplot(tg, aes(x=dose, y=length, linetype=supp)) + geom_line()</div><div class="line"></div><div class="line"><span class="comment">## x变量为因子，必须指定分组的变量</span></div><div class="line">ggplot(tg, aes(x=factor(dose), y=length, color=supp, group=supp)) + geom_line()</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="折线图-添加数据标记"><a href="#折线图-添加数据标记" class="headerlink" title="折线图  - 添加数据标记"></a>折线图  - 添加数据标记</h3><ul>
<li><strong>geom_point()：通过点来添加标记</strong></li>
</ul>
<blockquote>
<p>position = position_dodge(0.2)：微调；左右移动0.2，来避免重叠</p>
<p>size / shape / color / fill ：调整<strong>标记样式</strong></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD,aes(Time,demand)) + geom_line() + geom_point()</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="折线图-线条样式"><a href="#折线图-线条样式" class="headerlink" title="折线图 - 线条样式"></a>折线图 - 线条样式</h3><blockquote>
<p>linetype、size、color</p>
</blockquote>
<ul>
<li>通过将参数传递给geom_line()设置折线图对应的属性<ul>
<li>对多重折线图而言，设定图形属性会对所有折线产生影响</li>
<li>将变量映射给图形属性会使折线具由不同的外观。可用<code>scale_color_brewer()</code> 和 <code>scale_color_manual()</code> 来设定</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(BOD, aes(Time, demand)) + geom_line(linetype = <span class="string">"dashed"</span>, size= <span class="number">1</span>, color= <span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="折线图-实例"><a href="#折线图-实例" class="headerlink" title="折线图 - 实例"></a>折线图 - 实例</h3><h4 id="将数据转为长格式，然后分组作图，再分面"><a href="#将数据转为长格式，然后分组作图，再分面" class="headerlink" title="将数据转为长格式，然后分组作图，再分面"></a><strong>将数据转为长格式，然后分组作图，再分面</strong></h4><blockquote>
<p>注意：当你的折线图看起来<strong>不太合理或呈现锯齿状时</strong>，是由于分组不明确，此时必须要用用<strong>group明确指定分组变量</strong></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">filter(data_all, 结算日期&gt;=<span class="string">'2017-06-23'</span>,产品 %<span class="keyword">in</span>% c(<span class="string">'螺纹钢'</span>, <span class="string">'铁矿石'</span>)) %&gt;% </div><div class="line">	melt(., id=c(<span class="string">'结算日期'</span>,<span class="string">'产品'</span>),measure=c(<span class="string">'平仓盈亏'</span>,<span class="string">'持仓盈亏'</span>), variable.name=<span class="string">'盈亏类别'</span>,value.name=<span class="string">'盈亏金额'</span>) %&gt;% </div><div class="line">	ggplot(., aes(x=结算日期,y=盈亏金额, color=盈亏类别,group=(盈亏类别))) + </div><div class="line">	geom_line() + </div><div class="line">	facet_wrap(~产品, nrow=<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># 示例数据</span></div><div class="line">结算日期	产品	盈亏类别	盈亏金额</div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">23</span>	铁矿石	平仓盈亏	<span class="number">1258.425</span></div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">23</span>	螺纹钢	平仓盈亏	<span class="number">1453.010</span></div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">26</span>	铁矿石	平仓盈亏	<span class="number">285.390</span></div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">26</span>	螺纹钢	平仓盈亏	-<span class="number">2260.440</span></div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">27</span>	铁矿石	平仓盈亏	<span class="number">2133.495</span></div><div class="line"><span class="number">2017</span>-<span class="number">06</span>-<span class="number">27</span>	螺纹钢	平仓盈亏	-<span class="number">2947.100</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">04</span>	铁矿石	持仓盈亏	-<span class="number">2781.870</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">04</span>	螺纹钢	持仓盈亏	<span class="number">5427.866</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">07</span>	铁矿石	持仓盈亏	<span class="number">2444.015</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">07</span>	螺纹钢	持仓盈亏	<span class="number">28933.560</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">08</span>	铁矿石	持仓盈亏	<span class="number">13062.565</span></div><div class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">08</span>	螺纹钢	持仓盈亏	<span class="number">10053.853</span></div></pre></td></tr></table></figure>
<h4 id="日期格式的作图"><a href="#日期格式的作图" class="headerlink" title="日期格式的作图"></a>日期格式的作图</h4><ul>
<li>x轴转为指定的<strong>日期形式的字符串格式</strong></li>
</ul>
<blockquote>
<p>通过<code>format</code> 函数可以提取任意部分的日期，包括日期、星期几</p>
<p>format(x, format=””)</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">with(data_source_zhibo,&#123;</div><div class="line">    data_source_zhibo$日期 &lt;- format(data_source_zhibo$日期,format=<span class="string">'%m/%d'</span>)  <span class="comment"># format格式转化为后字符串格式</span></div><div class="line">  	data_source_zhibo$首席分析师 &lt;- factor(data_source_zhibo$首席分析师, levels=c(<span class="string">"黄伟"</span>,<span class="string">"夏飞龙"</span>,<span class="string">"陈明燕"</span>,<span class="string">"王健"</span>))</div><div class="line">    ggplot(data_source_zhibo, aes(x=日期, y =最大并发与IP量之比, color=首席分析师,group=首席分析师)) +   <span class="comment"># 注意group=xxx</span></div><div class="line">    geom_line(size=<span class="number">0.7</span>) + </div><div class="line">  	theme_classic() + </div><div class="line">  	labs(title=<span class="string">"最大并发与IP量之比"</span>, y=<span class="literal">NULL</span>) + </div><div class="line">  	theme(axis.text.x=element_text(angle=<span class="number">90</span>, vjust=<span class="number">0.5</span>),plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>), panel.grid.major.y = element_line(color=<span class="string">"grey50"</span>))</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li><strong>日期格式</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(sacles)</div><div class="line">ggplot(data_source_zhibo, aes(x=日期, y =最大并发与IP量之比, color=首席分析师)) + </div><div class="line">	geom_line() + </div><div class="line">	scale_x_date(brekas=data_source_zhibo$日期, labels=date_format(<span class="string">"%m%d"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="面积图"><a href="#面积图" class="headerlink" title="面积图"></a>面积图</h2><ul>
<li><strong>geom_area()</strong>：绘制面积图<ul>
<li>默认情况下，面积图的<strong>填充色为黑灰色，且没有边框线；</strong></li>
<li>若添加边框线令 color = “black” 会使得底部有一条横线，且在起点和终点的位置有一条垂直线；此时可通过不设定color，并用geom_line()绘制轨迹线</li>
</ul>
</li>
</ul>
<blockquote>
<p>fill / color / alpha ：调整样式</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(sunspotyear, aes(x=Year, y= Sunspots)) + </div><div class="line">	geom_area(fill=<span class="string">"bule"</span>, alpha=<span class="number">0.2</span>) + </div><div class="line">	geom_line()</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="面积图-堆积"><a href="#面积图-堆积" class="headerlink" title="面积图 - 堆积"></a>面积图 - 堆积</h3><ul>
<li>geom_area()：运行geom_area，并映射一个<strong><u>因子型变量</u></strong>给<strong>填充色（fill）</strong>即可；<ul>
<li><strong>图例翻转：brekas</strong>；默认情况下，图例的顺序与面积图的顺序是相反的；通过设定标度中的切分（breaks）参数来翻转堆积顺序</li>
<li><strong>图形堆积翻转：在aes()内部设定order=desc(col) </strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>size = 0.2 ；在<strong>各个区域之间添加细线</strong></p>
<p>alpha = 0.4 ；将填充区域设置为半透明</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gccokbook) <span class="comment"># 为了使用数据</span></div><div class="line">ggplot(uspopage, aes(x=Year, y=Thousands, fill=AgeGroup)) + geom_area()</div><div class="line"></div><div class="line"><span class="comment"># 图例翻转 breaks=rev(levels(data$col))</span></div><div class="line">ggplot(uspopage, aes(x=Year, y=Thousands, fill=AgeGroup)) + </div><div class="line">	geom_area(color=<span class="string">"black"</span>, size=<span class="number">0.2</span>, alpha=<span class="number">0.4</span>) + </div><div class="line">	scale_fill_brewer(palette=<span class="string">"Blues"</span>, breaks=rev(levels(uspopage$AgeGroup)))</div><div class="line"></div><div class="line"><span class="comment"># 翻转面积图的堆积顺序</span></div><div class="line">ggplot(uspopage, aes(x=Year, y=Thousands, fill=AgeGroup, order=desc(AgeGroup))) + </div><div class="line">	geom_area(color=<span class="string">"black"</span>, size=<span class="number">0.2</span>, alpha=<span class="number">0.4</span>) + </div><div class="line">	scale_fill_brewer(palette=<span class="string">"Blues"</span>)</div></pre></td></tr></table></figure>
<ul>
<li>绘制<strong>没有边框线的面积图</strong>：先绘制一个不带边框线的面积图（color=NA），然后在其顶部添加geom_line()</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(uspopage,aes(Year, Thousands, fill=AgeGroup, order=desc(AgeGroup))) + </div><div class="line">	geom_area(color=<span class="literal">NA</span>, alpha=<span class="number">0.4</span>) + </div><div class="line">	scale_fill_brewer(palette=<span class="string">"Bluese"</span>) + </div><div class="line">	geom_line(position=<span class="string">"stack"</span>, size=<span class="number">0.2</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="面积图-百分比堆积"><a href="#面积图-百分比堆积" class="headerlink" title="面积图 - 百分比堆积"></a>面积图 - 百分比堆积</h3><ul>
<li><strong>先要计算各组对应的百分比，将该百分比列映射给y</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)  <span class="comment"># 为了使用数据</span></div><div class="line"><span class="comment"># 将Thousands转化为百分比</span></div><div class="line">uspopage_prop &lt;- ddply(uspopage, <span class="string">"Year"</span>, transform, Percent = Thousands / sum(Thousands)*<span class="number">100</span>)  <span class="comment"># 对每一行做运算</span></div><div class="line"></div><div class="line"><span class="comment"># 映射与绘制</span></div><div class="line">ggplot(uspopage_prop, aes(Year, Percent, fill=AgeGroup)) + </div><div class="line">	geom_area(color=<span class="string">"black"</span>, size=<span class="number">0.2</span>, alpha=<span class="number">0.4</span>) + </div><div class="line">	scale_fill_brewer(palette=<span class="string">"Blues"</span>, breaks=rev(levels(uspopage_prop$AgeGroup)))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="添加置信域"><a href="#添加置信域" class="headerlink" title="添加置信域"></a>添加置信域</h3><ul>
<li><strong>阴影</strong>的置信域：运行<strong>geom_ribbon()</strong>，之后分别<strong>映射一个变量给 ymin 和 ymax </strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)  <span class="comment"># 为了使用数据</span></div><div class="line">clim &lt;- subset(climate, Source==<span class="string">"Berkeley"</span>, select=c(<span class="string">"Year"</span>,<span class="string">"Anomaly10y"</span>,<span class="string">"Unc10y"</span>))</div><div class="line"></div><div class="line"><span class="comment"># 将置信域绘制为阴影</span></div><div class="line">ggplot(clim, aes(x=Year, y= Anomaly10y)) + </div><div class="line">	geom_ribbon(aes(ymin=Anomaly10y-Unc10y, ymax=Anomaly10y+Unc10y),alpha=<span class="number">0.2</span>) +   </div><div class="line">	geom_line()  <span class="comment"># geom_ribbon 绘制的顺序在geom_line()之前是为了使折线绘制在阴影区域上面的图层，使折线更清晰</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>虚线的置信域：运用多个geom_line()，分别将上下边界映射给y</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(clim, aes(Year, Anomaly10y)) + </div><div class="line">	geom_line(aes(y=Anomaly10y-Unc10y), color=<span class="string">"gery50"</span>, linetype=<span class="string">"dotted"</span>) + </div><div class="line">	geom_line(aes(y=Anomaly10y+Unc10y), color=<span class="string">"gery50"</span>, linetype=<span class="string">"dotted"</span>) + </div><div class="line">	geom_line()</div></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><ul>
<li><strong>geom_point()</strong>：分别映射一个变量到x和y</li>
</ul>
<blockquote>
<p>shape = 3；设置不同的的点型</p>
<p><strong>size = 2(默认)</strong>； 设置点的大小</p>
<p>color = ；点的轮廓色</p>
<p>fill = ；填充色；</p>
</blockquote>
<p><br></p>
<h3 id="散点图-分组"><a href="#散点图-分组" class="headerlink" title="散点图 - 分组"></a>散点图 - 分组</h3><ul>
<li>将<strong>分组变量</strong>映射给<strong>点型(shape)和颜色(color)属性</strong><ul>
<li><strong>分组变量</strong>必须是<strong>分类变量</strong>（即必须是因子型或字符串型的向量），可用<code>factor</code>转化后进行映射</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweihgt, aes(ageYear, heightIn, color=sex)) + geom_point()</div><div class="line"></div><div class="line"><span class="comment"># 将一个变量同时映射给 shape 和 color</span></div><div class="line">ggplot(heightweihgt, aes(ageYear, heightIn, shape = sex, color=sex)) + geom_point()</div></pre></td></tr></table></figure>
<ul>
<li>自定义<strong>分组变量的点型与颜色</strong>：<ul>
<li><strong>scale_shape_manual(values=c(1,2))</strong></li>
<li><strong>scale_color_brewer()  / scale_color_manual(values=c())</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>当填充色为NA时，会形成一个空心的形状</p>
</blockquote>
<p><br></p>
<h3 id="散点图-连续型变量"><a href="#散点图-连续型变量" class="headerlink" title="散点图 - 连续型变量"></a>散点图 - 连续型变量</h3><blockquote>
<p>当变量超过2个时，必须将它们映射到其他图形属性上，比如点的大小和颜色；</p>
<p>人类对于<strong>感知空间位置的微小变化很擅长，但对于图形颜色和大小的变化不敏感；</strong>因此，<strong>只有当一个变量不需要高精度的解释时，它才被适合映射给图形的大小和属性</strong></p>
</blockquote>
<ul>
<li>size= 2 ；控制大小；<strong>将某个变量映射给size属性时，最好避免将其他变量映射给shape属性；</strong>因为不同点型的点大小很难相互比较</li>
</ul>
<ul>
<li><strong>scale_size_continuous(range=c())</strong>：修改数据点大小的变化范围；默认情况下为1~6ms<ul>
<li>当映射给大小(size)属性时，绘制的图形结果往往具有误导性；最大点对应的面积为最小点的36倍，但在数值上仅3.5倍；</li>
<li>即使修改数据点的范围，但由于点的大小与点的直径或面积是非线性的，所以这个表示值依然不精确</li>
</ul>
</li>
</ul>
<ul>
<li><strong>color / fill</strong> ：对于大多数点型，通过color属性设定颜色<ul>
<li><strong>点型21-25 除了实心区域，还有边框线，此时可通过fill来控制</strong></li>
<li>当数据点颜色较浅时，带框线的点型就会很有用</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ggplot(heightweight, aes(ageYear, heightIn, fill=weightLb)) + </div><div class="line">	geom_point(shape=<span class="number">21</span>, size=<span class="number">2.5</span>) + </div><div class="line">	scale_fill_gradient(low=<span class="string">"black"</span>,high=<span class="string">"white"</span>, breaks=seq(<span class="number">70</span>,<span class="number">170</span>,<span class="number">20</span>), gudie =guide_legend())</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-图形重叠"><a href="#散点图-图形重叠" class="headerlink" title="散点图 - 图形重叠"></a>散点图 - 图形重叠</h3><ol>
<li><p>图形的重叠度较低时</p>
<ul>
<li>较小(size)的数据点</li>
<li>不会遮盖其他数据点的点形（例如1号空心圆）</li>
</ul>
</li>
<li><p>图形重叠度较高时</p>
<ul>
<li>使用半透明(alpha)的点</li>
<li>将<strong>数据分箱(bin)</strong>，并用矩形表示（适用于量化分析） <code>stat_bin2d()</code></li>
</ul>
<blockquote>
<p>stat_bin2d() 函数分别在x轴和y轴方向上将数据<strong>分隔为30个组，总计900个箱子</strong></p>
<p>通过scale_fill_gradient() 设定数据点的颜色，并制定最小色阶low 和最大色阶high</p>
<ul>
<li>默认情况下，图例中不包括最小值，因为颜色标度的范围不是从0开始，而是以各箱中的最小非零值为起始点；若要包括零值，可调用limits参数手动这顶范围为0到最大值</li>
</ul>
</blockquote>
<ul>
<li>将数据分箱(bin)，并用六边形表示<code>hexbin::stat_binhex()</code> （需先安装hexbin包）</li>
<li><strong>增加随机扰动： position_jitter()</strong> 等价于  <strong>geom_point(position=”jitter”)</strong></li>
</ul>
<blockquote>
<p>当散点图的其中一个或两个数据周对应<strong>离散型数据</strong>时，会出现重叠的情况</p>
<p>默认情况下，position_jitter() 在每个方向上添加的扰动值为数据点最小精度的40%；但可通过width 和 height 进行调整</p>
</blockquote>
<ul>
<li>使用<strong>箱线图</strong></li>
</ul>
<blockquote>
<p>当数据集对应一个离散型和一个连续型数据时，箱线图时一种比较好的展示方式</p>
</blockquote>
</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 分箱 - 矩形</span></div><div class="line">sp + stat_bin2d(bins=<span class="number">30</span>)  <span class="comment"># 默认为30</span></div><div class="line"></div><div class="line"><span class="comment"># 分箱 - 六边形</span></div><div class="line">sp + stat_binhex()</div><div class="line"></div><div class="line"><span class="comment"># 添加随机扰动</span></div><div class="line">sql &lt;- ggplot(ChickWeight, aes(Time, weight))</div><div class="line">sql + geom_point(position = position_jitter(width=<span class="number">0.5</span>,height=<span class="number">0</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-回归拟合线"><a href="#散点图-回归拟合线" class="headerlink" title="散点图 - 回归拟合线"></a>散点图 - 回归拟合线</h3><blockquote>
<p>向散点图中添加线型回归拟合线</p>
</blockquote>
<ul>
<li><strong>stat_smooth()：设定method=lm</strong> 即可向散点图中添加线型回归拟合线<ul>
<li>若散点图进行了分组，并将分组变量映射给color和shape属性，则会分别添加拟合线</li>
</ul>
</li>
</ul>
<blockquote>
<p>method = loess(默认)；设置拟合的模型</p>
<blockquote>
<p>loess曲线 ： 局部加权多项式</p>
<p>method = glm, family=binomial ：添加Logistic回归拟合线</p>
<p>lm ，线性回归</p>
</blockquote>
<p>se = FALSE ；控制置信区间；若为会TRUE，会添加95%的置信域</p>
<p>level = 0.95 ；控制置信域的水平</p>
<p>color / linetype / size ：控制拟合线的属性</p>
<blockquote>
<p>为了突出直线，可设置点的 color 以使数据点不那么突出</p>
</blockquote>
<p>fullrange=TRUE；默认为FALSE，支持外推的模型；正常情况下，loess()函数只能根据数据对应的x轴的范围进行预测</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">sp &lt;- ggplot(heightweight, aes(ageYear, heightIN))</div><div class="line">sp + geom_point() + stat_smooth(methdo=lm)</div><div class="line"></div><div class="line"><span class="comment"># 99%置信域</span></div><div class="line">sp + geom_point() + stat_smooth(method=lm, level=<span class="number">0.99</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-根据已有模型添加拟合线"><a href="#散点图-根据已有模型添加拟合线" class="headerlink" title="散点图 - 根据已有模型添加拟合线"></a>散点图 - 根据已有模型添加拟合线</h3><blockquote>
<p>我们需要建立自己的模型，再将模型添加到散点图上</p>
</blockquote>
<ul>
<li>无论哪种模型，只要有对应的predict() 方法，都可以用来绘制拟合线<ul>
<li>lm() 与 loess() 函数对应的方法分别是 predict.lm() 和 predict.losee()</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">model &lt;- lm(heightIn ~ ageYear + I(ageYear^<span class="number">2</span>), heightweight)</div><div class="line">model <span class="comment"># 查看模型</span></div><div class="line"></div><div class="line"><span class="comment"># 创建一个包含变量的ageYear列，并进行插值</span></div><div class="line">xmin &lt;- min(heightweight$ageYear)</div><div class="line">xmax &lt;- max(heightweight$ageYear)</div><div class="line">predicted &lt;- data.frame(ageYear=seq(xmin, xmax, length.out=<span class="number">100</span>))</div><div class="line"></div><div class="line"><span class="comment"># 计算变量heightIn的预测值</span></div><div class="line">predicted$heightIn &lt;- predict(model, predicted)</div><div class="line">predicted</div><div class="line"></div><div class="line"><span class="comment"># 将数据点和模型预测值一起绘制</span></div><div class="line">sp &lt;- ggplot(heightweight, aex(ageYear, heightIn)) + </div><div class="line">	geom_point(color=<span class="string">"grey40"</span>)</div><div class="line">sp + geom_line(data=predicted, size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-添加多个模型的拟合线"><a href="#散点图-添加多个模型的拟合线" class="headerlink" title="散点图 - 添加多个模型的拟合线"></a>散点图 - 添加多个模型的拟合线</h3><p><br></p>
<h3 id="散点图-添加模型系数"><a href="#散点图-添加模型系数" class="headerlink" title="散点图 - 添加模型系数"></a>散点图 - 添加模型系数</h3><p><br></p>
<h3 id="散点图-编辑地毯"><a href="#散点图-编辑地毯" class="headerlink" title="散点图 - 编辑地毯"></a>散点图 - 编辑地毯</h3><blockquote>
<p>边际地毯图本质上是一个一维的散点图，可被用于<strong>展示每个坐标轴上数据的分布情况</strong></p>
</blockquote>
<ul>
<li><strong>geom_rug()</strong>：添加边际地毯图</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ggplot(faithful, aes(eruptions, waiting)) + geom_point() + geom_rug()</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-标签"><a href="#散点图-标签" class="headerlink" title="散点图 - 标签"></a>散点图 - 标签</h3><p><br></p>
<h3 id="散点图-气泡图"><a href="#散点图-气泡图" class="headerlink" title="散点图 - 气泡图"></a>散点图 - 气泡图</h3><ul>
<li><strong>geom_point() + scale_size_area()</strong> ：通过这两者绘制气泡图<ul>
<li>若直接将变量GDP映射给size属性，则GDP的值被映射给了点的半径；此时变量增加一倍时，点的面积会变为原来的4倍；这并不是我们想要的</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">cdat &lt;- subset(contries, Year==<span class="number">2009</span> &amp; Name %<span class="keyword">in</span>% c(<span class="string">"Canda"</span>, <span class="string">"Ireland"</span>,<span class="string">"United Kingdom"</span>))</div><div class="line"></div><div class="line"><span class="comment"># 绘制气泡图</span></div><div class="line">p &lt;- ggplot(cdat, aes(healthexp, infmortality, size=GDP)) + </div><div class="line">	geom_point(shape=<span class="number">21</span>, color=<span class="string">"blcak"</span>, fill=<span class="string">"cornsilk"</span>) + </div><div class="line">	scale_size_area(max_size=<span class="number">15</span>)  <span class="comment"># 得到一个较大的圆</span></div></pre></td></tr></table></figure>
<ul>
<li>其他用法：当x轴和y轴均为分类变量时，气泡图可以用来表示网格点上变量值</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 对男性组和女性组求和</span></div><div class="line">hec &lt;- HairEyeColor[,,<span class="string">"Male"</span>] + HairEyeColor[,,<span class="string">"Female"</span>]</div><div class="line"><span class="comment"># 转为长格式</span></div><div class="line"><span class="keyword">library</span>(reshape)</div><div class="line">hec &lt;- melt(hec, value.name=<span class="string">"count"</span>)</div><div class="line"></div><div class="line">ggplot(hec, aes(Eye, Hari)) + </div><div class="line">	geom_point(aes(size=count), shape=<span class="number">21</span>, color=<span class="string">"black"</span>, fill=<span class="string">"cornsilk"</span>) + </div><div class="line">	scale_size_area(max_size=<span class="number">20</span>, guide=<span class="literal">FALSE</span>) + </div><div class="line">	geom_text(aes(y=as.numeric(Hari)-sqrt(count)/<span class="number">22</span>, label=count), vjust=<span class="number">1</span>, color=<span class="string">"grey60"</span>, size=<span class="number">4</span>)  <span class="comment"># 文本是灰色的，为了削弱文本的突出性，避免圆圈的展示</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="散点图-散点图矩阵"><a href="#散点图-散点图矩阵" class="headerlink" title="散点图 - 散点图矩阵"></a>散点图 - 散点图矩阵</h3><p><br></p>
<p><br></p>
<h2 id="数据标签-geom-text"><a href="#数据标签-geom-text" class="headerlink" title="数据标签 - geom_text()"></a>数据标签 - geom_text()</h2><blockquote>
<p>运行geom_bar() 和 geom_text() 时，需要分别指定一个变量映射给x、y和标签本身</p>
</blockquote>
<ul>
<li><p><strong>geom_text()</strong></p>
<ul>
<li>通过设定y轴的范围，使得标签在绘图区域内；<code>geom_text(aes(y=Weight+0.1, label=Weight))</code></li>
</ul>
<blockquote>
<p>当标签被置于顶端上方有可能使数据标签溢出绘图区域。</p>
</blockquote>
<ul>
<li>使用标签数据时，<strong>对堆叠顺序的调整</strong>最好是通过在计算累计和之前修改因子的水平顺序</li>
</ul>
</li>
</ul>
<blockquote>
<p>x ,y = colname ; 表示范围</p>
<p>label = colmame；显示的标签名</p>
<p>alpha = </p>
<p>color = </p>
<p>size = 5 (默认)； </p>
<p>hjsut  /vjust =  0(right/bottom) 和 1(left/top)</p>
<blockquote>
<p>0，表示左对齐/底部对齐； 形同PPT的对象对齐；而非表格的左右对齐</p>
<p>1，表示又对齐/顶部对齐；</p>
<p>字符串(“left”,”right”,”middle”,”bottom”,”center”,”top”);</p>
<p>字符串 (“inward”,”outward”)</p>
</blockquote>
<p>nudge_x=0 ; nudge_y=0 ；x轴方面，微调</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(cabbage_exp, aes(x=interaction(Date, Cultivar), y=Weight)) + </div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>) + </div><div class="line">	gemo_text(aes(label=Weight), vjust=<span class="number">1.5</span>, color=<span class="string">"white"</span>)  <span class="comment"># 标签在顶端下方</span></div><div class="line"><span class="comment"># vjust = -0.2 # 标签在顶端上方 </span></div><div class="line"></div><div class="line"><span class="comment"># 设定标签的y轴位置使其略高于条形图顶端 —— y轴范围会自动调整</span></div><div class="line">ggplot(cabbage_exp, aes(x=interaction(Date,Cultivaar),y=Weight)) + </div><div class="line">	geom_bar(stat=<span class="string">"identity"</span>) + </div><div class="line">	geom_text(aes(y=Weight+<span class="number">0.1</span>, label=Weight))</div><div class="line"></div><div class="line"><span class="comment">#  </span></div><div class="line">geom_text(aes(label=Weight), vjust=<span class="number">1.5</span>, color=<span class="string">"white"</span>, position=position_dodge(<span class="number">0.9</span>), size=<span class="number">3</span>)  <span class="comment"># 保持标签与条形宽度一致；因为分类间距默认为0.9</span></div></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h1 id="参数与外观设置"><a href="#参数与外观设置" class="headerlink" title="参数与外观设置"></a>参数与外观设置</h1><blockquote>
<p>坐标轴、图例、注解、外观、分面、配色</p>
</blockquote>
<p><br></p>
<h2 id="标度-amp-主题元素一览"><a href="#标度-amp-主题元素一览" class="headerlink" title="标度 &amp; 主题元素一览"></a>标度 &amp; 主题元素一览</h2><p><strong>标度变换 - scale</strong></p>
<ol>
<li>位置标度： scale_x_discrete() / scale_x_continuous()</li>
<li>颜色标度：scale_fill_xxx() / scale_color_xxx()</li>
<li>图例标度：</li>
</ol>
<p><strong>主题元素函数</strong></p>
<blockquote>
<p>?theme 可获得全部的信息</p>
</blockquote>
<ul>
<li><strong>element_text()</strong></li>
</ul>
<blockquote>
<p>face=””  # 字体格式</p>
<blockquote>
<p>“bold” - 加粗 ；”italic” - 斜体 ；”bold.italic” - 粗斜体；”plain”  - 无格式的</p>
</blockquote>
<p>color = </p>
<p>size = num ; <strong>size  = rel( n )</strong>   当前字体的n倍</p>
<p>hjust /vjust = [0,1]  # 对齐方式类同PPT的根据元素对齐</p>
<p>angle = [0,360]</p>
<p>lineheight = num    # 行高</p>
</blockquote>
<ul>
<li><strong>element_line()</strong></li>
</ul>
<blockquote>
<p>linetype = [0,6] </p>
<blockquote>
<p>1- solid 实线； 2-虚线 dashed；3-点 dotted；4 - 破折号 dotdash；5 - 长破折号 longdash；6-双破折号 twodash</p>
</blockquote>
<p>color = </p>
<p>size = </p>
</blockquote>
<ul>
<li><strong>element_rect()</strong></li>
</ul>
<blockquote>
<p>linetype = </p>
<p>size = </p>
<p>color = “” </p>
<p>fill = “”</p>
</blockquote>
<ul>
<li><strong>element_blank()</strong></li>
</ul>
<p><br></p>
<h2 id="坐标轴"><a href="#坐标轴" class="headerlink" title="坐标轴"></a>坐标轴</h2><blockquote>
<p>theme(axis.)</p>
</blockquote>
<ul>
<li><strong>坐标系</strong></li>
</ul>
<blockquote>
<p><strong>翻转</strong></p>
<ol>
<li>coord_flip()</li>
</ol>
<p><strong>刻度范围  - 显示域</strong></p>
<ol>
<li>coord_cartesian( xlim=c(), ylim=c())</li>
</ol>
</blockquote>
<ul>
<li><strong>坐标轴</strong></li>
</ul>
<blockquote>
<p><strong>显示名称 + 外观</strong></p>
<ol>
<li>labs(x=””, y=”” )</li>
<li>theme(axis.title.x = element_text(…) )  # 外观设置</li>
</ol>
<p><strong>刻度范围 - 定义域</strong></p>
<ol>
<li><p>xlim() / ylim()</p>
</li>
<li><p>scale_x_discrete() / scale_x_continuous()</p>
<blockquote>
<p>limits = c(“”)  / c(0,10)</p>
</blockquote>
</li>
<li><p>expand_limits(x=, y=)</p>
</li>
</ol>
<p><strong>刻度标签 - 显示 + 外观</strong></p>
<ol>
<li><p>scale_x_discrete() / scale_x_continuous()</p>
<blockquote>
<p>breaks=c(“”) / c(0,5,10) </p>
<p>labels=c(“”) / c()   # 若设置了labels，必须同时指定breaks</p>
</blockquote>
</li>
<li><p>theme(axis.text.x = element_text() )   # 刻度标签外观</p>
</li>
</ol>
<p><strong>刻度标签  - 反转</strong></p>
<ol>
<li><p>scale_x_discrete( limits=rev(levels( data$colname )))  # 离散型</p>
</li>
<li><p>scale_x_reverse()  # 连续型</p>
<blockquote>
<p>scale_x_reverse(limits=c(3,0))   # 反转，并设定定义域</p>
</blockquote>
</li>
</ol>
<p><strong>刻度线</strong></p>
<ol>
<li>theme(axis.ticks = element_blank() )  # 刻度线位置等于标签显示的位置</li>
</ol>
<p><strong>x / y 轴缩放比例</strong></p>
<ol>
<li>coord_fix() ：使得x/y轴为1:1 </li>
<li>通过scale_x/y_continuous(breaks=seq(0,420,30) )</li>
</ol>
<p><strong>坐标轴直线</strong></p>
<ol>
<li>theme(axis.line = element_line(…))</li>
</ol>
</blockquote>
<p><br></p>
<h3 id="交换x轴和y轴"><a href="#交换x轴和y轴" class="headerlink" title="交换x轴和y轴"></a>交换x轴和y轴</h3><ul>
<li><strong>coord_flip() ：翻转坐标轴</strong></li>
</ul>
<p><br></p>
<h3 id="坐标轴值域-连续型"><a href="#坐标轴值域-连续型" class="headerlink" title="坐标轴值域 - 连续型"></a>坐标轴值域 - 连续型</h3><blockquote>
<p>ylim() 是 scale_y_continuous() 的简便写法，两者应避免同时出现；若要设置除值域外的其他属性，则一定要统计使用scale_y_continuous()</p>
<p>ggplot2中有2两种方式修改坐标轴值域</p>
<ol>
<li><strong>修改标度：任何在范围以外的数据都会被移除</strong>；即超出的数据不仅不糊被展示，而且会被完全移出处理的数据范围，并且会使图形改变<ul>
<li><strong>ylim() / scale_x_discrete() / scale_x_continuous()</strong></li>
</ul>
</li>
<li><strong>应用一个坐标变换</strong>：数据不会被修剪；<strong>它只是放大或缩小到指定的范围</strong><ul>
<li><strong>coord_cartesian(ylim=c())</strong></li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth, aes(group, weight)) + geom_boxplot() </div><div class="line">p + ylim(<span class="number">0</span>, <span class="number">10</span>)  <span class="comment"># 设置值域的一种方法</span></div><div class="line"></div><div class="line">p + scale_y_continuous(limits=c(<span class="number">0</span>,<span class="number">10</span>), breaks=c(<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>))  <span class="comment"># 设置值域，并设定了刻度线放置在0,5,10的位置</span></div><div class="line"></div><div class="line">p + expand_limits(y=<span class="number">0</span>)  <span class="comment"># 通过单向扩展值域，但不能用它来缩减值域</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="坐标轴-项目的顺序"><a href="#坐标轴-项目的顺序" class="headerlink" title="坐标轴 - 项目的顺序"></a>坐标轴 - 项目的顺序</h3><ul>
<li><strong>离散型</strong>变量排序的翻转：<strong>scale_x_discrete(limits=rev(levels(…)))</strong></li>
</ul>
<blockquote>
<p>limits= c(“trt1”,”trt2”)  ；指定显示的项目与顺序</p>
</blockquote>
<ul>
<li><strong>连续型</strong>变量排序的翻转：<strong>scale_x_reverse()</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 离散型变量排序翻转</span></div><div class="line">p &lt;- ggplot(PlantGrowth, aes(group, weight)) + geom_boxplot() </div><div class="line">p + coord_flip() + </div><div class="line">	scale_x_discrete(limits=rev(levels(PlantGrowth$group)))</div><div class="line"></div><div class="line"><span class="comment"># 连续型变量排序翻转</span></div><div class="line">p + scale_y_reverse()</div><div class="line"></div><div class="line">p + scale_y_reverse(limits=c(<span class="number">3</span>,<span class="number">0</span>))  <span class="comment"># 翻转并设定值域</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="坐标轴-缩放比例"><a href="#坐标轴-缩放比例" class="headerlink" title="坐标轴  - 缩放比例"></a>坐标轴  - 缩放比例</h3><blockquote>
<p>x / y 的比例</p>
</blockquote>
<ul>
<li><strong>coord_fixed()</strong>：得到x轴和y轴之间 <strong>1:1</strong> 的缩放结果<ul>
<li>所指的1:1缩放是单位长度表示的数值范围是1:1，从而形成正方形的绘图区域</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook) <span class="comment"># 为了使用数据</span></div><div class="line">sp &lt;- ggplot(marathon, aes(Half, Full)) + geom_point()</div><div class="line">sp + coord_fixed()</div><div class="line"></div><div class="line">sp + coord_fixed() + </div><div class="line">	scale_y_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">30</span>)) + </div><div class="line">	sacle_x_continuous(breaks=seq(<span class="number">0</span>,<span class="number">420</span>,<span class="number">30</span>))  <span class="comment"># 使x与y轴两者的刻度线相同</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="坐标轴-刻度线"><a href="#坐标轴-刻度线" class="headerlink" title="坐标轴 - 刻度线"></a>坐标轴 - 刻度线</h3><h4 id="刻度线-位置"><a href="#刻度线-位置" class="headerlink" title="刻度线 - 位置"></a>刻度线 - 位置</h4><ul>
<li><strong>scale_x_continuous(breaks=)：指定显示的刻度线</strong></li>
</ul>
<blockquote>
<p>breaks=c(“4,4.25, 4.5”) ：离散型</p>
<p>brekas=seq(0,40,10) ：连续型</p>
</blockquote>
<p><br></p>
<h4 id="刻度线和标签-移除"><a href="#刻度线和标签-移除" class="headerlink" title="刻度线和标签 - 移除"></a>刻度线和标签 - 移除</h4><blockquote>
<p>对于连续型坐标轴，ggplot()会在每个breaks值的位置放置刻度线、刻度标签和主网格线；</p>
<p>对于离散型坐标轴，这些元素会出现在每个limits的位置</p>
</blockquote>
<ul>
<li><strong>theme(axis.text.y=element_blank())：移除标签</strong></li>
<li><strong>theme(axis.ticks=element_blank())：移除刻度线</strong></li>
</ul>
<p><br></p>
<h3 id="坐标轴-刻度标签"><a href="#坐标轴-刻度标签" class="headerlink" title="坐标轴 - 刻度标签"></a>坐标轴 - 刻度标签</h3><h4 id="设置与修改文本"><a href="#设置与修改文本" class="headerlink" title="设置与修改文本"></a>设置与修改文本</h4><ul>
<li>通过标度scale_x_discrete/continuous中的<strong>breaks和labels进行赋值</strong></li>
<li>随ggplot2安装的<strong>scales包</strong>自带了一些内建的格式化函数：<ul>
<li><strong>comma() ：在千、百万、十亿等位置向数字添加逗号</strong></li>
<li>dollar()：添加一个美元符号并舍入到最近接的美分</li>
<li><strong>percent()：乘以100，舍入到最接近的整数值，并添加一个百分号</strong></li>
<li><strong>scientific()：对大数字和小数字给出科学计数法都表示， 如3.30e+05</strong></li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">hwp &lt;- ggplot(heightweight, aes(ageYear, heightIn)) + geom_point() + </div><div class="line">	scale_y_continuous(breaks=c(<span class="number">50</span>,<span class="number">56</span>,<span class="number">60</span>,<span class="number">66</span>,<span class="number">72</span>), labels=c(<span class="string">"Tiny"</span>,<span class="string">"Really\nshort"</span>,<span class="string">"Short"</span>,<span class="string">"Medium"</span>,<span class="string">"Tallish"</span>))</div><div class="line"></div><div class="line"><span class="comment">## 以某种格式存储标签</span></div><div class="line"><span class="comment"># 身高格式，显示为5'6'',通过自定义函数来完成</span></div><div class="line">footinch_formatter &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  foot &lt;- floor(x/<span class="number">12</span>)</div><div class="line">  inch &lt;- x %% <span class="number">12</span></div><div class="line">  <span class="keyword">return</span>(paste(foot, <span class="string">"'"</span>,inch,<span class="string">"\""</span>, sep=<span class="string">""</span>))</div><div class="line">&#125;</div><div class="line">footinch_formatter(<span class="number">56</span>:<span class="number">64</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"4'8\""</span>  <span class="string">"4'9\""</span>  <span class="string">"4'10\""</span> <span class="string">"4'11\""</span> <span class="string">"5'0\""</span>  <span class="string">"5'1\""</span>  <span class="string">"5'2\""</span> </div><div class="line">[<span class="number">8</span>] <span class="string">"5'3\""</span>  <span class="string">"5'4\""</span> </div><div class="line">hwp + sacle_y_continuous(labels=footinch_formatter)</div><div class="line"></div><div class="line"><span class="comment"># 将时间测度转化为HH:MM:SS或其他的格式</span></div><div class="line">timeHMS &lt;- <span class="keyword">function</span>(x)&#123;</div><div class="line">  h &lt;- floor(x/<span class="number">60</span>)</div><div class="line">  m &lt;- floor(x %% <span class="number">60</span>)</div><div class="line">  s &lt;- round(<span class="number">60</span>*(x %% <span class="number">1</span>))  <span class="comment"># 舍入到最接近的秒数</span></div><div class="line">  lab &lt;- sprintf(<span class="string">"%02d:02d:02d"</span>,h,m,s)  <span class="comment"># 格式化字符串为HH:MM:SS的格式</span></div><div class="line">  lab &lt;- gsub(<span class="string">"^00:"</span>,<span class="string">""</span>, lab)  <span class="comment"># 如果开头存在00:，则移除</span></div><div class="line">  lab &lt;- gsub(<span class="string">"^0"</span>, <span class="string">""</span>, lab)   <span class="comment"># 如果开头存在0，则移除</span></div><div class="line">  <span class="keyword">return</span>(lab)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="坐标轴-刻度标签的外观"><a href="#坐标轴-刻度标签的外观" class="headerlink" title="坐标轴 - 刻度标签的外观"></a>坐标轴 - 刻度标签的外观</h4><blockquote>
<p>旋转、对齐、大小、颜色等</p>
</blockquote>
<ul>
<li><strong>theme(axis.text.x=element_text(angle=90, hjust=1, vjust=0.5))：旋转标签</strong></li>
</ul>
<blockquote>
<p>element_text()的其他文本属性</p>
<blockquote>
<p>color / size / face / family </p>
<p>size = rel(0.8) ：表示当前字体大小的0.9倍;</p>
</blockquote>
</blockquote>
<p><br></p>
<h3 id="坐标轴-坐标轴标签-名称"><a href="#坐标轴-坐标轴标签-名称" class="headerlink" title="坐标轴 - 坐标轴标签(名称)"></a>坐标轴 - 坐标轴标签(名称)</h3><h4 id="坐标轴标签-修改"><a href="#坐标轴标签-修改" class="headerlink" title="坐标轴标签 - 修改"></a>坐标轴标签 - 修改</h4><ul>
<li><strong>labs(x=””, y=”” )</strong> ：修改坐标轴的标签</li>
<li><strong>xlab / ylab(“”) </strong>：修改坐标轴的标签</li>
</ul>
<p><br></p>
<h4 id="坐标轴标签-移除"><a href="#坐标轴标签-移除" class="headerlink" title="坐标轴标签 - 移除"></a>坐标轴标签 - 移除</h4><ul>
<li><strong>theme(axis.title.x=element_blank())：移除坐标轴标签，且不会为其留出空间</strong></li>
<li><strong>lab(x=””) ：只是将其设置为空白</strong></li>
</ul>
<p><br></p>
<h4 id="坐标轴标签-外观"><a href="#坐标轴标签-外观" class="headerlink" title="坐标轴标签 - 外观"></a>坐标轴标签 - 外观</h4><ul>
<li><strong>theme(axis.title.x = element_text())：</strong></li>
</ul>
<p><br></p>
<h3 id="坐标轴-直线"><a href="#坐标轴-直线" class="headerlink" title="坐标轴  - 直线"></a>坐标轴  - 直线</h3><ul>
<li><strong>theme(axis.line=element_line(clolor=”black”))：沿坐标轴显示直线</strong></li>
</ul>
<blockquote>
<p><strong>lineend = “square”</strong> ：可将坐标轴直线边界的末端进行重叠</p>
<p>若最初使用的主体在绘图区域的周边就有一条线（如theme_bw()），需要同时重置参数panel.border</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p + theme_bw() + </div><div class="line">	theme(panel.border=element_blank(), axis.line=element_line(color=<span class="string">"black"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="对数坐标轴"><a href="#对数坐标轴" class="headerlink" title="对数坐标轴"></a>对数坐标轴</h3><ul>
<li><strong>scale_x_log10() / scale_y_log10() ：设置对数坐标轴</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(MASS)  <span class="comment"># 使用数据</span></div><div class="line">p &lt;- ggplot(Animals, aes(x=body, y=brain, label=rownames(Animals))) + </div><div class="line">	geom_text(size=<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="comment"># 使用对数坐标轴</span></div><div class="line">p + scale_x_log10() + scale_y_log10()</div></pre></td></tr></table></figure>
<ul>
<li>scales包中的 <strong>trans_format()</strong>：<strong>刻度标签</strong>使用指数计数法</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用指数计数法的刻度标签</span></div><div class="line"><span class="keyword">library</span>(scales)</div><div class="line">p + scale_x_log10(breaks = <span class="number">10</span>^(-<span class="number">1</span>:<span class="number">5</span>), labels=trans_format(<span class="string">"log10"</span>, math_format(<span class="number">10</span>^.x)))  + </div><div class="line">	scale_y_log10(breaks = <span class="number">10</span>^(<span class="number">0</span>:<span class="number">3</span>), labels=trans_format(<span class="string">"log10"</span>, math_format(<span class="number">10</span>^.x)))  </div><div class="line"></div><div class="line"><span class="comment"># 使用自定义的变换</span></div><div class="line">p + scale_x_continuous(trans= log_trans(), breaks=trans_breaks(<span class="string">"log"</span>, <span class="keyword">function</span>(x) exp(x)), labels=trans_format(<span class="string">"log"</span>, math_format(e^.x))) + </div><div class="line">  scale_x_continuous(trans= log_trans(), breaks=trans_breaks(<span class="string">"log2"</span>, <span class="keyword">function</span>(x) <span class="number">2</span>^x), labels=trans_format(<span class="string">"log2"</span>, math_format(<span class="number">2</span>^.x)))</div></pre></td></tr></table></figure>
<ul>
<li><strong>annotation_logticks()</strong>：添加刻度</li>
</ul>
<p><br></p>
<h3 id="坐标轴-日期"><a href="#坐标轴-日期" class="headerlink" title="坐标轴 - 日期"></a>坐标轴 - 日期</h3><blockquote>
<p>ggplot2可以处理两类时间对象：日期对象（类为Date的对象），日期时间对象（类为POSIXt的对象）</p>
<p>使用 日期格式的函数，对象必须为日各</p>
</blockquote>
<ul>
<li>as.Date / as_date()：注意转化为日期格式</li>
<li><strong>scale_x_date()：</strong>特定的日期格式坐标轴函数（Date格式）</li>
<li><strong>scale_x_datetime()</strong>：特定的时间格式坐标轴函数（POSIX格式）</li>
<li><strong>scale_x_time()</strong> ：特定的时间格式的坐标轴函数（HMS格式）</li>
</ul>
<blockquote>
<p>breaks：</p>
<p>date_breaks：两者同时出现时，以date_breaks为准；</p>
<p>labels = 指定具体的标签内容</p>
<p><strong>date_labels= “%Y/%m/%d %H:%M:S”  ：指定标签的格式；</strong></p>
<ul>
<li>两者同时出现时，以date_labels为准；</li>
</ul>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">ggplot(economics, aes(date, psavert)) + geom_line()</div><div class="line"></div><div class="line"><span class="comment"># 设置需要的日期序列</span></div><div class="line">econ &lt;- subset(economics, date &gt;= as.Date(<span class="string">"1992-05-01"</span>) &amp; date &lt; as.Date(<span class="string">"1993-06-01"</span>) )  <span class="comment"># 选取子集</span></div><div class="line"></div><div class="line"><span class="comment"># 基本图形</span></div><div class="line">p &lt;- ggplot(econ, aes(date, psavert)) + geom_line()</div><div class="line"><span class="comment"># 指定一个日期向量为分割点</span></div><div class="line">datebreaks &lt;- seq(as.Date(<span class="string">"1992-06-01"</span>), as.Date(<span class="string">"1993-06-01"</span>), by=<span class="string">"2 month"</span>)</div><div class="line"><span class="comment"># 使用分割点并旋转文本</span></div><div class="line">p + scale_x_date(breaks=datebreaks) + </div><div class="line">	theme(axis.text.x = element_text(angle=<span class="number">30</span>, hjust=<span class="number">1</span>))</div><div class="line"></div><div class="line"><span class="comment"># 指定格式 - scales::date_format</span></div><div class="line"><span class="keyword">library</span>(scales)</div><div class="line">p + scale_x_date(breaks=databreaks, labels=date_format(<span class="string">"%Y %b"</span>)) + </div><div class="line">	theme(axis.text.x = element_text(angle=<span class="number">30</span>, hjust=<span class="number">1</span>))</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">##----------------------------------</span></div><div class="line"><span class="comment">#日期格式</span></div><div class="line">df &lt;- data.frame(</div><div class="line">  date = Sys.Date() - <span class="number">0</span>:<span class="number">29</span>,</div><div class="line">  count = runif(<span class="number">30</span>))</div><div class="line"></div><div class="line">tu &lt;- ggplot(df, aes(date, count)) +geom_line()</div><div class="line"><span class="comment">## 下面两个语句的画图结果都是同一个图</span></div><div class="line"><span class="comment">#1、在lables和date_labels同时出现的情况下，系统会优先使用date_labels设置</span></div><div class="line"><span class="comment">#2、在时间设置方面，date_labels,以及date_breaks  设置要比 labels和breaks设置要简洁得多。</span></div><div class="line">tu+scale_x_date(breaks=as.Date(c(<span class="string">"2016-06-06"</span>,<span class="string">"2016-06-13"</span>,<span class="string">"2016-06-20"</span>,<span class="string">"2016-06-27"</span>)),</div><div class="line">                labels=c(<span class="string">"06-06"</span>,<span class="string">"06-13"</span>,<span class="string">"06-20"</span>,<span class="string">"06-27"</span>),date_labels=<span class="string">"%y/%m/%d"</span>)</div><div class="line">tu+scale_x_date(date_labels=<span class="string">"%y/%m/%d"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="结合scales包完成分隔与格式"><a href="#结合scales包完成分隔与格式" class="headerlink" title="结合scales包完成分隔与格式"></a>结合scales包完成分隔与格式</h4><ul>
<li><strong>date_breaks(width=”1 month”)</strong></li>
</ul>
<blockquote>
<p>截断内容除了days，以外还可以用“auto”, “secs”, “mins”, “hours”,  “weeks”等对数据进行分割显示。</p>
</blockquote>
<ul>
<li><strong>date_format(format=”%y-%m-%d”)</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 时间格式</span></div><div class="line">df &lt;- data.frame(</div><div class="line">  date = as.POSIXct(Sys.Date() - <span class="number">0</span>:<span class="number">29</span>),</div><div class="line">  count = runif(<span class="number">30</span>))</div><div class="line"></div><div class="line">tu + scale_x_datetime(breaks=date_breaks(<span class="string">"10 days"</span>),labels=date_format(<span class="string">"%m/%d"</span>) )</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="作图指定的坐标轴日期格式"><a href="#作图指定的坐标轴日期格式" class="headerlink" title="作图指定的坐标轴日期格式"></a>作图指定的坐标轴日期格式</h4><blockquote>
<p><strong>axis.POSIXct {graphics}</strong>：Functions to plot objects of classes “POSIXlt”, “POSIXct” and “Date” representing calendar dates and times.</p>
</blockquote>
<ul>
<li><strong>axis.POSIXct(side, x, at, format, labels = TRUE, …)</strong></li>
<li><p><strong>axis.Date(side, x, at, format, labels = TRUE, …)</strong></p>
<blockquote>
<p>x, at：A date-time or date object.</p>
<p>side    ：See  axis.<br>format：See  strptime.</p>
</blockquote>
</li>
</ul>
<p><br></p>
<p><br></p>
<h3 id="坐标轴-相对时间"><a href="#坐标轴-相对时间" class="headerlink" title="坐标轴 - 相对时间"></a>坐标轴 - 相对时间</h3><ul>
<li>方法一：手动指定跟个点和标签： scale_x_continuous(breaks=c(), labels=c())</li>
<li>方法二：自定义一个格式刷函数</li>
</ul>
<p><br></p>
<p><br></p>
<h2 id="图例-1"><a href="#图例-1" class="headerlink" title="图例"></a>图例</h2><blockquote>
<p>图例 - 概览；<strong>图例是根据aes美学来进行绘制的</strong></p>
<p><strong>theme属性是用来修改外观的</strong></p>
</blockquote>
<ul>
<li>图例的<strong>整个控制</strong></li>
</ul>
<blockquote>
<p><strong>存在与否</strong></p>
<ol>
<li>guides(fill=FALSE) </li>
<li>theme(legend.position=”none”)</li>
</ol>
<p><strong>位置相关</strong></p>
<ol>
<li>theme(legend.position=”” ) : left / right / bottom / top</li>
<li>theme(legend.position=c(0, 1) ) :</li>
<li>theme(legend.justification=c(0,1) ) : </li>
</ol>
<p><strong>整体背景</strong></p>
<ol>
<li>theme(legend.background = element_rect() )</li>
</ol>
</blockquote>
<ul>
<li>图例的<strong>细节部分</strong></li>
</ul>
<blockquote>
<p><strong>内部顺序</strong></p>
<ol>
<li>guides( fill=guide_legend(reverse=TRUE )</li>
<li>scale_fill_discrete(limits=c(“”)) </li>
</ol>
<p><strong>标题</strong></p>
<ol>
<li>labs(fill=”name”)  / labs(fill=NULL)</li>
<li>theme(legend.title = element_text())  / element_blank()</li>
</ol>
<p><strong>文本标签</strong></p>
<ol>
<li>scale_fill_discrete(labels=c())</li>
<li>theme(legend.text = element_text()) </li>
</ol>
<p><strong>图例符号</strong></p>
<ol>
<li>theme(legend.key = element_rect())</li>
</ol>
<p><strong>宽度、列数、方向等</strong></p>
<ol>
<li>guides( fill = guide_legend( … ) )</li>
</ol>
<blockquote>
<p>keywidth = 5 ；宽度</p>
<p>direction = “horizontal” / “vertical” </p>
<p>nrow  / ncol = 2 ；图例内部的行列数</p>
</blockquote>
</blockquote>
<p><br></p>
<h3 id="图例-添加"><a href="#图例-添加" class="headerlink" title="图例 - 添加"></a>图例 - 添加</h3><blockquote>
<p>同一图形中添加图例</p>
<p>不同图形中添加图例：</p>
<ul>
<li>scale<em>xxx</em> 需紧跟在该几何对象geom_之后</li>
<li>若希望图例的合并，则需要使用同一种标度；</li>
</ul>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 同一图中出现三种颜色，并显示图例</span></div><div class="line">ggplot(dd) + geom_line(aes(x=fecha, y=value, colour=variable)) +  </div><div class="line">  scale_colour_manual(values=c(<span class="string">"red"</span>,<span class="string">"green"</span>,<span class="string">"blue"</span>))</div><div class="line"></div><div class="line"><span class="comment">#----------------------</span></div><div class="line"><span class="comment"># 不同图形中添加图例</span></div><div class="line"></div><div class="line">ggplot(qian_all_data_top22,aes(x=factor(format(as_date(日期),format=<span class="string">"%m-%d"</span>)))) +</div><div class="line">  geom_bar(aes(y=IP总量,fill=<span class="string">"red"</span>),stat=<span class="string">"identity"</span>,width=<span class="number">0.5</span>) + </div><div class="line">	scale_fill_manual(breaks=<span class="string">"red"</span>,fill=<span class="string">"#95B3D7"</span>) +     <span class="comment"># scale紧跟在几何对象之后</span></div><div class="line">   <span class="comment"># ylim(c(2000,max(qian_all_data_top22$IP总量))) + expand_limits(y=0)</span></div><div class="line">  geom_line(aes(y=最大并发数,group=<span class="number">1</span>,color=<span class="string">"black"</span>)) +</div><div class="line">	scale_color_manual(breaks=<span class="string">"black"</span>,values=<span class="string">"black"</span>) +</div><div class="line">  geom_point(y=qian_all_data_top22$最大并发数,size=<span class="number">1</span>) +</div><div class="line">  geom_text(aes(y=IP总量,label=comma(IP总量)),vjust=-<span class="number">1</span>) + </div><div class="line">  geom_text(aes(y=最大并发数,label=comma(最大并发数),vjust=-<span class="number">1</span>)) +</div><div class="line">  scale_y_continuous(label=<span class="literal">NULL</span>) +</div><div class="line">  theme_classic() +</div><div class="line">  theme(axis.ticks.y = element_blank(), axis.line.y=element_blank()) + </div><div class="line">  theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>,size=rel(<span class="number">1.4</span>))) + </div><div class="line">  labs(title=<span class="string">"IP量与最大并发数"</span>,x=<span class="literal">NULL</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="图例-移除"><a href="#图例-移除" class="headerlink" title="图例 - 移除"></a>图例 - 移除</h3><ul>
<li><strong>guides(…=FALSE)</strong> ：指定需要移除图例的标度</li>
<li><strong>scale_fill_discrete(guide=FALSE)</strong>：在对应的标度中设置为FALSE<ul>
<li>scale_fill_hue() / scale_fill_discrete() / scale_fill_manual() / scale_fill_grey() / scale_fill_brewer() / scale<em>color</em>… / scale_shape_manual / scale_linetype</li>
</ul>
</li>
<li><strong>theme(legend.position=”none”)</strong>：使用主题系统移除，会移除<strong>所有图例</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + geom_boxplot()</div><div class="line"></div><div class="line"><span class="comment"># 移除标度fill的图例</span></div><div class="line">p + guides(fill=<span class="literal">FALSE</span>)</div><div class="line"></div><div class="line"><span class="comment"># 移除标度fill的图例</span></div><div class="line">p + scale_fill_discrete(guide=<span class="literal">FALSE</span>)</div><div class="line"></div><div class="line"><span class="comment"># 移除所有图例</span></div><div class="line">theme(legend.position=<span class="string">"none"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="图例-位置"><a href="#图例-位置" class="headerlink" title="图例 - 位置"></a>图例 - 位置</h3><ul>
<li><strong>theme(legend.position=””)</strong> ：选择不同的参数来放置图例的位置</li>
</ul>
<blockquote>
<p>top / bottom / left / right / none</p>
</blockquote>
<ul>
<li><strong>theme(legend.position=c(1,1))</strong> ：确定<strong>图例的中心</strong>放置在<strong>给定坐标轴的位置</strong></li>
</ul>
<blockquote>
<p>默认为c(0.5,0.5)</p>
</blockquote>
<ul>
<li><strong>theme(legend.justification=c(1,1))</strong> ：指定图例放置在<strong>绘图区的位置</strong></li>
</ul>
<p><br></p>
<h3 id="图例-顺序"><a href="#图例-顺序" class="headerlink" title="图例 - 顺序"></a>图例 - 顺序</h3><ul>
<li><strong>反转顺序</strong>：<strong>guides(fill=guide_legend(reverse=TRUE))</strong></li>
<li><strong>自定义顺序</strong>：<strong>scale_fill_discrete(limits=c())</strong>将对应<strong>标度的参数limits</strong>设置为所需的顺序</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + geom_boxplot()</div><div class="line"></div><div class="line"><span class="comment"># 修改项目顺序</span></div><div class="line">p + scale_fill_discrete(limits=c(<span class="string">"trt1"</span>,<span class="string">"trt2"</span>,<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="图例-标题"><a href="#图例-标题" class="headerlink" title="图例 - 标题"></a>图例 - 标题</h3><h4 id="标题-名称"><a href="#标题-名称" class="headerlink" title="标题 - 名称"></a>标题 - 名称</h4><ul>
<li><strong>labs(fill=””) ：通过labs并指定对应图例的图形属性的值</strong><ul>
<li>可同时修改不同图例对应的标题</li>
</ul>
</li>
<li><strong>scale_fill_discrete(name=””) ：在设定标度时设定图例标题</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p + labs(fill=<span class="string">"Condition"</span>)</div><div class="line">p + scale_fill_discrete(name=<span class="string">"Condition"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 同时修改不同图例对应的标题</span></div><div class="line">p + labs(shape=<span class="string">"Male/Female"</span>, color=<span class="string">"Male/Female"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="标题-外观"><a href="#标题-外观" class="headerlink" title="标题 - 外观"></a>标题 - 外观</h4><ul>
<li><strong>theme(legend.title = element_text(…))：更改图例标题的外观</strong></li>
</ul>
<h4 id="标题-移除"><a href="#标题-移除" class="headerlink" title="标题 - 移除"></a>标题 - 移除</h4><ul>
<li><strong>labs(fill=NALL)</strong> </li>
<li><strong>guides(fill = guide_legend(title=NULL))</strong></li>
<li><strong>scale<em>fill</em>…(guide=guide_legend(title=NULL))</strong></li>
</ul>
<p><br></p>
<h3 id="图例-标签文本"><a href="#图例-标签文本" class="headerlink" title="图例 - 标签文本"></a>图例 - 标签文本</h3><h4 id="标签-名称"><a href="#标签-名称" class="headerlink" title="标签 - 名称"></a>标签 - 名称</h4><ul>
<li><strong>scale_fill_discrete(labels=c(“”)) ：修改图例标签的文本</strong><ul>
<li>只修改了图例的标签，并没有修改x轴的因子水平；若修改x轴的因子水平，采用scale_x_discrete</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Treatment"</span>,<span class="string">"Treatment 1"</span>,<span class="string">"Treatment 2"</span>))</div></pre></td></tr></table></figure>
<h4 id="标签-外观"><a href="#标签-外观" class="headerlink" title="标签 - 外观"></a>标签 - 外观</h4><ul>
<li><strong>theme(legend.text = element_text(face=””, color=””, size=14, family=””)) ：修改标签的外观</strong></li>
<li>guides(fill=guide_legend(label.theme= element_text(…)))</li>
</ul>
<p><br></p>
<h4 id="标签-多行文本"><a href="#标签-多行文本" class="headerlink" title="标签 - 多行文本"></a>标签 - 多行文本</h4><ul>
<li>标度中设置 labes 参数，使用<code>\n</code> 表示新行</li>
<li><strong>grid包的unit()函数指定高度：</strong>可能出现各行文本相互叠加，通过theme()增加图例说明的高度，并减少各行的间距</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Type 1\ntreatment"</span>,<span class="string">"Type 2\ntreatment"</span>))</div><div class="line"></div><div class="line"><span class="comment"># 增加图例高度并减少各行间距</span></div><div class="line"><span class="keyword">library</span>(gird)</div><div class="line">p + scale_fill_discrete(labels=c(<span class="string">"Control"</span>,<span class="string">"Type 1\ntreatment"</span>,<span class="string">"Type 2\ntreatment"</span>)) + </div><div class="line">	theme(legend.text = element_text(lineheight=<span class="number">0.8</span>), legend.key.height=unit(<span class="number">1</span>, <span class="string">"cm"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="注解-文本"><a href="#注解-文本" class="headerlink" title="注解 - 文本"></a>注解 - 文本</h3><ul>
<li><strong>annotate()：添加一个文类几何对象</strong></li>
</ul>
<blockquote>
<p>“text”</p>
<p>x = , y =  ； 指定添加的坐标轴位置；若坐标轴是连续型的，可以使用特殊值<code>Inf / -Inf</code>将其放置在区域的边缘</p>
<p>label = “” ；标签文字</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>, x=<span class="number">3</span>, y=<span class="number">48</span>, label=<span class="string">"Group 1"</span>, family=<span class="string">"serif"</span>, fontface=<span class="string">"italic"</span>, color=<span class="string">"darkred"</span>, size=<span class="number">3</span>, alpha=<span class="number">0.8</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-数学表达式"><a href="#注解-数学表达式" class="headerlink" title="注解 - 数学表达式"></a>注解 - 数学表达式</h3><ul>
<li>annotate(geom=”text”, parse=TRUE)<ul>
<li>在R的数学表达式中，不能简单把一个变量直接放在另一个变量旁而不在中间加上任何记号；若要显示两个相邻的变量，需要在中间放置一个星号<code>*</code>；在显示图形时，它会被当做一个不可见的乘号对待；    </li>
<li>若要显示一个可见的乘号，采用<code>%*%</code></li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"text"</span>, x=<span class="number">2</span>, y=<span class="number">0.3</span>, parse =<span class="literal">TRUE</span>, label = <span class="string">"frac(1,sqrt(2*pi"</span>))*e^&#123;-x^<span class="number">2</span>/<span class="number">2</span>&#125;<span class="string">")"</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-直线"><a href="#注解-直线" class="headerlink" title="注解 - 直线"></a>注解 - 直线</h3><ul>
<li><strong>geom_hline() / geom_vline()</strong> ：添加横线、竖线</li>
<li><strong>geom_abline()</strong> ：添加有角度的直线</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, color=sex)) + geom_point()</div><div class="line"></div><div class="line"><span class="comment"># 添加横线和竖线</span></div><div class="line">p + geom_hline(yintercept=<span class="number">60</span>) + geom_vline(xintercept=<span class="number">14</span>)</div><div class="line"></div><div class="line"><span class="comment"># 添加有角度的直线</span></div><div class="line">p + geom_abline(intercept=<span class="number">37.4</span>, slope=<span class="number">1.75</span>)</div></pre></td></tr></table></figure>
<ul>
<li>将值从数据映射到xintercept / yintercept之上，甚至是<strong>绘制另一个数据框中的值</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plyr)</div><div class="line">hw_means &lt;- ddply(heightweight, <span class="string">"sex"</span>, summarise, heightIn=mean(heightIm))</div><div class="line">p + geom_hline(aes(yintercept=heightIn, color=sex), data=hw_means, linetype = <span class="string">"dashed"</span>, size=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<ul>
<li>当<strong>坐标轴是离散型</strong>的，必须<strong>以数字的形式</strong>指定它们<ul>
<li>假设坐标轴表示一个因子，第一个水平为数值1，一次类推</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pg &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_point()</div><div class="line">pw + geom_vline(xintercept = <span class="number">2</span>)</div><div class="line"></div><div class="line">pw + geom_vline(xintercept = which(levels(PlantGrouwht$group)==<span class="string">"ctrl"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-线段和箭头"><a href="#注解-线段和箭头" class="headerlink" title="注解 - 线段和箭头"></a>注解 - 线段和箭头</h3><ul>
<li><strong>annotate(“segment”)</strong>：使用segment</li>
<li><strong>grid包中arrow() 函数</strong>可向线段两端添加箭头和平头</li>
</ul>
<blockquote>
<p>angle=30(默认)</p>
<p>length=0.2 英寸(默认，0.508厘米)</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(grid)</div><div class="line">p + annotate(<span class="string">"segment"</span>, x=<span class="number">1850</span>, xend=<span class="number">1820</span>, y=-<span class="number">0.8</span>, yend=-<span class="number">0.95</span>, color=<span class="string">"blue"</span>, size=<span class="number">2</span>, arrow=arrow()) + </div><div class="line">	annotate(<span class="string">"segment"</span>, x=<span class="number">1950</span>, xend=<span class="number">1980</span>, y=-<span class="number">0.25</span>, yend=-<span class="number">0.25</span>, arrow=aroow(ends=<span class="string">"both"</span>, angel=<span class="number">90</span>, length=unit(<span class="number">0.2</span>,<span class="string">"cm"</span>)))</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-矩形阴影"><a href="#注解-矩形阴影" class="headerlink" title="注解 - 矩形阴影"></a>注解 - 矩形阴影</h3><ul>
<li><strong>annotate(“rect”)</strong>：使用rect</li>
</ul>
<blockquote>
<p>xmin / xmax / ymin / ymax</p>
<p>alpha</p>
<p>fill = “”</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + annotate(<span class="string">"rect"</span>, xmin=<span class="number">1950</span>, xmax=<span class="number">1980</span>, ymin=-<span class="number">1</span>, ymax=<span class="number">1</span>, alpha=<span class="number">0.1</span>, fill=<span class="string">"blue"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-高亮某元素"><a href="#注解-高亮某元素" class="headerlink" title="注解 - 高亮某元素"></a>注解 - 高亮某元素</h3><ul>
<li>需在数据中创建一个新列，并将其映射为颜色；</li>
<li>若仅有少量元素要高亮，可以使用原始变量并为每个水平指定颜色，而不必创建新列</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">pg &lt;- PlantGrowth</div><div class="line">pg$h1 &lt;- <span class="string">"no"</span></div><div class="line">pg$h1[pg$group==<span class="string">"trt2"</span>] &lt;- <span class="string">"yes"</span></div><div class="line"></div><div class="line">ggplot(pg, aes(x=group, y=weight, fill=h1)) + geom_point() + </div><div class="line">	scale_fill_manual(values=c(<span class="string">"grey85"</span>,<span class="string">"#FFDDCC"</span>), guide=FASLE)</div><div class="line"></div><div class="line"><span class="comment"># 根据group列设定三个水平</span></div><div class="line">ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + geom_point() + </div><div class="line">	scale_fill_manual(values=c(<span class="string">"grey85"</span>,<span class="string">"grey85"</span>,<span class="string">"#FFDDCC"</span>), guide=FASLE)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="注解-误差线"><a href="#注解-误差线" class="headerlink" title="注解 - 误差线"></a>注解 - 误差线</h3><ul>
<li><strong>geom_errorbar()</strong>：添加误差线，并将变量映射到 ymin 和 ymax</li>
</ul>
<p><br></p>
<h3 id="注解-向独立分面添加注解"><a href="#注解-向独立分面添加注解" class="headerlink" title="注解 - 向独立分面添加注解"></a>注解 - 向独立分面添加注解</h3><ul>
<li>使用分面变量创建一个新的数据框，并设定每个分面要绘制的值</li>
<li>配合新数据框使用geom_text()<ul>
<li>若使用annotate()将在所有分面上显示</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 基本图形</span></div><div class="line">p &lt;- ggplot(mpg, aes(x=displ, y=hwy)) + geom_point() + facet_grid(.~drv)</div><div class="line"></div><div class="line"><span class="comment"># 存有每个分面所需标签的数据框</span></div><div class="line">f_labels &lt;- data.frame(drv=c(<span class="string">"4"</span>,<span class="string">"f"</span>,<span class="string">"r"</span>), label=c(<span class="string">"4wd"</span>,<span class="string">"Front"</span>,<span class="string">"Rear"</span>))</div><div class="line"></div><div class="line">p + geom_text(x=<span class="number">6</span>, y=<span class="number">40</span>, aes(lable=label), data=f_labels)</div><div class="line"></div><div class="line"><span class="comment"># 如果使用annotate()，标签将在所有分面上出现</span></div><div class="line">p + annotate(<span class="string">"text"</span>, x=<span class="number">6</span>, y=<span class="number">42</span>, label=<span class="string">"label text"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="图形整体外观"><a href="#图形整体外观" class="headerlink" title="图形整体外观"></a>图形整体外观</h2><blockquote>
<p><strong>标题</strong></p>
<ol>
<li>labs(title=””, subtitle=””)</li>
<li>theme(plot.title=element_text())</li>
</ol>
<p><strong>网格线</strong></p>
<ol>
<li>theme(panel.grid.major = element_line() )</li>
<li>theme(panel.grid.minor =element_line() )</li>
<li>theme(panel.grid.major.x ) / theme(panel.grid.minor.x) </li>
</ol>
<p><strong>面板</strong></p>
<ol>
<li>theme(panel.border = elment_rect() )  # 面板边界</li>
<li>theme(panel.background = element_rect() )  # 面板背景</li>
</ol>
</blockquote>
<p><br></p>
<h3 id="外观-图形标题"><a href="#外观-图形标题" class="headerlink" title="外观 - 图形标题"></a>外观 - 图形标题</h3><ul>
<li><strong>labs(title=””)</strong>：设置图形标题</li>
<li>将标题移动到<strong>绘图区内部</strong> ：使用一个文本注解annotate()，设定其x的位置为x值域的中间，y的位置为Inf；同时需要vjust为正值，使文本完全落入绘图区域</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(heightwe)</div><div class="line"><span class="comment"># 移动到标题内部 ggtitle</span></div><div class="line">ggplot(heightweight, aes(ageYear, heightIn)) + geom_point() + </div><div class="line">  annotate(<span class="string">"text"</span>, x=mean(range(heightweight$ageYear)), y=<span class="literal">Inf</span></div><div class="line">           , label=<span class="string">"Age and Height\nof Schoolchildren"</span>, vjust=<span class="number">1.5</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="外观-文本"><a href="#外观-文本" class="headerlink" title="外观 - 文本"></a>外观 - 文本</h3><ul>
<li>theme(plot.title = element_text())：完成外观的设置</li>
</ul>
<blockquote>
<p>family ：字体</p>
<p>face(主题元素) /fontface (文本几何对象)：</p>
<p>color ：文字颜色；颜色名称，或 “#RRGGBB”形式的十六进制颜色代码</p>
<p>size ：字体大小；（主题元素的单位是磅，几何对象的单位是毫米）</p>
<blockquote>
<p>size= rel(1.5) ，表示转为当前主题字体大小的1.5倍</p>
</blockquote>
<p>hjust ：横向对齐；0=左对齐；1=右对齐</p>
<blockquote>
<p><strong>0=左对齐，表示左左侧在同一垂直线；效果等同于PPT中的左对齐</strong></p>
</blockquote>
<p>vjust：纵向对齐；0=底部对齐；1=顶部对齐</p>
<blockquote>
<p><strong>0=底部对齐，表示最底端在同一水平线；效果等同PPT中的底部对齐</strong></p>
</blockquote>
<p>angle：旋转角度，单位为度</p>
<p>lineheight：行间距倍数</p>
</blockquote>
<p><br></p>
<h3 id="外观-使用主题"><a href="#外观-使用主题" class="headerlink" title="外观 - 使用主题"></a>外观 - 使用主题</h3><ul>
<li><strong>theme_bw() / theme_grey()</strong> ：使用主题<ul>
<li>theme_grey()：灰色主题；默认</li>
<li>theme_bw() ：黑白主题</li>
<li>theme_classic()：白色背景，无坐标线</li>
<li>theme_minimal() ：无坐标线</li>
</ul>
</li>
<li>theme_get() ：返回当前主题</li>
<li><strong>theme_set(theme_bw())</strong>：设置某个主题为当前默认主题</li>
<li>theme_update() ：为之后的图形设置主题</li>
<li>使用一套现有的主题，并用theme()进行微调：t<strong>heme() 必须接在指定的主题语句之后</strong>；因为ggplot根据图层的先后顺序来绘制的；</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 默认为灰色主题</span></div><div class="line">p + theme_grey()</div><div class="line"></div><div class="line"><span class="comment"># 在完整的主题使用后，theme()可以正常工作</span></div><div class="line">p + theme_bw() + teme(axis.title.x=element_text(color=<span class="string">"red"</span>, size=<span class="number">3</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="主题-自定义"><a href="#主题-自定义" class="headerlink" title="主题 - 自定义"></a>主题 - 自定义</h4><ul>
<li>向一套现成主题添加元素的方式来创建自定义主题</li>
<li>将图形使用修改后的主题绘图</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mytheme &lt;- theme_classic() +theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>)) <span class="comment"># 白色背景，无坐标线</span></div><div class="line"></div><div class="line"><span class="comment"># 使用修改后的主题</span></div><div class="line">p + mytheme</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="外观-面板-amp-网格线"><a href="#外观-面板-amp-网格线" class="headerlink" title="外观 - 面板&amp;网格线"></a>外观 - 面板&amp;网格线</h3><ul>
<li><strong>panel.background：面板背景</strong> - rect</li>
<li><strong>panel.border：面板边界</strong> - rect</li>
</ul>
<ul>
<li><strong>panel.grid.major / panel.grid.minor </strong> ：控制网格线 - line </li>
<li><strong>panel.grid.major.x /y</strong> ：控制横向/纵向的网格线 - line</li>
</ul>
<p><br></p>
<h3 id="外观-边界"><a href="#外观-边界" class="headerlink" title="外观 - 边界"></a>外观 - 边界</h3><blockquote>
<p>随着边界参数值增大，绘图区与边界的距离不断增大，从而在图片上留出更多空白区域</p>
</blockquote>
<ul>
<li><strong>plot.margin =  :</strong> 依次控制 top/right/bottom/left<ul>
<li>“lines”的单位距离 小于 “cm” ；即同为1，”cm”的单位大的多</li>
</ul>
</li>
</ul>
<blockquote>
<p>= unit(c(1,1,1,1), “lines”)</p>
<p>= margin(1,1,1,1, “cm”)</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">theme(plot.margin=unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,),<span class="string">"lines"</span>))</div><div class="line">theme(plot.margin=margin(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">"cm"</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="分面-1"><a href="#分面-1" class="headerlink" title="分面"></a>分面</h2><blockquote>
<p>分面方向取决于你希望进行比较的类型</p>
<ul>
<li>横向分布：比较各条形的高度</li>
<li>纵向分布：比较直方图的水平分布</li>
</ul>
</blockquote>
<ul>
<li><strong>facet_grid()</strong>：可以指定一个变量作为纵向子面板分割的依据，指定另一个变量为横向自面板分割的依据</li>
</ul>
<blockquote>
<p>colname ~ colname ；</p>
</blockquote>
<ul>
<li><strong>facet_warp(~colname, nrow/nclo=n)</strong>：默认使用相同数量的行和列</li>
</ul>
<blockquote>
<p>~ colname ；分面的分组变量</p>
<p>nrow / ncol = n ；</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg, aes(x=displ, y=hwy)) + geom_point()</div><div class="line"></div><div class="line"><span class="comment"># 纵向排列的子面板（多行）根据drv分面</span></div><div class="line">p + facet_grid(drv ~ .)  <span class="comment"># 多行一列</span></div><div class="line"></div><div class="line"><span class="comment"># 同时根据drv（纵向）和cyl（横向）分割</span></div><div class="line">p + facet_grid(drv ~ cyl)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分面-不同坐标轴"><a href="#分面-不同坐标轴" class="headerlink" title="分面 - 不同坐标轴"></a>分面 - 不同坐标轴</h3><ul>
<li><strong>free_x / free_y / free</strong>：标度设置为该值</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + facet_grid(drv ~ cyl, scales=<span class="string">"free_y"</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分面-文本标签"><a href="#分面-文本标签" class="headerlink" title="分面 - 文本标签"></a>分面 - 文本标签</h3><ul>
<li>修改<strong>因子各水平的名称</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mpg2 &lt;- within(mpg, &#123;</div><div class="line">  drv= case_when(drv == <span class="string">"4"</span> ~ <span class="string">"4wd"</span>,</div><div class="line">    drv == <span class="string">"f"</span> ~ <span class="string">"Font"</span>,</div><div class="line">    drv == <span class="string">"r"</span> ~ <span class="string">"Rear"</span>)&#125;)</div><div class="line"></div><div class="line">ggplot(mpg2, aes(displ, hwy)) + geom_point() + facet_grid(drv~.)</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="分面-标签和标题的外观"><a href="#分面-标签和标题的外观" class="headerlink" title="分面 - 标签和标题的外观"></a>分面 - 标签和标题的外观</h3><ul>
<li><strong>strip.text</strong>：控制文本的外观</li>
<li><strong>strip.background</strong>：控制背景的外</li>
</ul>
<p><br></p>
<h2 id="配色"><a href="#配色" class="headerlink" title="配色"></a>配色</h2><h3 id="R中的颜色-基本概念"><a href="#R中的颜色-基本概念" class="headerlink" title="R中的颜色-基本概念"></a>R中的颜色-基本概念</h3><ol>
<li><p>R中有3种方式表示颜色</p>
<ul>
<li><p>颜色名字，即上面所显示的那么多种颜色；</p>
</li>
<li><p>颜色编码。每种颜色是RGB形式的，用6位16进制的字符串表示，前面加“#”号！如红色对应的RGB值为”255 0 0”,用16进制表示就是”FF0000”,在R中可以用”#FF0000”表示红色。</p>
</li>
<li><p>调色板中的索引。</p>
<blockquote>
<p>R中用palette()表示调色板，默认的是颜色是下面的几种：</p>
<p>>palette()</p>
<p>[1] “black”   “red”     “green3”  “blue”    “cyan”    “magenta” “yellow” </p>
<p>[8] “gray” </p>
<p>在默认情况下，col=2表示红色。这个颜色会重复利用，如指定col=10同样是红色。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>R预设了657种颜色。默认情况下，R中颜色的设置主要需要依靠grDevices包的支持，其中提供了大量的颜色选择函数以及生成函数，以及几种<strong>预先设置好的调色板</strong>（Palette），用以表现不同的主题。grDevices包中所有关于颜色的函数大致分为三类：<strong>固定颜色选择函数</strong>，<strong>颜色生成和转换函数</strong>，<strong>特定颜色主题调色板</strong>。</p>
</li>
</ol>
<p><br></p>
<h4 id="固定颜色选择"><a href="#固定颜色选择" class="headerlink" title="固定颜色选择"></a>固定颜色选择</h4><blockquote>
<p>colors() 、 palette()</p>
</blockquote>
<ul>
<li><strong>colors()</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示657中颜色的名称</span></div><div class="line">colors()</div><div class="line"></div><div class="line"><span class="comment"># 使用grep()来提取我们感兴趣的颜色</span></div><div class="line">colors()[grep(<span class="string">"red"</span>, colors())]</div><div class="line">colors()[grep(<span class="string">"sky"</span>, colors())]</div><div class="line">	<span class="comment"># 通过设定为对象，并将其表现出现</span></div><div class="line">	a &lt;- colors()[grep(<span class="string">"sky"</span>,colors())]</div><div class="line">	palette(a)</div></pre></td></tr></table></figure>
<ul>
<li><strong>palette(value)</strong>：调色板<ul>
<li>这个函数用来<strong>设置</strong>调色板或者<strong>获得</strong>调色板颜色值；</li>
<li>注意，实际上这个函数的结果可能并非“固定”颜色，但是<strong>只要设定好了调色板，它的取值就不会再改变（直到下一次重新设定调色板）</strong>。</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 恢复调色板</span></div><div class="line">palette(<span class="string">"defalut"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 查看默认的调色板颜色</span></div><div class="line">&gt; palette()</div><div class="line">[<span class="number">1</span>] <span class="string">"black"</span>   <span class="string">"red"</span>     <span class="string">"green3"</span>  <span class="string">"blue"</span>    <span class="string">"cyan"</span>    <span class="string">"magenta"</span> <span class="string">"yellow"</span>  <span class="string">"gray"</span>  </div><div class="line"></div><div class="line"><span class="comment"># 修改调色板的值（将设定的对象传入到palette()中即可）</span></div><div class="line">palette(colors()[<span class="number">1</span>:<span class="number">10</span>])</div><div class="line"></div><div class="line"> color &lt;- c(<span class="string">"red"</span>,<span class="string">"green"</span>,<span class="string">"blue"</span>,<span class="string">"yellow"</span>,<span class="string">"cyan"</span>);  palette(color)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="颜色生成与转换"><a href="#颜色生成与转换" class="headerlink" title="颜色生成与转换"></a>颜色生成与转换</h4><blockquote>
<p>RGB（红绿蓝三原色混合）、HSV（色调、饱和度、纯度）、HCL（色调、色度、亮度）、灰色</p>
</blockquote>
<ul>
<li><strong>rgb(red, green, blue, maxColorValue=1)</strong></li>
</ul>
<blockquote>
<p>alpha = ；透明度；当元素图形重叠时很有用</p>
<p>maxColorValue =1 (默认)；前三者最大的取值范围【0, maxColorValue】；<strong>通过将maxColorValue=255，可得到传统rgb颜色的16进制数值</strong></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; rgb(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"#FF0000"</span></div><div class="line"></div><div class="line">&gt; rgb(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>,maxColorValue = <span class="number">255</span>)</div><div class="line">[<span class="number">1</span>] <span class="string">"#FF0000"</span></div></pre></td></tr></table></figure>
<ul>
<li><strong>hsv(h, s, v, gamma=1,alpha)</strong>：色调(Hue)、饱和度(Saturation)、纯度(Value)来构造颜色</li>
</ul>
<blockquote>
<p>h, s, v 取值 [0,1]</p>
<p>gamma=1 ，表示伽马校正(Gamma Correction)</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sv(h=<span class="number">1</span>, s=<span class="number">1</span>, v=<span class="number">1</span>, gamma=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<ul>
<li><strong>hcl(h, c, l, alpha)</strong>：色调(Hue)、色度(Chroma)、亮度(Luminance)来构造颜色</li>
</ul>
<blockquote>
<p>h，取值[0,360]；可以想象为一个角度，0-红色，120-绿色，240-蓝色；中间都是过渡色</p>
<p>c, l 取值[0,100]，取值越大生成的颜色<strong>越亮</strong></p>
<p>fixup= T/F ，表示是否修正的颜色</p>
</blockquote>
<ul>
<li><strong>grey(level)：只有一个参数levle，表示灰度水平。取值[0,1]；0-纯黑；1-白色</strong><ul>
<li>level取一个向量，可生成一系列灰色之</li>
</ul>
</li>
<li>rgb2hsv() / clo2rgb()</li>
</ul>
<p><br></p>
<h4 id="特定颜色主题调色板"><a href="#特定颜色主题调色板" class="headerlink" title="特定颜色主题调色板"></a>特定颜色主题调色板</h4><ul>
<li><strong>rainbow</strong>(n, s=1, v=1, start=0, end=max(1, n-1)/n, gamma=1)：彩虹的颜色（红橙黄绿青蓝紫）</li>
</ul>
<blockquote>
<p>n代表调色表里面有几种颜色</p>
</blockquote>
<ul>
<li><strong>heat.colors()</strong>：从<strong>红色</strong>渐变到<strong>黄色</strong>再变到<strong>白色</strong>（以体现“<strong><u>高温”、“白热化”</u></strong>）</li>
<li><strong>terrain.colors()</strong> 从<strong>绿色</strong>渐变到<strong>黄色</strong>再到<strong>棕色</strong>最后到<strong>白色</strong>（这些颜色适合表示<strong><u>地理地形</u></strong>）。</li>
<li><strong>cm.colors()</strong> 从<strong>青色</strong>渐变到白色再到<strong>粉红色</strong>。</li>
<li><strong>topo.colors()</strong> 从<strong>蓝色</strong>渐变到<strong>青色</strong>再到<strong>黄色</strong>最后到<strong>棕色</strong>。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># n代表这个调色板里面有几种颜色，</span></div><div class="line"><span class="comment"># alpha介于【0,1】，反映的是透明度</span></div><div class="line"></div><div class="line">rainbow(n, s = <span class="number">1</span>, v = <span class="number">1</span>, start = <span class="number">0</span>, end = max(<span class="number">1</span>, n - <span class="number">1</span>)/n, alpha = <span class="number">1</span>)</div><div class="line">heat.colors(n, alpha = <span class="number">1</span>)</div><div class="line">terrain.colors(n, alpha = <span class="number">1</span>)</div><div class="line">topo.colors(n, alpha = <span class="number">1</span>)</div><div class="line">cm.colors(n, alpha = <span class="number">1</span>)</div><div class="line"><span class="comment"># rainbow</span></div><div class="line">pie(rep(<span class="number">1</span>, times = <span class="number">1000</span>), labels = <span class="string">""</span>, col = rainbow(<span class="number">1000</span>), border = rainbow(<span class="number">1000</span>))</div><div class="line"><span class="comment"># heat.colors</span></div><div class="line">pie(rep(<span class="number">1</span>, times = <span class="number">1000</span>), labels = <span class="string">""</span>, col = heat.colors(<span class="number">1000</span>), border = heat.colors(<span class="number">1000</span>))</div><div class="line"><span class="comment"># terrain.colors</span></div><div class="line">pie(rep(<span class="number">1</span>, times = <span class="number">1000</span>), labels = <span class="string">""</span>, col = terrain.colors(<span class="number">1000</span>), border = terrain.colors(<span class="number">1000</span>))</div><div class="line"><span class="comment"># topo.colors</span></div><div class="line">pie(rep(<span class="number">1</span>, times = <span class="number">1000</span>), labels = <span class="string">""</span>, col = topo.colors(<span class="number">1000</span>), border = topo.colors(<span class="number">1000</span>))</div><div class="line"><span class="comment"># cm.colors</span></div><div class="line">pie(rep(<span class="number">1</span>, times = <span class="number">1000</span>), labels = <span class="string">""</span>, col = cm.colors(<span class="number">1000</span>), border = cm.colors(<span class="number">1000</span>))</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h4><p>col    绘图使用的颜色，许多函数接受一组颜色，并对不同的数据依次使用颜色。</p>
<p>col.axis     坐标轴字符颜色</p>
<p>col.lab      x,y坐标标记颜色</p>
<p>col.main   标题颜色</p>
<p>col.sub     副标题颜色</p>
<p>fg      绘图前景色，包括坐标轴，各类boxes</p>
<p>bg     绘图背景色</p>
<p><br></p>
<h3 id="RColorBrewer包"><a href="#RColorBrewer包" class="headerlink" title="RColorBrewer包"></a>RColorBrewer包</h3><blockquote>
<p>颜色板被划分为序列性（sequential）离散型（diverging）、分类型（qualitative）</p>
</blockquote>
<ul>
<li><strong>RColorBrewer::display.brewer.all()</strong> ：<strong>调出所有的颜色示例</strong></li>
</ul>
<blockquote>
<ol>
<li><strong>display.brewer.all(type = “seq”)</strong> ：序列性<ul>
<li>序列型颜色板适用于<strong>从低到高排序明显的数据</strong>，浅色数字小，深色数字大。</li>
</ul>
</li>
<li><strong>display.brewer.all(type = “div”)</strong>：离散型<ul>
<li>离散型颜色板适合<strong>带“正、负”的</strong>，对<strong>极值和中间值</strong>比较注重的数据</li>
</ul>
</li>
<li><strong>display.brewer.all(type = “qual”)</strong>：分类型<ol>
<li>分类型颜色板比较适合<strong>区分分类型</strong>的数据</li>
</ol>
</li>
</ol>
</blockquote>
<ul>
<li><strong>brewer.pal(n, name)：</strong>来获取<strong>该组渐变色的全部n种颜色</strong>。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">barplot(rep(<span class="number">1</span>,<span class="number">6</span>),col=brewer.pal(<span class="number">9</span>, <span class="string">"YlOrRd"</span>)[<span class="number">3</span>:<span class="number">8</span>])</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="离散型"><a href="#离散型" class="headerlink" title="离散型"></a>离散型</h3><blockquote>
<p>hue 来自HCL色系(Hue-Chroma-Lightness；色相-色度-亮度)</p>
<ul>
<li>亮度 [0,100]，默认为65</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>填充色</th>
<th>轮廓色</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>scale_fill_discrete()</td>
<td>scale_color_discrete()</td>
<td>色轮周围均匀等距色</td>
</tr>
<tr>
<td>scale_fill_hue()</td>
<td>scale_color_hue()</td>
<td></td>
</tr>
<tr>
<td>scale_fill_grey()</td>
<td>scale_color_grey()</td>
<td>灰度调色板</td>
</tr>
<tr>
<td>scale_fill_brewer()</td>
<td>scale_color_brewer()</td>
<td>ColorBrewer调色板</td>
</tr>
<tr>
<td>scale_fill_manual()</td>
<td>scale_color_manual()</td>
<td>自定义</td>
</tr>
</tbody>
</table>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">p &lt;- ggplot(uspopage, aes(Year, Thousands, fill=AgeGroup)) + geom_area()</div></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li><strong>scale_xxx_grey()：灰度调色板</strong> <ul>
<li>标度范围[0,1] （0-黑色，1-白色）</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + scale_fill_grey(start=<span class="number">0.7</span>, end=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="离散型-自定义"><a href="#离散型-自定义" class="headerlink" title="离散型 - 自定义"></a>离散型 - 自定义</h4><ul>
<li><strong>scale_xxx_manual()：自定义调色板</strong><ul>
<li>当未指定时，values 向量中的元素顺序自动匹配离散标度对应因子水平的顺序。</li>
</ul>
</li>
</ul>
<blockquote>
<p>breaks = “”</p>
<p>values = “”</p>
<p>labels = “”</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#　查看因子顺序的方法</span></div><div class="line">levels(heightweight$sex)</div><div class="line"></div><div class="line"><span class="comment">## values的两种用法</span></div><div class="line"> <span class="comment"># 直接指定颜色</span></div><div class="line">scale_xxx_manual(values=c(<span class="string">"red"</span>,<span class="string">"#CC6666"</span>))</div><div class="line"></div><div class="line"> <span class="comment"># 指定对应的颜色</span></div><div class="line">scale_xxx_manual(values=c(m=<span class="string">"blue"</span>, f=<span class="string">"red"</span>))</div></pre></td></tr></table></figure>
<ul>
<li><strong>对色盲有好的颜色</strong></li>
</ul>
<p><br></p>
<h3 id="连续型"><a href="#连续型" class="headerlink" title="连续型"></a>连续型</h3><table>
<thead>
<tr>
<th>填充色</th>
<th>轮廓色</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>scale_fill_gradient()</td>
<td>scale_color_gradient()</td>
<td>两色渐变</td>
</tr>
<tr>
<td>scale_fill_gradient<strong>2</strong>()</td>
<td>scale_color_gradient2()</td>
<td>三色渐变</td>
</tr>
<tr>
<td>scale_fill_gradient<strong>n</strong>()</td>
<td>scale_color_gradientn()</td>
<td>等间隔的n种颜色的渐变色</td>
</tr>
</tbody>
</table>
<p><br></p>
<ul>
<li><strong>scale_xxx_gradient(low=””, high=””)</strong> ：连续型变量的颜色</li>
</ul>
<blockquote>
<p>使用两者渐变色： <code>low=&quot;black&quot;, high=&quot;white&quot;</code></p>
<p>渐变色中间使用一种颜色划分 ：<code>low=muted(&quot;red&quot;), mid=&quot;white&quot;, higt=muted(&quot;blue&quot;)</code></p>
<ul>
<li>scales::muted() ，针对颜色输出一个饱和度较低的颜色</li>
</ul>
<p>n个颜色的渐变色 ：<code>scale_color_gradient(colors=c(&quot;darkded&quot;, &quot;orange&quot;, &quot;yellow&quot;, &quot;white&quot;))</code></p>
</blockquote>
<p><br></p>
<h4 id="根据数值设定颜色"><a href="#根据数值设定颜色" class="headerlink" title="根据数值设定颜色"></a>根据数值设定颜色</h4><ol>
<li>根据范围创建辅助列</li>
<li>将该列映射到填充色上</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gcookbook)</div><div class="line">cb &lt;- subset(climate, Source==<span class="string">"Berkeley"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 创建辅助列</span></div><div class="line">cb$valence[cb$Anomaly10y &gt;=<span class="number">0</span> ] &lt;- <span class="string">"pos"</span></div><div class="line">cb$valence[cb$Anomaly10y &lt; <span class="number">0</span> ] &lt;- <span class="string">"neg"</span></div><div class="line"></div><div class="line"><span class="comment"># 将辅助列映射到填充标度上</span></div><div class="line">ggplot(cb, aes(Year, Anomaly10y)) + </div><div class="line">	geom_area(aes(fill=valence)) +  </div><div class="line">	geom_line() + </div><div class="line">	geom_hline(yintercept=<span class="number">0</span>) + </div><div class="line">	scale_x_continuous(expand=c(<span class="number">0</span>,<span class="number">0</span>))  <span class="comment"># 剔除两边空白的部分</span></div></pre></td></tr></table></figure>
<blockquote>
<p>上图中会发现在0水平线附近有一些凌乱的阴影。原因在于两个颜色的区域都是由各自的数据点多边形包围而成的，而这些数据点并不都在0上。</p>
<p>通过approx()将数据茶之道1000个点左右来解决。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="comment"># approx()返回一个列表，包含x和y的向量</span></div><div class="line">&gt; interp &lt;- approx(cb$Year, cb$Anomaly10y, n=<span class="number">1000</span>)</div><div class="line">&gt; <span class="comment"># 放在一个数据框中并重新计算valecne</span></div><div class="line">&gt; cbi &lt;- data.frame(Year=interp$x, Anomaly10y=interp$y)</div><div class="line">&gt; cbi$valence[cbi$Anomaly10y &gt;=<span class="number">0</span> ] &lt;- <span class="string">"pos"</span></div><div class="line">&gt; cbi$valence[cbi$Anomaly10y &lt; <span class="number">0</span> ] &lt;- <span class="string">"neg"</span></div><div class="line">&gt;</div><div class="line">&gt; <span class="comment"># 重新作图</span></div><div class="line">&gt; ggplot(cbi, aes(Year, Anomaly10y)) + </div><div class="line">&gt; 	geom_area(aes(fill=valence), alpah=<span class="number">0.4</span>) + </div><div class="line">&gt; 	geom_line() + </div><div class="line">&gt; 	geom_hline(yintercept=<span class="number">0</span>) + </div><div class="line">&gt; 	scale_fill_manual(values=c(<span class="string">"#CCEEFF"</span>,<span class="string">"#FFDDDD"</span>), guide=<span class="literal">FALSE</span>) + </div><div class="line">&gt; 	scale_x_continuous(expand=c(<span class="number">0</span>,<span class="number">0</span>))  <span class="comment"># 剔除两边空白的部分</span></div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
</blockquote>
<p><br></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/软件应用/" rel="tag"># 软件应用</a>
          
            <a href="/tags/程序编程/" rel="tag"># 程序编程</a>
          
            <a href="/tags/r/" rel="tag"># r</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/09/软件应用_程序编程/Jupyter/Jupyter_设置安装/" rel="next" title="Jupyter_设置安装">
                <i class="fa fa-chevron-left"></i> Jupyter_设置安装
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/09/软件应用_程序编程/Jupyter/Jupyter_设置安装.1/" rel="prev" title="Jupyter_设置安装">
                Jupyter_设置安装 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
  <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODMzNi80OTA4"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jimmy_Cai" />
          <p class="site-author-name" itemprop="name">Jimmy_Cai</p>
          <p class="site-description motion-element" itemprop="description">向死而生。做一个有品质的单身汪。</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">128</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/1998962ab991" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/jerry-cai-35/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/chf2012" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/facelife2012/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#输出图形"><span class="nav-number">1.</span> <span class="nav-text">输出图形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PDF"><span class="nav-number">1.1.</span> <span class="nav-text">PDF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#矢量图"><span class="nav-number">1.2.</span> <span class="nav-text">矢量图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#位图"><span class="nav-number">1.3.</span> <span class="nav-text">位图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图形的默认属性"><span class="nav-number">1.4.</span> <span class="nav-text">图形的默认属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图"><span class="nav-number">1.4.1.</span> <span class="nav-text">条形图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文本标签"><span class="nav-number">1.4.2.</span> <span class="nav-text">文本标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#描述数据分布"><span class="nav-number">2.</span> <span class="nav-text">描述数据分布</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#直方图"><span class="nav-number">2.1.</span> <span class="nav-text">直方图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分组直方图"><span class="nav-number">2.1.1.</span> <span class="nav-text">分组直方图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分面-facet-grid-wrap"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">分面 - facet_grid/wrap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分组-fill"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">分组 - fill</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#密度曲线"><span class="nav-number">2.2.</span> <span class="nav-text">密度曲线</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开放的密度曲线"><span class="nav-number">2.2.1.</span> <span class="nav-text">开放的密度曲线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组密度曲线"><span class="nav-number">2.2.2.</span> <span class="nav-text">分组密度曲线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#频数多边形"><span class="nav-number">2.3.</span> <span class="nav-text">频数多边形</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#箱线图"><span class="nav-number">2.4.</span> <span class="nav-text">箱线图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加均值"><span class="nav-number">2.4.1.</span> <span class="nav-text">添加均值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常规图形"><span class="nav-number">3.</span> <span class="nav-text">常规图形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#条形图-1"><span class="nav-number">3.1.</span> <span class="nav-text">条形图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-簇状条形图"><span class="nav-number">3.1.1.</span> <span class="nav-text">条形图 - 簇状条形图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-频数"><span class="nav-number">3.1.2.</span> <span class="nav-text">条形图 - 频数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-正负分别着色"><span class="nav-number">3.1.3.</span> <span class="nav-text">条形图 - 正负分别着色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-宽度与间距"><span class="nav-number">3.1.4.</span> <span class="nav-text">条形图 - 宽度与间距</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-堆积条形图"><span class="nav-number">3.1.5.</span> <span class="nav-text">条形图 - 堆积条形图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图-百分比堆积条形图"><span class="nav-number">3.1.6.</span> <span class="nav-text">条形图 - 百分比堆积条形图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cleveland图"><span class="nav-number">3.1.7.</span> <span class="nav-text">Cleveland图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环状图形"><span class="nav-number">3.2.</span> <span class="nav-text">环状图形</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原始图形"><span class="nav-number">3.2.1.</span> <span class="nav-text">原始图形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去除饼图中心的杂点"><span class="nav-number">3.2.2.</span> <span class="nav-text">去除饼图中心的杂点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去除饼图旁边的标签、刻度须线"><span class="nav-number">3.2.3.</span> <span class="nav-text">去除饼图旁边的标签、刻度须线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例"><span class="nav-number">3.2.4.</span> <span class="nav-text">图例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按顺时针从大到小的顺序显示"><span class="nav-number">3.2.5.</span> <span class="nav-text">按顺时针从大到小的顺序显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去掉白色外框上的数字"><span class="nav-number">3.2.6.</span> <span class="nav-text">去掉白色外框上的数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在图中加百分比"><span class="nav-number">3.2.7.</span> <span class="nav-text">在图中加百分比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分面"><span class="nav-number">3.2.8.</span> <span class="nav-text">分面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成饼环"><span class="nav-number">3.2.9.</span> <span class="nav-text">生成饼环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去掉饼环之外的框框和中间的坐标线"><span class="nav-number">3.2.10.</span> <span class="nav-text">去掉饼环之外的框框和中间的坐标线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#饼环-geom-rect"><span class="nav-number">3.2.11.</span> <span class="nav-text">饼环 - geom_rect()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#折线图"><span class="nav-number">3.3.</span> <span class="nav-text">折线图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#折线图-多重折线图"><span class="nav-number">3.3.1.</span> <span class="nav-text">折线图 - 多重折线图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#折线图-添加数据标记"><span class="nav-number">3.3.2.</span> <span class="nav-text">折线图  - 添加数据标记</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#折线图-线条样式"><span class="nav-number">3.3.3.</span> <span class="nav-text">折线图 - 线条样式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#折线图-实例"><span class="nav-number">3.3.4.</span> <span class="nav-text">折线图 - 实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#将数据转为长格式，然后分组作图，再分面"><span class="nav-number">3.3.4.1.</span> <span class="nav-text">将数据转为长格式，然后分组作图，再分面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#日期格式的作图"><span class="nav-number">3.3.4.2.</span> <span class="nav-text">日期格式的作图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#面积图"><span class="nav-number">3.4.</span> <span class="nav-text">面积图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#面积图-堆积"><span class="nav-number">3.4.1.</span> <span class="nav-text">面积图 - 堆积</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#面积图-百分比堆积"><span class="nav-number">3.4.2.</span> <span class="nav-text">面积图 - 百分比堆积</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加置信域"><span class="nav-number">3.4.3.</span> <span class="nav-text">添加置信域</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#散点图"><span class="nav-number">3.5.</span> <span class="nav-text">散点图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-分组"><span class="nav-number">3.5.1.</span> <span class="nav-text">散点图 - 分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-连续型变量"><span class="nav-number">3.5.2.</span> <span class="nav-text">散点图 - 连续型变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-图形重叠"><span class="nav-number">3.5.3.</span> <span class="nav-text">散点图 - 图形重叠</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-回归拟合线"><span class="nav-number">3.5.4.</span> <span class="nav-text">散点图 - 回归拟合线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-根据已有模型添加拟合线"><span class="nav-number">3.5.5.</span> <span class="nav-text">散点图 - 根据已有模型添加拟合线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-添加多个模型的拟合线"><span class="nav-number">3.5.6.</span> <span class="nav-text">散点图 - 添加多个模型的拟合线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-添加模型系数"><span class="nav-number">3.5.7.</span> <span class="nav-text">散点图 - 添加模型系数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-编辑地毯"><span class="nav-number">3.5.8.</span> <span class="nav-text">散点图 - 编辑地毯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-标签"><span class="nav-number">3.5.9.</span> <span class="nav-text">散点图 - 标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-气泡图"><span class="nav-number">3.5.10.</span> <span class="nav-text">散点图 - 气泡图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图-散点图矩阵"><span class="nav-number">3.5.11.</span> <span class="nav-text">散点图 - 散点图矩阵</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据标签-geom-text"><span class="nav-number">3.6.</span> <span class="nav-text">数据标签 - geom_text()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参数与外观设置"><span class="nav-number">4.</span> <span class="nav-text">参数与外观设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#标度-amp-主题元素一览"><span class="nav-number">4.1.</span> <span class="nav-text">标度 & 主题元素一览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#坐标轴"><span class="nav-number">4.2.</span> <span class="nav-text">坐标轴</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#交换x轴和y轴"><span class="nav-number">4.2.1.</span> <span class="nav-text">交换x轴和y轴</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴值域-连续型"><span class="nav-number">4.2.2.</span> <span class="nav-text">坐标轴值域 - 连续型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-项目的顺序"><span class="nav-number">4.2.3.</span> <span class="nav-text">坐标轴 - 项目的顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-缩放比例"><span class="nav-number">4.2.4.</span> <span class="nav-text">坐标轴  - 缩放比例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-刻度线"><span class="nav-number">4.2.5.</span> <span class="nav-text">坐标轴 - 刻度线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#刻度线-位置"><span class="nav-number">4.2.5.1.</span> <span class="nav-text">刻度线 - 位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#刻度线和标签-移除"><span class="nav-number">4.2.5.2.</span> <span class="nav-text">刻度线和标签 - 移除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-刻度标签"><span class="nav-number">4.2.6.</span> <span class="nav-text">坐标轴 - 刻度标签</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#设置与修改文本"><span class="nav-number">4.2.6.1.</span> <span class="nav-text">设置与修改文本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴-刻度标签的外观"><span class="nav-number">4.2.6.2.</span> <span class="nav-text">坐标轴 - 刻度标签的外观</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-坐标轴标签-名称"><span class="nav-number">4.2.7.</span> <span class="nav-text">坐标轴 - 坐标轴标签(名称)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴标签-修改"><span class="nav-number">4.2.7.1.</span> <span class="nav-text">坐标轴标签 - 修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴标签-移除"><span class="nav-number">4.2.7.2.</span> <span class="nav-text">坐标轴标签 - 移除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴标签-外观"><span class="nav-number">4.2.7.3.</span> <span class="nav-text">坐标轴标签 - 外观</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-直线"><span class="nav-number">4.2.8.</span> <span class="nav-text">坐标轴  - 直线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对数坐标轴"><span class="nav-number">4.2.9.</span> <span class="nav-text">对数坐标轴</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-日期"><span class="nav-number">4.2.10.</span> <span class="nav-text">坐标轴 - 日期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#结合scales包完成分隔与格式"><span class="nav-number">4.2.10.1.</span> <span class="nav-text">结合scales包完成分隔与格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#作图指定的坐标轴日期格式"><span class="nav-number">4.2.10.2.</span> <span class="nav-text">作图指定的坐标轴日期格式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标轴-相对时间"><span class="nav-number">4.2.11.</span> <span class="nav-text">坐标轴 - 相对时间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图例-1"><span class="nav-number">4.3.</span> <span class="nav-text">图例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-添加"><span class="nav-number">4.3.1.</span> <span class="nav-text">图例 - 添加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-移除"><span class="nav-number">4.3.2.</span> <span class="nav-text">图例 - 移除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-位置"><span class="nav-number">4.3.3.</span> <span class="nav-text">图例 - 位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-顺序"><span class="nav-number">4.3.4.</span> <span class="nav-text">图例 - 顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-标题"><span class="nav-number">4.3.5.</span> <span class="nav-text">图例 - 标题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#标题-名称"><span class="nav-number">4.3.5.1.</span> <span class="nav-text">标题 - 名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标题-外观"><span class="nav-number">4.3.5.2.</span> <span class="nav-text">标题 - 外观</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标题-移除"><span class="nav-number">4.3.5.3.</span> <span class="nav-text">标题 - 移除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例-标签文本"><span class="nav-number">4.3.6.</span> <span class="nav-text">图例 - 标签文本</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#标签-名称"><span class="nav-number">4.3.6.1.</span> <span class="nav-text">标签 - 名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标签-外观"><span class="nav-number">4.3.6.2.</span> <span class="nav-text">标签 - 外观</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标签-多行文本"><span class="nav-number">4.3.6.3.</span> <span class="nav-text">标签 - 多行文本</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注解"><span class="nav-number">4.4.</span> <span class="nav-text">注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-文本"><span class="nav-number">4.4.1.</span> <span class="nav-text">注解 - 文本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-数学表达式"><span class="nav-number">4.4.2.</span> <span class="nav-text">注解 - 数学表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-直线"><span class="nav-number">4.4.3.</span> <span class="nav-text">注解 - 直线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-线段和箭头"><span class="nav-number">4.4.4.</span> <span class="nav-text">注解 - 线段和箭头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-矩形阴影"><span class="nav-number">4.4.5.</span> <span class="nav-text">注解 - 矩形阴影</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-高亮某元素"><span class="nav-number">4.4.6.</span> <span class="nav-text">注解 - 高亮某元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-误差线"><span class="nav-number">4.4.7.</span> <span class="nav-text">注解 - 误差线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解-向独立分面添加注解"><span class="nav-number">4.4.8.</span> <span class="nav-text">注解 - 向独立分面添加注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图形整体外观"><span class="nav-number">4.5.</span> <span class="nav-text">图形整体外观</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#外观-图形标题"><span class="nav-number">4.5.1.</span> <span class="nav-text">外观 - 图形标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外观-文本"><span class="nav-number">4.5.2.</span> <span class="nav-text">外观 - 文本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外观-使用主题"><span class="nav-number">4.5.3.</span> <span class="nav-text">外观 - 使用主题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#主题-自定义"><span class="nav-number">4.5.3.1.</span> <span class="nav-text">主题 - 自定义</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外观-面板-amp-网格线"><span class="nav-number">4.5.4.</span> <span class="nav-text">外观 - 面板&网格线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外观-边界"><span class="nav-number">4.5.5.</span> <span class="nav-text">外观 - 边界</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分面-1"><span class="nav-number">4.6.</span> <span class="nav-text">分面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分面-不同坐标轴"><span class="nav-number">4.6.1.</span> <span class="nav-text">分面 - 不同坐标轴</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分面-文本标签"><span class="nav-number">4.6.2.</span> <span class="nav-text">分面 - 文本标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分面-标签和标题的外观"><span class="nav-number">4.6.3.</span> <span class="nav-text">分面 - 标签和标题的外观</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配色"><span class="nav-number">4.7.</span> <span class="nav-text">配色</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#R中的颜色-基本概念"><span class="nav-number">4.7.1.</span> <span class="nav-text">R中的颜色-基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#固定颜色选择"><span class="nav-number">4.7.1.1.</span> <span class="nav-text">固定颜色选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#颜色生成与转换"><span class="nav-number">4.7.1.2.</span> <span class="nav-text">颜色生成与转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特定颜色主题调色板"><span class="nav-number">4.7.1.3.</span> <span class="nav-text">特定颜色主题调色板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他参数"><span class="nav-number">4.7.1.4.</span> <span class="nav-text">其他参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RColorBrewer包"><span class="nav-number">4.7.2.</span> <span class="nav-text">RColorBrewer包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#离散型"><span class="nav-number">4.7.3.</span> <span class="nav-text">离散型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#离散型-自定义"><span class="nav-number">4.7.3.1.</span> <span class="nav-text">离散型 - 自定义</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连续型"><span class="nav-number">4.7.4.</span> <span class="nav-text">连续型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#根据数值设定颜色"><span class="nav-number">4.7.4.1.</span> <span class="nav-text">根据数值设定颜色</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jimmy_Cai</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("JjHJaD5nSfH7Snv1iJOyYCXJ-gzGzoHsz", "LoREb7wzyOhQIbmS4skuPfxv");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
