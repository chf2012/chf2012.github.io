<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="软件应用,程序编程,r," />





  <link rel="alternate" href="/atom.xml" title="Jimmy那些事儿" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="关于ggplot2包的应用。
数据结构、绘图对象、图层、标度变换、分面、坐标系、主题；">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言_ggplot2">
<meta property="og:url" content="http://yoursite.com/2017/03/27/软件应用_程序编程/R/R_专题总结/R_ggplot2_图形艺术/index.html">
<meta property="og:site_name" content="Jimmy那些事儿">
<meta property="og:description" content="关于ggplot2包的应用。
数据结构、绘图对象、图层、标度变换、分面、坐标系、主题；">
<meta property="og:image" content="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_r颜色展示display.brewer.all(">
<meta property="og:image" content="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_rggplot2_guide01.png">
<meta property="og:image" content="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_r图形属性_线条+形状+位置.png">
<meta property="og:updated_time" content="2018-11-11T14:28:54.157Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R语言_ggplot2">
<meta name="twitter:description" content="关于ggplot2包的应用。
数据结构、绘图对象、图层、标度变换、分面、坐标系、主题；">
<meta name="twitter:image" content="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_r颜色展示display.brewer.all(">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/03/27/软件应用_程序编程/R/R_专题总结/R_ggplot2_图形艺术/"/>





  <title> R语言_ggplot2 | Jimmy那些事儿 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jimmy那些事儿</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/软件应用_程序编程/R/R_专题总结/R_ggplot2_图形艺术/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Jimmy_Cai">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Jimmy那些事儿">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Jimmy那些事儿" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                R语言_ggplot2
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T00:00:00+08:00">
                2017-03-27
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新</span>
              
              <time title="更新" itemprop="dateModified" datetime="2018-11-11T22:28:54+08:00">
                2018-11-11
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/" itemprop="url" rel="index">
                    <span itemprop="name">软件应用</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/程序编程/" itemprop="url" rel="index">
                    <span itemprop="name">程序编程</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件应用/程序编程/r/" itemprop="url" rel="index">
                    <span itemprop="name">r</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/27/软件应用_程序编程/R/R_专题总结/R_ggplot2_图形艺术/" class="leancloud_visitors" data-flag-title="R语言_ggplot2">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>关于ggplot2包的应用。</p>
<p>数据结构、绘图对象、图层、标度变换、分面、坐标系、主题；</p>
<a id="more"></a>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>一个图形对象，由5部分组成</p>
<ol>
<li><strong>数据(数据框格式) + 图形属性映射</strong><ul>
<li>封箱：将数据分为子集的形式；默认为bins=30</li>
</ul>
</li>
<li>一个/多个<strong>图层</strong>；图层：一个图层必须由4部分组成<ul>
<li><strong>一种位置调整方式</strong></li>
<li><strong>数据和图形属性映射</strong></li>
<li><strong>一种统计变换</strong></li>
<li><strong>一种几何对象</strong></li>
</ul>
</li>
<li><strong>标度</strong>；每个图形属性映射都对应一个标度</li>
<li>一个<strong>坐标系统</strong></li>
<li><strong>分面</strong>设定</li>
</ol>
<p><br></p>
<h2 id="1-绘图对象-数据-图形属性-aes"><a href="#1-绘图对象-数据-图形属性-aes" class="headerlink" title="1. 绘图对象(数据+图形属性[aes])"></a>1. 绘图对象(数据+图形属性[aes])</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 数据+图形属性</span></div><div class="line">ggplot(data, aes())</div></pre></td></tr></table></figure>
<ul>
<li>why  ：将数据变量映射到图形中；即指定每个变量扮演的角色</li>
</ul>
<blockquote>
<p> 可以使用变量的函数值作为参数；eg: aes(sqtr(age))</p>
<p> aes - aesthetics</p>
</blockquote>
<h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><ul>
<li>必须是<strong>数据框（data.frame)</strong><ul>
<li>ggplot2从<strong>给定的数据框中提取所需的变量，并生成一个新的数据集</strong>，而不是直接在原数据集上进行数据表换；</li>
<li>数据是以<strong>副本</strong>而不是引用的形式存储到图形对象的</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果你的<strong>数据改变了，绘图不会改变</strong></p>
<p>可以被存储save()到磁盘上，并可被直接加载运行load()</p>
</blockquote>
<ul>
<li>替换数据集（ <strong>%+%</strong> ）；<ul>
<li>用相同的代码，对不同的数据集绘图</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mtcars aes(mpg,wt)) + geom_point() </div><div class="line"><span class="comment"># 绘制散点图</span></div><div class="line">mt &lt;- transform(mtcars, mmpg=mpg^<span class="number">2</span>)</div><div class="line"><span class="comment"># 设置新的数据集</span></div><div class="line"></div><div class="line">p %+% mtcars</div><div class="line"><span class="comment">## 对新的数据集绘制相同的图形</span></div></pre></td></tr></table></figure>
<h3 id="图形属性-aes"><a href="#图形属性-aes" class="headerlink" title="图形属性-aes"></a>图形属性-aes</h3><ul>
<li>what ：<strong>大小、颜色、形状、透明度；</strong><ul>
<li>每个图形属性还可以<strong>映射为一个变量</strong>或<strong>设定为一个常数</strong></li>
<li>每一个图形属性都对应一个称为<strong>标度的函数</strong>，作用是<strong>将数据的取值映射到该图形属性的有效取值</strong></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>shape</td>
<td>点的形状</td>
</tr>
<tr>
<td>fill</td>
<td>填充区域</td>
</tr>
<tr>
<td>color</td>
<td>区域的边界；点、线的颜色</td>
</tr>
<tr>
<td>linetype</td>
<td>线条类型</td>
</tr>
<tr>
<td>size</td>
<td>点的大小；线的宽度</td>
</tr>
<tr>
<td>alpha</td>
<td>颜色透明度；</td>
</tr>
<tr>
<td>label</td>
<td>标签；rowname(data)</td>
</tr>
<tr>
<td>group</td>
</tr>
</tbody>
</table>
<blockquote>
<p>alpha</p>
<blockquote>
<p>若想采用同一色度，则加上alpha=var</p>
</blockquote>
</blockquote>
<h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><ul>
<li>分组变量必须是<strong>因子变量</strong>；</li>
<li><strong>离散型变量</strong>的交互作用被设为分组的默认值</li>
</ul>
<blockquote>
<p>group=factor(var) / fill=factor(col)</p>
</blockquote>
<ul>
<li><strong>多个分组 + 单个图形属性</strong> - ggplot()函数<ul>
<li>[what] - 将数据分成若干组，并用相同的方式对每个组进行渲染</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(Oxboys, aes(age, height, group=Subject)) + geom_line()</div></pre></td></tr></table></figure>
<ul>
<li><strong>不同图层 + 不同分组</strong> - geom(aes())函数<ul>
<li>[what] - <strong>不同水平下</strong>的数据整合来对统计汇总信息进行绘图； </li>
<li>不同的图层可能有不同的分组图形属性<ul>
<li>group=1 ,表示选择所有数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + geom_smooth(aes(gruop=<span class="number">1</span>), method=<span class="string">"lm"</span>, size=<span class="number">2</span>, se=<span class="literal">F</span>)</div></pre></td></tr></table></figure>
<ul>
<li><strong>修改默认分组</strong> - geom(aes())函数<ul>
<li>[what] -  自定义离散型变量中的默认分组</li>
<li>[how] - 在几何对象中进行修改</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Occasion为离散型变量，默认分组变量即Occasion</span></div><div class="line">boysbox &lt;- ggplot(Oxboys, aes(Occasion, height)) + geom_boxplot()  </div><div class="line"></div><div class="line"><span class="comment"># 在原基础上添加个体轨迹（此处分组变量因为每个个体Subject)</span></div><div class="line">boysbox + geom_line(aes(group=Subject), colour=<span class="string">"darkblue"</span>) </div><div class="line"></div><div class="line">--若直接在ggplot()函数中添加分组变量，则表示对之后所有图层都适用</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="2-图层-几何对象"><a href="#2-图层-几何对象" class="headerlink" title="2. 图层(几何对象)"></a>2. 图层(几何对象)</h2><ul>
<li>what： 每一个<strong>几何对象</strong>都对应着一个默认的<strong>统计变换和位置参数</strong> （geometric object）<ul>
<li>具体形式为点、线、条；</li>
</ul>
</li>
<li>why  ：决定了<strong>图形的类型</strong></li>
<li>how  ：个体/群组几何对象； / 分组group</li>
</ul>
<blockquote>
<p><strong>设定与映射</strong></p>
<blockquote>
<p><strong>设定：</strong>p + geom_point(colour=”darkblue”)  (其中p &lt;- ggplot(mtcars, aes(x=mpg, y=wt))）</p>
<p>行为：图层里colour参数<strong>设定了点的颜色</strong></p>
<p><strong>映射：</strong>p + geom_point(aes(colour=”darkblue”))</p>
<p>行为：先创建一个只含有”darkblue”的变量，然后将colour映射到这个新变量；因为这个变量是离散型的，默认的颜色标度用色轮上等间距的颜色，并且此处只有一个值，因此这个颜色就是桃红色</p>
</blockquote>
</blockquote>
<h3 id="设定"><a href="#设定" class="headerlink" title="设定"></a>设定</h3><p><strong>【设定】图形属性为一个单一值 - 几何对象中的参数</strong></p>
<ul>
<li>what：用于设定图层的图形；<ul>
<li>设定：几何对象中的参数</li>
</ul>
</li>
<li>how  ：具体组成</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>shape</td>
<td>点的形状</td>
</tr>
<tr>
<td>fill</td>
<td>填充区域</td>
</tr>
<tr>
<td>color</td>
<td>区域的边界；点、线的颜色</td>
</tr>
<tr>
<td>linetype</td>
<td>线条类型</td>
</tr>
<tr>
<td>size</td>
<td>点的大小；线的宽度</td>
</tr>
<tr>
<td>alpha</td>
<td>颜色透明度；<strong>[0~1]</strong></td>
</tr>
<tr>
<td>position</td>
<td>位置</td>
</tr>
<tr>
<td>binwidth</td>
<td>直方图宽度geom_histogram [0,1]</td>
</tr>
<tr>
<td>width</td>
<td>箱线图宽度geom_boxplot [0,1]</td>
</tr>
<tr>
<td>side</td>
<td>地毯图geom_rug的位置；</td>
</tr>
<tr>
<td>notch=T/F</td>
<td>方块图是否为缺口</td>
</tr>
</tbody>
</table>
<blockquote>
<p>position</p>
<blockquote>
<p>对图层中元素的位置进行微调；</p>
<p>常用于离散型数据；[连续型数据很少出现完全重叠的现象]</p>
</blockquote>
</blockquote>
<h3 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h3><p><strong>【映射】到一个变量：修改绘图对象的图形属性</strong></p>
<ul>
<li>why  ：因为图绘图对象可以单独保存，所以才有修改的这个作用</li>
<li>how  ：在几何对象中进行修改<ul>
<li>绘图对象 - ggplot(mtcars, aes(mpg, wt))</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">geom_point(aes(colour=cly)  -&gt; aes(mpg, wt, colour=cyl)))  <span class="comment"># 添加</span></div><div class="line"></div><div class="line">geom_point(aes(y=disp) -&gt; aes(mpg, disp)  <span class="comment"># 修改</span></div><div class="line">           </div><div class="line">geom_point(aes(y-<span class="literal">NULL</span>)) -&gt; aes(mpg)  <span class="comment"># 删除</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="3-图层-统计变换-位置调整"><a href="#3-图层-统计变换-位置调整" class="headerlink" title="3. 图层(统计变换+位置调整)"></a>3. 图层(统计变换+位置调整)</h2><h3 id="统计变化-stat-xx"><a href="#统计变化-stat-xx" class="headerlink" title="统计变化 - stat_xx"></a>统计变化 - stat_xx</h3><ul>
<li><p>what：以某种方式对数据进行<strong>统计汇总</strong>；必须是一个<strong>位置尺度不变</strong>的量</p>
<ul>
<li>任何一个ggplot2图层都包括stat和geom两部分，或者说两个步骤</li>
</ul>
</li>
<li><p>“<strong>每一个几何对象都有一个默认的统计变换，并且每一个统计变换也都有一个默认的几何对象</strong>”。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x &lt;- c(rnorm(<span class="number">100</span>,<span class="number">14</span>,<span class="number">5</span>),rep(<span class="number">20</span>,<span class="number">20</span>)) </div><div class="line">y &lt;- c(rnorm(<span class="number">100</span>,<span class="number">14</span>,<span class="number">5</span>) + rnorm(<span class="number">100</span>,<span class="number">0</span>,<span class="number">1</span>),rep(<span class="number">20</span>,<span class="number">20</span>))</div><div class="line">ggplot(data= <span class="literal">NULL</span>, aes(x = x, y = y)) + geom_point(color = <span class="string">"darkred"</span>,stat = <span class="string">"sum"</span>)  等同于</div><div class="line">ggplot(data= <span class="literal">NULL</span>, aes(x = x, y = y)) +  stat_sum(color = <span class="string">"darkred"</span>,geom = <span class="string">"point"</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>可<strong>在几何对象中修改统计变换；</strong></p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ geom_histogram(aes(y=..density..))</div></pre></td></tr></table></figure>
<ul>
<li>可在统计变换中<strong>修改集合对象</strong>；</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">d &lt;- ggplot(diamonds,aes(carat,price))</div><div class="line">d +stat_density2d(geom=<span class="string">"point"</span>, aes(size=..density..), contour=<span class="literal">F</span>)</div></pre></td></tr></table></figure>
<ul>
<li><p>why  ：<strong>将返回的数据集作为输出，并可在图形中展现</strong>；故可向原数据集中插入新的变量</p>
<ul>
<li>当我们需要展示出<strong>某个变量的某种统计特征</strong>的时候，需要用到统计变换</li>
</ul>
</li>
<li><p>how  ：生成变量的名字必须用<strong>点号围起来</strong> （..xx..）</p>
<p>​</p>
</li>
</ul>
<p><br></p>
<h2 id="4-标度变换-scale"><a href="#4-标度变换-scale" class="headerlink" title="4. 标度变换(scale)"></a>4. 标度变换(scale)</h2><ul>
<li><p>what：控制<strong>数据到图形属性的映射</strong>；将数据单位（升、英里加仑数）转换为电脑可以识别的物理单位（像素和颜色）的过程</p>
<ul>
<li>定义域（数据空间）</li>
<li>值域（图形属性空间）</li>
<li>将定义域映射的值域； 变换-训练-映射</li>
</ul>
</li>
<li><p>why  ：将数据转化为视觉可以感知的东西：大小、颜色、位置；提供读图时使用的工具：坐标轴+图例</p>
</li>
<li><p>how  ：用法 -  <strong>scale_图形属性名称_标度名称</strong>  ( scale_x_discrete() )</p>
<ul>
<li>可修改的标度，以适应变量类型与标度类型；（当修改底层数据或图形属性映射后）</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p &lt;- ggplot(mpg, aes(cty,hwy)) </div><div class="line">p + geom_point(aes(x=drv)) + scale_x_discrete()</div></pre></td></tr></table></figure>
</li>
<li><p>图形属性：scale_colour / fill / x / y / shape / linetype / size </p>
</li>
</ul>
<p><code>scale_xxx_yyy</code>的具体形式</p>
<table>
<thead>
<tr>
<th><strong>xxx</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>colour</td>
<td>Color of lines and points</td>
</tr>
<tr>
<td>fill</td>
<td>Color of area fills (e.g. bar graph)</td>
</tr>
<tr>
<td>linetype</td>
<td>Solid/dashed/dotted lines</td>
</tr>
<tr>
<td>shape</td>
<td>Shape of points</td>
</tr>
<tr>
<td>size</td>
<td>Size of points</td>
</tr>
<tr>
<td>alpha</td>
<td>Opacity/transparency</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>yyy</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>hue</td>
<td>Equally-spaced colors from the color wheel</td>
</tr>
<tr>
<td>manual</td>
<td>Manually-specified values (e.g., colors, point shapes, line types)</td>
</tr>
<tr>
<td>gradient</td>
<td>Color gradient</td>
</tr>
<tr>
<td>grey</td>
<td>Shades of grey</td>
</tr>
<tr>
<td>discrete</td>
<td>Discrete values (e.g., colors, point shapes, line types, point sizes)</td>
</tr>
<tr>
<td>continuous</td>
<td>Continuous values (e.g., alpha, colors, point sizes)</td>
</tr>
</tbody>
</table>
<h3 id="位置标度-坐标轴"><a href="#位置标度-坐标轴" class="headerlink" title="位置标度 - 坐标轴"></a>位置标度 - 坐标轴</h3><h4 id="坐标轴标签名称"><a href="#坐标轴标签名称" class="headerlink" title="坐标轴标签名称"></a>坐标轴标签名称</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ xlab(<span class="string">"xx"</span>) / ylab(<span class="string">"xx"</span>)</div><div class="line"></div><div class="line">+ labs(x=<span class="string">""</span>,y=<span class="string">""</span>,title=<span class="string">""</span>,subtitle=<span class="string">""</span>)</div></pre></td></tr></table></figure>
<h4 id="坐标轴刻度范围"><a href="#坐标轴刻度范围" class="headerlink" title="坐标轴刻度范围"></a>坐标轴刻度范围</h4><ul>
<li><strong>固定标度的定义域</strong></li>
<li><strong>expand_limits()</strong>：通过指定的值，使其包含在刻度值中<ul>
<li><code>expand_limits(x=0, y=0)</code> </li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+ xlim() /ylim()</div><div class="line"></div><div class="line">xlim(n,n) / ylim(n,n) / ylim(<span class="number">0</span>, max(data$var))  <span class="comment"># 连续型</span></div><div class="line">xlim(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>)  <span class="comment"># 离散型</span></div><div class="line">xlim(as.Date(c(<span class="string">"2008-05-01"</span>,<span class="string">"2008-08-01"</span>))  <span class="comment"># 日期型</span></div><div class="line"></div><div class="line"></div><div class="line">控制数据出现的个数和顺序</div><div class="line">+ scale_x_ (limits=()) </div><div class="line"><span class="comment"># + scale_x_discrete(limits=c("trt2", "ctrl"))  # 本应该有3个离散变量</span></div></pre></td></tr></table></figure>
<blockquote>
<p>对条形图、直方图不可用xlim()，因为会删除其不再范围内的变量；应改用coord_cartesion(xlim=c(,) )</p>
</blockquote>
<h4 id="刻度值的分段显示-转换"><a href="#刻度值的分段显示-转换" class="headerlink" title="刻度值的分段显示 + 转换"></a>刻度值的分段显示 + 转换</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">+ scale_x_continuous()  <span class="comment"># 连续型</span></div><div class="line">+ scale_x_discrete()  <span class="comment"># 离散型</span></div><div class="line"></div><div class="line"></div><div class="line">limits=c( )  <span class="comment"># 固定标度的定义域；连续型-数值型，离散型-字符； limits影响显示在图形上的元素</span></div><div class="line"><span class="comment">## 要显示的范围； #控制标签的个数和顺序</span></div><div class="line"></div><div class="line">breaks=c( )  <span class="comment"># 指定坐标轴上应显示哪些刻度线的值或一个连续型标度在一个图例中将被如何分段</span></div><div class="line"><span class="comment">## breaks影响显示在坐标轴和图例上的元素</span></div><div class="line"><span class="comment">## scale_x_continuous(breaks=c(0.1,0.2))  # 设置显示的x轴标签刻度值</span></div><div class="line">=c(seq(<span class="number">0</span>,<span class="number">200</span>,<span class="number">20</span>))</div><div class="line"></div><div class="line">labels=c()  <span class="comment"># 指定了应在断点处显示的标签</span></div><div class="line"><span class="comment">## 若设置了labels，则必须同时指定breaks</span></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">改变变量的显示顺序</div><div class="line">scale_x_discrete/continuous</div><div class="line"></div><div class="line">自定义</div><div class="line"><span class="comment"># +scale_x_discrete(limits=c("trt1","ctrl","trt2"))</span></div><div class="line">只显示x1和x2两项</div><div class="line"><span class="comment">## p &lt;- ggplot(diamonds,aes(x=carat,y=price))</span></div><div class="line"><span class="comment">## p + geom_point(colour = "green") + scale_x/y_discrete(limits=c('x1','x2'))</span></div><div class="line"></div><div class="line"></div><div class="line">转置 -离散变量</div><div class="line"><span class="comment"># + scale_x_discrete(limits=rev(levels(PlantGrowth$group)))  </span></div><div class="line">+ scale_x_discete(breaks=rev(levels(PlantGrowth$group)))</div><div class="line"><span class="comment">## 必须跟在ggplot()之后，不可用 last_plot() + scale_x_  否则会报错;但可用 p + scale_x_discrete</span></div><div class="line"></div><div class="line">转置 - 连续变量</div><div class="line"><span class="comment"># 左右反转 - x轴</span></div><div class="line">scale_x_reverse()</div><div class="line"><span class="comment"># 上下反转 - y轴</span></div><div class="line">scale_y_reverse()</div><div class="line"><span class="comment"># 逆时针旋转</span></div><div class="line">coord_flip()</div><div class="line"><span class="comment"># 顺时针旋转</span></div><div class="line">scale_x_reverse() + coord_flip() </div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">设置x/y轴显示的相对比例</div><div class="line"><span class="comment"># 1:1</span></div><div class="line">+ scale_y_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">30</span>)) </div><div class="line">+ scale_x_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">30</span>))</div><div class="line"></div><div class="line"><span class="comment"># 1:2</span></div><div class="line">+ scale_y_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">30</span>))  </div><div class="line">+ scale_x_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">15</span>))</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">使图形从原点(<span class="number">0</span>,<span class="number">0</span>)出发 -expand</div><div class="line">scale_x_continuous(expand=c(<span class="number">0</span>,<span class="number">0</span>))  </div><div class="line"><span class="comment">#  这个参数使得数据与坐标轴有一定的距离；默认情况下，连续型变量距离为c(0.05, 0)，离散型变量距离为c(0, 0.6) </span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">示例：</div><div class="line">ggplot(data=Salaries, aes(x=rank, y=salary, fill=sex)) + </div><div class="line">  geom_boxplot() + </div><div class="line">  scale_x_discrete(breaks=c(<span class="string">"AsstProf"</span>, <span class="string">"AssocProf"</span>, <span class="string">"Prof"</span>),</div><div class="line">                  labels=c(<span class="string">"Assistant\nProfessor"</span>, <span class="string">"Associate\nProfessor"</span>, <span class="string">"Full\nProfessor"</span>)) + </div><div class="line">  scale_y_continuous(breaks=c(<span class="number">50000</span>, <span class="number">100000</span>, <span class="number">150000</span>, <span class="number">200000</span>), labels=c(<span class="string">"$50K"</span>, <span class="string">"$100K"</span>, <span class="string">"$150K"</span>, <span class="string">"$200K"</span>)) +</div><div class="line">  labs(title=<span class="string">"Faculty Salary by Rank and Sex"</span>,x=<span class="string">""</span>, y=<span class="string">""</span>)</div></pre></td></tr></table></figure>
<h4 id="刻度值的变换"><a href="#刻度值的变换" class="headerlink" title="刻度值的变换 "></a><strong>刻度值的变换 </strong></h4><ul>
<li><strong>在统计计量之前，不会改变几何形状</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">刻度值变化</div><div class="line">+ scale_x_continous(trans=<span class="string">""</span>)</div><div class="line">+ scale_x_continuous(trans=<span class="string">"log(10)"</span>)   <span class="string">"sqtr"</span></div><div class="line"><span class="comment"># 变换在计算统计摘要之前，虽然数值变换了，但坐标轴的刻度不会改变</span></div><div class="line"><span class="comment"># 若直接在aes(x=log10(x))，变换也在计算统计摘要之前，但坐标轴刻度会改变</span></div><div class="line"></div><div class="line">日期与时间</div><div class="line">as.Date()</div><div class="line">+ scale_x_date(labels=date_format(<span class="string">"%m%d"</span>), breaks=date_breaks(<span class="string">"2 weeks"</span>))</div><div class="line">+ scale_x_datetime()</div><div class="line"></div><div class="line"></div><div class="line">------------------------------------------------------------------可能已失效</div><div class="line"><span class="comment"># major / minor 指定主要和次要断点的位置，并允许以这些单位的倍数出现</span></div><div class="line">日期与时间-主刻度线 major</div><div class="line">breaks=，可为数值型向量</div><div class="line">date_breaks=<span class="string">""</span>，只能是字符串向量，<span class="string">"2 weeks"</span> / <span class="string">"10 years"</span></div><div class="line"><span class="comment"># majOir="2 weeks"</span></div><div class="line"></div><div class="line">日期与时间-次刻度线 minor</div><div class="line">minor_breaks=，</div><div class="line">date_minor_breaks=<span class="string">""</span>，只能是字符串向量，<span class="string">"1 day"</span></div><div class="line"></div><div class="line">日期与时间- 格式输出 format</div><div class="line">lables=format(<span class="string">" "</span>)  <span class="comment"># 若失效，改为 data_format()</span></div></pre></td></tr></table></figure>
<h3 id="颜色标度"><a href="#颜色标度" class="headerlink" title="颜色标度"></a>颜色标度</h3><ul>
<li><strong>显示的颜色，</strong>前提是已经设置的颜色属性；<strong>scale<em>color</em>   / scale<em>fill</em></strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">scale_color_  / scale_fill_</div><div class="line"></div><div class="line"></div><div class="line">离散型颜色梯度</div><div class="line">+ scale_color/fill_hue()  <span class="comment"># 默认</span></div><div class="line">+ scale_color/fill_brewer(palette=<span class="string">""</span>)</div><div class="line"><span class="comment">## 对象为点 -  "Set1" / "Dark2"</span></div><div class="line"><span class="comment">## 对象为面积 - "Set2" / "Pastel1" / "Pastel2" / "Accent"</span></div><div class="line"><span class="comment">## 得到所有颜色的展示 library(RColorBrewer)  display.brewer.all()</span></div><div class="line">手动离散型颜色标度</div><div class="line">+ scale_color/fill_manual(values=c(<span class="string">"xx"</span>,<span class="string">"xx"</span>))  手动设定颜色的值</div><div class="line"></div><div class="line">col=rgb(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)  ; col=hsv(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>);  col=<span class="string">"white"</span>; col=<span class="string">"#FFFFFF"</span></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">连续型颜色梯度（渐变色）</div><div class="line">scale_color/fill_gradient(low=<span class="string">""</span>, high=<span class="string">""</span>)  <span class="comment"># 双色 low,high，分别控制梯度两端的颜色</span></div><div class="line">scale_color/fill_gradient2(low=<span class="string">""</span>,high=<span class="string">""</span>, midpoint=)  <span class="comment"># 三色 low,high,midpoint(默认为0)</span></div><div class="line">scale_color/fill_gradientn() , color=xx  <span class="comment"># 自定义n色 一个颜色向量</span></div></pre></td></tr></table></figure>
<p><img src="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_r颜色展示display.brewer.all(" alt="">.png)</p>
<h3 id="离散型的手动标度"><a href="#离散型的手动标度" class="headerlink" title="离散型的手动标度"></a>离散型的手动标度</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ scale_shape_manual(values=c())</div><div class="line">+ scale_size_manual(valuse=c())</div><div class="line">+ scale_linetype_mannule(values=c())</div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="图例标度-guides"><a href="#图例标度-guides" class="headerlink" title="图例标度 - guides"></a>图例标度 - guides</h3><ul>
<li>guides为<strong>每一个scale_by_scale的函数</strong>来设置参数</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">图例-guide_legend()</div><div class="line">guides(fill= guide_legend(title=, title.position=<span class="string">"top"</span>, title.hjust=, title.vjust=, label=<span class="literal">T</span>, label.position=<span class="string">"top"</span>, label.hjust=, label.vjust=, direction=<span class="string">"vertical"</span>/<span class="string">"horizonttal"</span>, nrow=<span class="number">2</span>, ncol=<span class="number">2</span>, reverse=<span class="literal">F</span>, byrow=<span class="literal">F</span>)</div><div class="line"></div><div class="line">图例 - 删除</div><div class="line"><span class="comment"># bp &lt;- ggplot(data=PlantGrowth, aes(x=group, y=weight, fill=group)) + geom_boxplot()</span></div><div class="line">guides(fill=<span class="literal">FALSE</span>)  替换fill为所需的美学</div><div class="line"></div><div class="line">+ guides(fill=<span class="literal">FALSE</span>)</div><div class="line">+ scale_fill_discrete(guide=<span class="literal">FALSE</span>)</div><div class="line">+ theme(legend.position=<span class="string">"none"</span>)  <span class="comment"># 删除所有图例</span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">图例 - 位置 - 整个区域内 <span class="comment"># 下面的数字位置是相对于整个区域，包括标题和标签，而不仅仅是绘图区域</span></div><div class="line">bp + theme(legend.position=<span class="string">"top"</span>)  <span class="comment"># 该表示方法在绘图区之外； bottom;left;right;</span></div><div class="line">bp + theme(legend=c(<span class="number">0</span>,<span class="number">0</span>))   <span class="comment"># 见下图</span></div><div class="line"></div><div class="line">位置 - 绘图区域内  <span class="comment"># 添加legend.justification=c(0,0) 表示在绘图区的c(0,0)的方位，而不是在整个区域</span></div><div class="line">bp + theme(legend.justification=c(<span class="number">0</span>,<span class="number">0</span>), legend.position=c(<span class="number">0</span>,<span class="number">0</span>))</div></pre></td></tr></table></figure>
<p><img src="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_rggplot2_guide01.png" width="50%"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">图例 - 项目顺序</div><div class="line">更改图例中项目的顺序 - breaks</div><div class="line">+ scale_fill_discrete(breaks=c(<span class="string">"ctr1"</span>,<span class="string">"ctrl"</span>,<span class="string">"ctr2"</span>))  <span class="comment"># fill是ggplot(aes(fill=group)) 详见bp的构造</span></div><div class="line"></div><div class="line">反转图例中项目的顺序</div><div class="line">+ guide(fill=guide_legend(reverse=<span class="literal">T</span>))</div><div class="line">+ scale_fill_discrete(guide=guide_legend(reverse=<span class="literal">T</span>))  <span class="comment"># 注意这里的fill参照bp的构成</span></div><div class="line"></div><div class="line">+ scale_fill_discrete(breaks=rev(levles(PlantGrowth$group)))</div><div class="line"></div><div class="line">+ guides(color = guide_legend(reverse=<span class="literal">TRUE</span>))  <span class="comment"># 内部顺序 </span></div><div class="line"><span class="comment"># 条形图时，且用fill来分组时</span></div><div class="line"><span class="comment"># 当分组用alpha时，guide(alpha=guide_legend(reverse=T))</span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">图例-标题</div><div class="line"><span class="comment"># 用fill来填充颜色,那么我们去掉图例就需要用fill, 去掉标题</span></div><div class="line">third &lt;- ggplot(mpg, aes(cyl, hwy, fill = factor(cyl))) + geom_boxplot()</div><div class="line">third + guides(fill=guide_legend(title=<span class="literal">NULL</span>))</div><div class="line">third + guides(fill = guide_legend(title = <span class="string">"how"</span>))</div><div class="line">third + guides(fill = guide_legend(title.position = <span class="string">"top"</span>))</div><div class="line"></div><div class="line"><span class="comment"># 通过theme来调整</span></div><div class="line">+ theme(legend.title=element_blank())</div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">图例 - 标题和标签的文本</div><div class="line">第一种方式：guide可以被fill,colour, linetype, shape所引导</div><div class="line">+ scale_fill_discrete(values=c(<span class="string">"#999999"</span>,<span class="string">"#E69F00"</span>,<span class="string">"#56B4E9"</span>), name=<span class="string">"Experiment\nCondition"</span>, breaks=c(<span class="string">"ctrl"</span>, <span class="string">"trt1"</span>, <span class="string">"trt2"</span>), labels=c(<span class="string">"Control"</span>, <span class="string">"Treatment 1"</span>, <span class="string">"Treatment 2"</span>)) <span class="comment"># 更改图例标题必须使用 scale_xx_discrete的方式</span></div><div class="line"></div><div class="line">图例-标签</div><div class="line">third + guides(fill = guide_legend(label = <span class="literal">TRUE</span>)) <span class="comment"># 标签与否</span></div><div class="line">third + guides(fill = guide_legend(label.position = <span class="string">"top"</span>)) <span class="comment"># 标签位置</span></div><div class="line">third + guides(fill = guide_legend(label.theme = element_text(size = <span class="number">15</span>, face = <span class="string">"italic"</span>, colour = <span class="string">"red"</span>, angle = <span class="number">30</span>)))</div><div class="line"></div><div class="line">第二种方式：改变数据框</div><div class="line">pg &lt;- PlantGrowth   </div><div class="line">levels(pg$group)[levels(pg$group)==<span class="string">"ctrl"</span>] &lt;- <span class="string">"Control"</span></div><div class="line">levels(pg$group)[levels(pg$group)==<span class="string">"trt1"</span>] &lt;- <span class="string">"Treatment 1"</span></div><div class="line">levels(pg$group)[levels(pg$group)==<span class="string">"trt2"</span>] &lt;- <span class="string">"Treatment 2"</span></div><div class="line">names(pg)[names(pg)==<span class="string">"group"</span>]  &lt;- <span class="string">"Experimental Condition"</span>  <span class="comment"># 更改单个列的列名</span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">图例 - 标题和标签的外观</div><div class="line"><span class="comment"># 默认情况下，图例不会有一个框。要添加一个框并修改其属性：</span></div><div class="line">bp + theme(legend.background = element_rect())</div><div class="line">bp + theme(legend.background = element_rect(fill=<span class="string">"gray90"</span>, size=<span class="number">.5</span>, linetype=<span class="string">"dotted"</span>))</div><div class="line"></div><div class="line"></div><div class="line">图例-图表</div><div class="line">third + guides(fill = guide_legend(keywidth = <span class="number">5</span>)) <span class="comment"># 图表宽度</span></div><div class="line">third + guides(fill = guide_legend(direction = <span class="string">"horizontal"</span>))  /  <span class="string">"vertical"</span></div><div class="line">third + guides(fill = guide_legend(nrow = <span class="number">2</span>))  <span class="comment"># 图表的列数</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">图例 - 斜杠</div><div class="line">如果使用轮廓制作条形图（通过设置color =“black”），它将通过图例中的颜色绘制斜杠。</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="5-分面-facet"><a href="#5-分面-facet" class="headerlink" title="5. 分面(facet)"></a>5. 分面(facet)</h2><ul>
<li>what： 将数据划分为多个子集，并依次绘图<ul>
<li>适用于离散型变量（若对连续型变量则需要先将其转换）</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">连续型变量转换为离散型</div><div class="line"></div><div class="line">cut_interval(x, n=<span class="number">10</span>)  <span class="comment"># 将数据划分为n个长度相同的部分</span></div><div class="line">cut_number(x, n=<span class="number">10</span>)  <span class="comment"># 将数据划分为n个有相同数目点的部分</span></div></pre></td></tr></table></figure>
<ul>
<li>why  ：用于<strong>比较不同分组</strong>之间的情况；（理解为aes中gruop的不同变体；）<ul>
<li><strong>分组：容易发现各组之间细微的差别</strong></li>
<li><strong>分面：对于各组之间重叠问题严重时，可很好地解决该问题</strong></li>
</ul>
</li>
<li>how  ： + facet_grid / wrap</li>
</ul>
<h3 id="网格型"><a href="#网格型" class="headerlink" title="网格型"></a>网格型</h3><ul>
<li><p>what ：<strong>二维面板</strong>，由<strong>行和列</strong>通过变量来定义；</p>
</li>
<li><p>why  ：用于<strong>两个或多个变量</strong>来生成一个2维网格</p>
</li>
<li><p>how  ：需要<strong>设定哪些变量作为分面绘图的行与列</strong>；</p>
<p>​</p>
</li>
<li><p>多种形式 - <strong>facet_grid()</strong></p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">. ~ a  <span class="comment"># 一行多列，根据变量a进行分面为n列</span></div><div class="line">a ~.   <span class="comment">#  一列多行，根据变量a进行分面n行</span></div><div class="line">a~b    <span class="comment"># 多行多列</span></div><div class="line">.~a+b / a+b~.  <span class="comment"># 多个变量的多个水平在行/列上(或同时)</span></div><div class="line"></div><div class="line"></div><div class="line">--------------------------边际图----------------------------------------</div><div class="line">margins=<span class="literal">T</span>  <span class="comment"># 展示所有分面的边际图</span></div><div class="line">margins=c(<span class="string">"col"</span>,<span class="string">"col"</span>)  <span class="comment"># 列出需展示边际图的变量名称</span></div><div class="line">grand_row / grand_col  <span class="comment"># 分别生成所有行/列的边际图</span></div></pre></td></tr></table></figure>
<blockquote>
<p>网格型 - 分面位置占比 - <strong>space=”fixed”/ “free”</strong>（随标度范围变化而变化）</p>
</blockquote>
<h3 id="封装型"><a href="#封装型" class="headerlink" title="封装型"></a>封装型</h3><ul>
<li>what：一维面板条，再封装到二维中</li>
<li>why  ：处理<strong>单个多水平</strong>变量</li>
</ul>
<ul>
<li>多种形式 - <strong>facet_wrap()</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~ a, ncol=n</div><div class="line">~a, nrow=n</div></pre></td></tr></table></figure>
<h4 id="封装型-标度控制"><a href="#封装型-标度控制" class="headerlink" title="封装型 - 标度控制"></a>封装型 - 标度控制</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">scales=<span class="string">""</span></div><div class="line"></div><div class="line">scales=<span class="string">"fixed"</span>  <span class="comment"># 所有面板中x/y标度相同（默认）</span></div><div class="line"><span class="comment">## 在相同的基准上进行比较，观察各子集相似的模式;  ## 对于 facet_grid 必须是x/y都相同</span></div><div class="line"></div><div class="line">scales=<span class="string">"free"</span>  <span class="comment"># x/y每个面板的标度都可以变化; 自由标度，用于发现更多的细节</span></div><div class="line"></div><div class="line">scales=<span class="string">"free_x"</span> / <span class="string">"free_y"</span>  <span class="comment"># x的标度可变，y 的尺度固定</span></div></pre></td></tr></table></figure>
<h3 id="分面的标签控制"><a href="#分面的标签控制" class="headerlink" title="分面的标签控制"></a>分面的标签控制</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data %&gt;%   mutate(left = factor(left, labels = c(<span class="string">"Remain"</span>, <span class="string">"Left"</span>))) %&gt;% </div><div class="line"><span class="comment"># 需先将变量设置为需显示的标签</span></div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="6-坐标系-coord"><a href="#6-坐标系-coord" class="headerlink" title="6. 坐标系(coord)"></a>6. 坐标系(coord)</h2><ul>
<li>what：将两种位置标度结合在一起组成的二维定位系统</li>
<li>how  ：笛卡尔坐标系、非笛卡尔坐标系</li>
</ul>
<h3 id="笛卡尔坐标-cartesian"><a href="#笛卡尔坐标-cartesian" class="headerlink" title="笛卡尔坐标 -  cartesian() "></a><strong>笛卡尔坐标 -  cartesian() </strong></h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">范围设置 - 放大</div><div class="line">coord_cartesian(xlim=c(n,n), ylim=c())</div><div class="line"><span class="comment">## 与 +xlim() &amp; scale_x_continuous(limits=c()) 区别：</span></div><div class="line"><span class="comment">## coord - 使用的仍是所有数据，只是展示的仅该部分数据；如同用放大镜看数据</span></div><div class="line"><span class="comment">## xlim() &amp; scale_x_ - 是将超出此范围的数据都删除，仅对在该范围内的数据做图</span></div><div class="line"></div><div class="line"></div><div class="line">x/y轴翻转 </div><div class="line">+ coord_flip(xlim=c(), ylim=c())</div><div class="line"><span class="comment"># 或者 直接在图形属性aes()中将变量先后顺序调换</span></div><div class="line"></div><div class="line">转置 -离散变量</div><div class="line"><span class="comment"># + scale_x_discrete(limits=rev(levels(PlantGrowth$group)))  </span></div><div class="line">+ scale_x_discete(breaks=rev(levels(PlantGrowth$group)))</div><div class="line"><span class="comment">## 必须跟在ggplot()之后，不可用 last_plot() + scale_x_  否则会报错;但可用 p + scale_x_discrete</span></div><div class="line">转置 - 连续变量</div><div class="line"><span class="comment"># 左右反转 - x轴</span></div><div class="line">scale_x_reverse()</div><div class="line"><span class="comment"># 上下反转 - y轴</span></div><div class="line">scale_y_reverse()</div><div class="line"><span class="comment"># 逆时针旋转</span></div><div class="line">coord_flip()</div><div class="line"><span class="comment"># 顺时针旋转</span></div><div class="line">scale_x_reverse() + coord_flip() </div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------------------------------</div><div class="line"></div><div class="line">坐标轴变换 - 在统计量计算之后，会改变几何形状</div><div class="line">+ coord_trans(x=<span class="string">"sqrt"</span>, y=, xlim, ylim) </div><div class="line">+ coord_trans(xtrans=<span class="string">"sqrt"</span>, ytrans=<span class="string">""</span>, xlim, ylim)</div><div class="line"></div><div class="line"></div><div class="line">x/y轴标度比例</div><div class="line">+ coord_equal()  <span class="comment"># 默认为1:1</span></div><div class="line">+ coord_equla(ratio=<span class="number">1.5</span>, xlim, ylim) <span class="comment"># ratio=y/x的值</span></div></pre></td></tr></table></figure>
<h3 id="非笛卡尔坐标"><a href="#非笛卡尔坐标" class="headerlink" title="非笛卡尔坐标"></a>非笛卡尔坐标</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">极坐标</div><div class="line">+ coord_polar(theta=<span class="string">"x"</span>, direction=<span class="number">1</span>, start=<span class="number">0</span> ) <span class="comment"># 绘制饼图/雷达图</span></div><div class="line"><span class="comment"># direction= 1，顺时针，-1，逆时针   start=0 12点钟弧度的起点偏移量</span></div><div class="line"></div><div class="line">地图投影</div><div class="line"><span class="keyword">library</span>(mapproj)</div><div class="line">coord_map</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="7-主题-theme"><a href="#7-主题-theme" class="headerlink" title="7. 主题(theme)"></a>7. 主题(theme)</h2><ul>
<li>what：对数据<strong>之外的图形外观</strong>进行控制；</li>
<li>how  ：设置与使用<ul>
<li><strong>使用方式：+theme(主题元素 = 主题性质)</strong></li>
<li><code>+ theme(plot.title=element_text(size=20))</code></li>
</ul>
</li>
</ul>
<h3 id="主题与设置"><a href="#主题与设置" class="headerlink" title="主题与设置"></a>主题与设置</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">整体风格变动 - 四种种内置主题</div><div class="line"></div><div class="line">+ theme_gray()  <span class="comment"># 灰色背景，白色网格线</span></div><div class="line">+ theme_bw()  <span class="comment"># 白色背景，灰色网格线</span></div><div class="line">+ theme_classic() <span class="comment"># 白色背景，无网格线</span></div><div class="line">+ theme_minimal()  <span class="comment"># 无坐标线</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">设置 -</div><div class="line">theme_set()  <span class="comment"># 返回先前的主题</span></div><div class="line">theme_get()  <span class="comment"># 获得当前主题设置</span></div><div class="line"></div><div class="line">全局设置</div><div class="line">theme_set(theme_gray())</div><div class="line"></div><div class="line">局部设置 </div><div class="line">直接在ggplot()之后 + theme_gray() / bw()</div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">为之后的图形设置主题 theme_update()</div><div class="line">theme_update(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>))  <span class="comment"># 标题水平居中</span></div><div class="line">或者赋值为theme1 &lt;- theme_update() ,之后是 theme_set(theme1)</div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">永久性存储主题</div><div class="line">theme1 &lt;- theme_minimal() + theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>), axis.line =element_line(linetype=<span class="number">1</span>))  <span class="comment"># 无坐标线</span></div><div class="line"></div><div class="line">theme2 &lt;- theme_classic() +theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>)) <span class="comment"># 白色背景，无坐标线</span></div><div class="line">theme3 &lt;- theme_gray() + theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>))  <span class="comment"># gray为默认</span></div><div class="line">theme4 &lt;- theme_bw() + theme(plot.title=element_text(hjust=<span class="number">0.5</span>, face=<span class="string">"bold"</span>))</div><div class="line"></div><div class="line">ggplot() + theme_bw</div></pre></td></tr></table></figure>
<p><strong>边界</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 图形边界</span></div><div class="line">plot.margin = unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),<span class="string">"lines"</span>)</div></pre></td></tr></table></figure>
<h3 id="主题元素-元素函数"><a href="#主题元素-元素函数" class="headerlink" title="主题元素+元素函数"></a>主题元素+元素函数</h3><h4 id="主题元素"><a href="#主题元素" class="headerlink" title="主题元素"></a><strong>主题元素</strong></h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">坐标系 - axis. </div><div class="line">axis.line  <span class="comment"># 直线和坐标轴</span></div><div class="line">axis.text.x  <span class="comment"># x/y轴标签</span></div><div class="line">axis.ticks  <span class="comment"># 轴须标签</span></div><div class="line">axis.title.x  <span class="comment"># x/y轴标题</span></div><div class="line">axis.ticks.margin <span class="comment"># 坐标系边界  axis.ticks.margin = unit(0.8,"lines")</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">图例 - legend.</div><div class="line">legend.bakgroud  <span class="comment"># 图例背景</span></div><div class="line">legend.key  <span class="comment"># 图例符号</span></div><div class="line">legend.text  <span class="comment"># 图例标签</span></div><div class="line">legend.title  <span class="comment"># 图例标题</span></div><div class="line">legend.margin  <span class="comment"># 每个图例之间的边界</span></div><div class="line"><span class="comment"># 独立运作</span></div><div class="line">+ theme(legend.position=<span class="string">"none"</span> / <span class="string">"left"</span> /<span class="string">"right"</span>/<span class="string">"bottom"</span>/<span class="string">"top"</span>/=c(n,n) )  <span class="comment"># n为[0,1]</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">面板 - panel.</div><div class="line">panel.backgound  <span class="comment"># 面板背景</span></div><div class="line">panel.border  <span class="comment"># 面板边界</span></div><div class="line">panel.grid.major  <span class="comment"># 主网格线</span></div><div class="line">panel.grid.minor  <span class="comment"># 次网格线</span></div><div class="line">panel.margin	<span class="comment"># 分面绘图区之间的边距</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">整个图形 - plot.</div><div class="line">plot.background  <span class="comment"># 整个图形背景</span></div><div class="line">plot.title  <span class="comment"># 图形标题</span></div><div class="line"></div><div class="line">plot.margin  <span class="comment"># 图形边距 top, right, bottom, left</span></div><div class="line">plot.margin = unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),<span class="string">"lines"</span>)  </div><div class="line"><span class="comment"># 等价于 = unit(rep(1,4),"lines")</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">其他 - strip.</div><div class="line">strip.backgroud  <span class="comment"># 分面标签背景</span></div><div class="line">strip.text.x  <span class="comment"># 水平/竖直条状文本</span></div></pre></td></tr></table></figure>
<h4 id="元素函数"><a href="#元素函数" class="headerlink" title="元素函数"></a><strong>元素函数</strong></h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">文本 - element_text()</div><div class="line"><span class="comment"># 处理标签axis.text.x/axis.ticks、标题plot.title</span></div><div class="line"></div><div class="line">face=<span class="string">""</span>  <span class="comment"># 字体格式</span></div><div class="line"><span class="comment">## "bold.italic"  # 粗斜体</span></div><div class="line"><span class="comment">## "bold"  # 加粗</span></div><div class="line"><span class="comment">## "italic"  # 斜体</span></div><div class="line"><span class="comment">## "plain"  # 无格式的</span></div><div class="line"></div><div class="line">color=<span class="string">""</span></div><div class="line">size=num  <span class="comment"># 文本大小</span></div><div class="line"></div><div class="line">hjust / vjust =[<span class="number">0</span>,<span class="number">1</span>]  <span class="comment"># 水平/竖直对齐</span></div><div class="line"><span class="comment">## hjust=0  # 左对齐</span></div><div class="line"><span class="comment">## hjust=1  # 右对齐</span></div><div class="line"><span class="comment">## hjust=0.5  # 居中对齐</span></div><div class="line"></div><div class="line">lineheight=num  <span class="comment"># 行高</span></div><div class="line">angle=[<span class="number">0</span>,<span class="number">360</span>]  <span class="comment"># 旋转角度</span></div><div class="line">family=<span class="string">""</span>  <span class="comment"># 字族</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">线条 - element_line()  </div><div class="line"><span class="comment">#处理线条axis.line 或线段panel.grid.major/minor</span></div><div class="line"></div><div class="line">size=num</div><div class="line">color=<span class="string">""</span></div><div class="line">linetype=[<span class="number">0</span>,<span class="number">6</span>]</div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">背景 - element_rect() </div><div class="line"><span class="comment"># 处理背景 .background 使用的矩阵</span></div><div class="line"></div><div class="line">linetype=n</div><div class="line">size=num</div><div class="line">color=<span class="string">""</span></div><div class="line">fill=<span class="string">""</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">element_blank()  </div><div class="line"><span class="comment"># 空主题，表示删除的绘图元素</span></div><div class="line"></div><div class="line">主题元素=element_blank()</div></pre></td></tr></table></figure>
<h3 id="一页多图"><a href="#一页多图" class="headerlink" title="一页多图"></a>一页多图</h3><h4 id="组图"><a href="#组图" class="headerlink" title="组图"></a>组图</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(gridExtra)</div><div class="line">grid.arrange(p1,p2,...pn, nrow=n, ncol=n)</div></pre></td></tr></table></figure>
<p><br></p>
<h4 id="子图-viewport-print"><a href="#子图-viewport-print" class="headerlink" title="子图 - viewport()+print"></a>子图 - viewport()+print</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(grid)</div><div class="line">viewport(x=n,y=n,width=n,height=n)  </div><div class="line"><span class="comment"># 设置图形的位置</span></div><div class="line"><span class="comment">## x,y - 控制图形的中心位置，范围[0,1] ，左下角为(0,0)</span></div><div class="line"></div><div class="line"><span class="comment">## width/height - 控制图形的大小，默认为比例大小[0,1]；</span></div><div class="line"><span class="comment">### width=0.5, height=0.5 - 占1/4大小</span></div><div class="line"><span class="comment">### width=1,height=1 - 占整个图形</span></div><div class="line"><span class="comment">## 也可用绝对单位；eg: width = unit(1, "cm") / unit(1, "inch")</span></div><div class="line"></div><div class="line"></div><div class="line">print(p, vp=)</div><div class="line"><span class="comment"># print(要增加子图的图形对象, vp=设置的图形位置对象)</span></div><div class="line"> </div><div class="line">b &lt;- ggplot(economics, aes(uempmed,unemploy)) + geom_point() + geom_smooth(se=<span class="literal">F</span>)</div><div class="line">c &lt;- ggplot(economics, aes(uempmed,unemploy)) + geom_path()</div><div class="line"><span class="keyword">library</span>(grid)</div><div class="line">subvp &lt;- viewport(x=<span class="number">0.75</span>,y=<span class="number">0.35</span>, width=<span class="number">0.4</span>, height=<span class="number">0.4</span>)</div><div class="line">b  <span class="comment"># 显示当前要增加子图的图</span></div><div class="line">print(c, vp=subvp)</div><div class="line"></div><div class="line"><span class="comment">## 若要调整子图的属性，要先在外面调整好，再放入主图中；</span></div><div class="line">  eg: c1 &lt;- c + theme()</div></pre></td></tr></table></figure>
<p><br></p>
<h2 id="属性参考"><a href="#属性参考" class="headerlink" title="属性参考"></a>属性参考</h2><h3 id="几何对象-点-geom-xx"><a href="#几何对象-点-geom-xx" class="headerlink" title="几何对象 - 点 - geom_xx"></a>几何对象 - 点 - geom_xx</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">plot</div><div class="line"><span class="comment"># 点  # + stat_smooth() # 添加平滑曲线</span></div><div class="line">  </div><div class="line">dotplot</div><div class="line"><span class="comment"># 点直方图(用点来表示观测值的个数)</span></div><div class="line"></div><div class="line">jitter</div><div class="line"><span class="comment"># 给点添加扰动(减轻重叠问题)</span></div></pre></td></tr></table></figure>
<h4 id="point-散点图"><a href="#point-散点图" class="headerlink" title="point - 散点图"></a>point - 散点图</h4><h3 id="几何对象-线"><a href="#几何对象-线" class="headerlink" title="几何对象 - 线"></a>几何对象 - 线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">abline</div><div class="line">abline(<span class="keyword">...</span>, slope, intercept, show.legend=<span class="literal">NA</span>)</div><div class="line"><span class="comment"># 线(由斜率和截距决定) 指定的斜率和截距</span></div><div class="line">geom_abline(slope=<span class="number">1</span>, intercept=<span class="number">0</span>, linetyep=<span class="number">2</span>)</div><div class="line"></div><div class="line">hline</div><div class="line"><span class="comment"># 水平线 ; yintercept=n / n1:n2</span></div><div class="line">vline</div><div class="line"><span class="comment"># 竖直线 ; xintercept=</span></div><div class="line"></div><div class="line">----------------------------------------------------------------</div><div class="line">line</div><div class="line">line(x,y, alpha, color, fill, linetype, size, arrow)</div><div class="line"><span class="comment"># 按照x坐标的大小顺序依次连接各个观测值</span></div><div class="line"></div><div class="line"></div><div class="line">path</div><div class="line"><span class="comment"># 路径图(按数据的原始顺序连接各个观测值)</span></div><div class="line">step</div><div class="line"><span class="comment"># 以阶梯形式联接各个观测值</span></div><div class="line"></div><div class="line">----------------------------------------------------------------</div><div class="line">quantile</div><div class="line"><span class="comment"># 添加分位数回归线</span></div><div class="line"></div><div class="line">segment</div><div class="line"><span class="comment"># 添加线段/箭头 </span></div><div class="line"><span class="comment">## geom_segment(aes(x=, xend=, y=, yend= ))</span></div><div class="line"></div><div class="line">smooth</div><div class="line"><span class="comment"># 添加光滑的条件均值线</span></div><div class="line"><span class="comment">## method=smooth(默认) lm-线性; loess-非参数光滑曲线; gam-广义相加模型; glm-广义线性; rlm-健壮线性; </span></div><div class="line"><span class="comment">## formula= y~x （默认） y~log(x);  y~poly(x,n) -n次多项式拟合;  y~ns(x,n) -具有n个自由度的样条拟合</span></div><div class="line"><span class="comment">## se=T/F  绘制置信区间；默认为T</span></div><div class="line"><span class="comment">## level=num 默认为95%</span></div><div class="line"><span class="comment">## fullrange=F/T ,拟合覆盖全图(T)，仅覆盖数据(F) 默认为F</span></div><div class="line"></div><div class="line"></div><div class="line">density</div><div class="line"><span class="comment"># 光滑密度曲线图</span></div><div class="line">density2d</div><div class="line"><span class="comment"># 二维密度等高线图</span></div><div class="line"></div><div class="line">----------------------------------------------------------------</div><div class="line">linerang</div><div class="line">linerang(x,ymin,ymaxn,alpha,color, lineype,size, show.legend=<span class="literal">T</span>/<span class="literal">F</span>)</div><div class="line"><span class="comment"># 一条代表一个区间的竖直线</span></div><div class="line">pointrang</div><div class="line"><span class="comment"># 用一条中间带点的竖直线代表一个区间</span></div></pre></td></tr></table></figure>
<h3 id="几何对象-面"><a href="#几何对象-面" class="headerlink" title="几何对象 - 面"></a>几何对象 - 面</h3><h4 id="bar-条形图"><a href="#bar-条形图" class="headerlink" title="bar - 条形图"></a>bar - 条形图</h4><ul>
<li><strong>先做出x/y轴，再作图，运用stat</strong><ul>
<li>ggplot(temp3, aes(content_rating, M))</li>
<li>last_plot() + geom_bar(stat=”identity”)</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形图(以x轴为底的矩形)</span></div><div class="line"></div><div class="line">图形/位置调整</div><div class="line"><span class="comment"># geom_bar(position="dodge") -分组条形图; (position="fill") -百分比条形图;</span></div><div class="line"></div><div class="line">水平条形图</div><div class="line"><span class="comment"># + coord_flip()</span></div><div class="line"></div><div class="line">堆砌分组条形图（两个类别型变量）</div><div class="line"><span class="comment"># ggplot(hr_good,aes(left,number_project,fill=factor(number_project))) + geom_bar(stat="sum") </span></div><div class="line"></div><div class="line">调整距离宽度与间距; </div><div class="line"><span class="comment"># width=0.5 -也可以看做x坐标轴之间的分割大小; position=position_dodge(0.7)</span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------</div><div class="line">项目排序 -reorder</div><div class="line"><span class="comment"># 按z值的大小，重新排列条形图的顺序，只需将aes()中x的属性用reorder()函数更改即可; </span></div><div class="line"><span class="comment">## ggplot(df, aes(x = reorder(x, z), y = z, fill = y)) +geom_bar(stat = 'identity') + xlab('x')</span></div><div class="line"></div><div class="line">项目排序 -降序排序</div><div class="line"><span class="comment"># 1. arrange(data, M)  升序排列</span></div><div class="line"><span class="comment"># 2. data$M &lt;- factor(data$M, order=T, levels=data$M))  # 因子化 / data$M &lt;- with(data, factor(var, order=T, levels=var))</span></div><div class="line"></div><div class="line">项目排序 -如果x是因子，我们可以对其用带参数limits=rev(levels(…))的函数scale_x_discrete()进行修正。</div><div class="line"><span class="comment">##  + coord_flip() + scale_x_discrete(limits=rev(levels(PlantGrowth$group)))</span></div><div class="line">项目排序 -直接修正</div><div class="line"><span class="comment"># 直接用scale_x_discrete(limits=c()) 来修正顺序</span></div><div class="line"></div><div class="line">-----------------------------------------------------------------------</div><div class="line">添加标签</div><div class="line"><span class="comment"># geom_text(aes(label=var))</span></div><div class="line"><span class="comment">## hjust/vjust=-0.2 -表示显示在外面;  hjust/vjust=1.5 -表示显示在里面</span></div><div class="line"></div><div class="line">添加标签 -对于分组条形图</div><div class="line"><span class="comment"># geom_text(position = position_dodge(0.9))</span></div><div class="line">添加标签 -对于堆积条形图</div><div class="line"><span class="comment"># geom_text(position = position_stack())</span></div></pre></td></tr></table></figure>
<h4 id="histogram-直方图"><a href="#histogram-直方图" class="headerlink" title="histogram - 直方图"></a>histogram - 直方图</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">调整组距：</div><div class="line"><span class="comment"># 1)binwidth=n  # 组距宽度；也可以看做x坐标轴之间的分割大小</span></div><div class="line"><span class="comment"># 2)bins=n  # 组的数量</span></div><div class="line"><span class="comment"># 3)breaks=c(n, n, n)  # 具体的x轴坐标尺度来划分</span></div><div class="line"></div><div class="line">调整分组直方图两者之间重叠程度</div><div class="line"><span class="comment"># position=position_dodge(0.5)</span></div><div class="line"></div><div class="line">密度直方图</div><div class="line"><span class="comment"># histogram(aes(y=..density))</span></div><div class="line">在密度直方图基础上，添加核密度曲线</div><div class="line"><span class="comment">## stat_density(geom="line")</span></div></pre></td></tr></table></figure>
<h4 id="其他面图"><a href="#其他面图" class="headerlink" title="其他面图"></a>其他面图</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">boxplot</div><div class="line"><span class="comment"># 箱线图</span></div><div class="line"></div><div class="line">area</div><div class="line"><span class="comment"># 面积图</span></div><div class="line"></div><div class="line">freqplot</div><div class="line"><span class="comment"># 频率多边形图</span></div></pre></td></tr></table></figure>
<h3 id="几何对象-非常规图形"><a href="#几何对象-非常规图形" class="headerlink" title="几何对象 - 非常规图形"></a>几何对象 - 非常规图形</h3><h4 id="漏斗图"><a href="#漏斗图" class="headerlink" title="漏斗图"></a>漏斗图</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 漏斗图  </span></div><div class="line"><span class="comment"># 涉及概念 </span></div><div class="line"><span class="comment"># 1.占位数 = （上阶段人数 - 当前人数）/2</span></div><div class="line"><span class="comment"># 2.环节转化率 =当前人数/上阶段人数；</span></div><div class="line"><span class="comment"># 3.整体转化率 = 当前人数 / 总人数</span></div></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 思路1，利用占位符；条形图</span></div><div class="line">---------------------------test----------------------------------------------------</div><div class="line"><span class="keyword">library</span>(reshape2)</div><div class="line">scope&lt;-c(<span class="number">0.9</span>,<span class="number">0.8</span>,<span class="number">0.6</span>,<span class="number">0.4</span>,<span class="number">0.2</span>)</div><div class="line">Part&lt;-paste(<span class="string">"part"</span>,<span class="number">1</span>:<span class="number">5</span>,sep=<span class="string">""</span>)</div><div class="line">Order&lt;-<span class="number">1</span>:<span class="number">5</span> </div><div class="line">help&lt;-(<span class="number">1</span>-scope)/<span class="number">2</span>  <span class="comment"># 表示该值为 两边留空的二分之一</span></div><div class="line">mydata&lt;-data.frame(Order,Part,help,scope)</div><div class="line"> Order  Part help scope</div><div class="line"><span class="number">1</span>     <span class="number">1</span> part1 <span class="number">0.05</span>   <span class="number">0.9</span></div><div class="line"><span class="number">2</span>     <span class="number">2</span> part2 <span class="number">0.10</span>   <span class="number">0.8</span></div><div class="line"><span class="number">3</span>     <span class="number">3</span> part3 <span class="number">0.20</span>   <span class="number">0.6</span></div><div class="line"><span class="number">4</span>     <span class="number">4</span> part4 <span class="number">0.30</span>   <span class="number">0.4</span></div><div class="line"><span class="number">5</span>     <span class="number">5</span> part5 <span class="number">0.40</span>   <span class="number">0.2</span></div><div class="line"></div><div class="line"><span class="comment"># 重构为长格式</span></div><div class="line">mydata1&lt;-melt(mydata,id.vars=c(<span class="string">"Order"</span>,<span class="string">"Part"</span>),variable.name=<span class="string">"perform"</span>,value.name=<span class="string">"scope"</span>)</div><div class="line">   Order  Part perform scope</div><div class="line"><span class="number">1</span>      <span class="number">1</span> part1    help  <span class="number">0.05</span></div><div class="line"><span class="number">2</span>      <span class="number">2</span> part2    help  <span class="number">0.10</span></div><div class="line"><span class="number">3</span>      <span class="number">3</span> part3    help  <span class="number">0.20</span></div><div class="line"><span class="number">4</span>      <span class="number">4</span> part4    help  <span class="number">0.30</span></div><div class="line"><span class="number">5</span>      <span class="number">5</span> part5    help  <span class="number">0.40</span></div><div class="line"><span class="number">6</span>      <span class="number">1</span> part1   scope  <span class="number">0.90</span></div><div class="line"><span class="number">7</span>      <span class="number">2</span> part2   scope  <span class="number">0.80</span></div><div class="line"><span class="number">8</span>      <span class="number">3</span> part3   scope  <span class="number">0.60</span></div><div class="line"><span class="number">9</span>      <span class="number">4</span> part4   scope  <span class="number">0.40</span></div><div class="line"><span class="number">10</span>     <span class="number">5</span> part5   scope  <span class="number">0.20</span></div><div class="line"><span class="comment"># 构造有序因子变量，两个因子水平，分别是实际指标值和辅助值</span></div><div class="line"><span class="comment"># 【关键1】在构造有序因子变量时，注意辅助值因子水平要高于实际值数据。柱形图堆叠时，【关键2】按照因子水平由高到低堆叠（底层因子水平高，顶层因子水平低，这样才能将指标值的数据条撑起，其实水平均居中）。</span></div><div class="line">mydata1$perform&lt;-factor(mydata1$perform,level=c(<span class="string">"scope"</span>,<span class="string">"help"</span>),order=<span class="literal">T</span>)   </div><div class="line"></div><div class="line">-----------------------------绘制图形--------------------------</div><div class="line">ggplot(mydata1,aes(Order,scope,order=desc(scope),fill=perform))+geom_bar(stat=<span class="string">"identity"</span>,position=<span class="string">"stack"</span>)  <span class="comment"># 即先堆叠高水平help，然后再堆叠低水平scope；</span></div><div class="line"></div><div class="line"><span class="comment"># 制作色盘：（其实使用了一个白色色值隐藏掉了辅助列，理念跟在excel里面制作漏斗图一致，但是色盘颜色顺序白色要在第一个，这样将来颜色映射的时候颜色顺序与因子水平由大到小进行匹配的。）这一点非常重要，也是ggplot临摹漏斗图的核心技巧。</span></div><div class="line">Color&lt;-c(<span class="string">"#FFFFFF"</span>,<span class="string">"#088158"</span>)</div><div class="line">ggplot()+</div><div class="line">geom_bar(data=mydata1,aes(x=Order,y=scope,fill=perform),stat=<span class="string">"identity"</span>,position=<span class="string">"stack"</span>)+</div><div class="line">scale_fill_manual(values=sort(Color))+   <span class="comment"># sort表示重新排序；因为颜色的填充是低水平(scope)，在高水平(help)进行填充</span></div><div class="line">geom_text(data=mydata,aes(x=Order,y=help+scope/<span class="number">2</span>-<span class="number">.025</span>,label=Part),col=<span class="string">"white"</span>,size=<span class="number">4</span>)+</div><div class="line">geom_text(data=mydata,aes(x=Order,y=help+scope/<span class="number">2</span>+<span class="number">.035</span>,label=paste(<span class="number">100</span>*mydata$scope,<span class="string">"%"</span>,sep=<span class="string">""</span>)),col=<span class="string">"white"</span>,size=<span class="number">5.5</span>)+</div><div class="line">theme_nothing()</div><div class="line"></div><div class="line"></div><div class="line">ggplot()+</div><div class="line">geom_bar(data=mydata1,aes(x=Order,y=scope,fill=perform),stat=<span class="string">"identity"</span>,position=<span class="string">"stack"</span>)+</div><div class="line">scale_fill_manual(values=sort(Color))+ </div><div class="line">coord_flip()+  scale_x_reverse() +   <span class="comment"># 顺时针旋转</span></div><div class="line">geom_text(data=mydata,aes(x=Order,y=help+scope/<span class="number">2</span>-<span class="number">.05</span>,label=Part),col=<span class="string">"white"</span>,size=<span class="number">4</span>)+  <span class="comment"># 标签位置设定</span></div><div class="line">geom_text(data=mydata,aes(x=Order,y=help+scope/<span class="number">2</span>+<span class="number">.05</span>,label=paste(<span class="number">100</span>*mydata$scope,<span class="string">"%"</span>,sep=<span class="string">""</span>)),col=<span class="string">"white"</span>,size=<span class="number">5.5</span>)+</div><div class="line">theme_nothing()</div></pre></td></tr></table></figure>
<p>–<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 思路2，利用箱线图</span></div><div class="line">set.seed(<span class="number">123</span>) <span class="comment">#设定随机种子，保证做的图和这里的一样</span></div><div class="line">df &lt;- data.frame(</div><div class="line">  var=LETTERS[<span class="number">1</span>:<span class="number">10</span>], <span class="comment">#字母A-J</span></div><div class="line">  id=<span class="number">1</span>:<span class="number">10</span>, <span class="comment">#数字1-10</span></div><div class="line">  a=runif(<span class="number">10</span>), <span class="comment">#10个随机数</span></div><div class="line">  b=runif(<span class="number">10</span>), <span class="comment">#10个随机数</span></div><div class="line">  c=runif(<span class="number">10</span>), <span class="comment">#10个随机数</span></div><div class="line">  stringsAsFactors = <span class="literal">F</span> <span class="comment">#不转换为因子)</span></div><div class="line">    var id         a          b         c</div><div class="line"><span class="number">1</span>    A  <span class="number">1</span> <span class="number">0.2875775</span> <span class="number">0.95683335</span> <span class="number">0.8895393</span></div><div class="line"><span class="number">2</span>    B  <span class="number">2</span> <span class="number">0.7883051</span> <span class="number">0.45333416</span> <span class="number">0.6928034</span></div><div class="line"><span class="number">3</span>    C  <span class="number">3</span> <span class="number">0.4089769</span> <span class="number">0.67757064</span> <span class="number">0.6405068</span></div><div class="line"><span class="number">4</span>    D  <span class="number">4</span> <span class="number">0.8830174</span> <span class="number">0.57263340</span> <span class="number">0.9942698</span></div><div class="line"><span class="number">5</span>    E  <span class="number">5</span> <span class="number">0.9404673</span> <span class="number">0.10292468</span> <span class="number">0.6557058</span></div><div class="line"><span class="number">6</span>    <span class="literal">F</span>  <span class="number">6</span> <span class="number">0.0455565</span> <span class="number">0.89982497</span> <span class="number">0.7085305</span></div><div class="line"><span class="number">7</span>    G  <span class="number">7</span> <span class="number">0.5281055</span> <span class="number">0.24608773</span> <span class="number">0.5440660</span></div><div class="line"><span class="number">8</span>    H  <span class="number">8</span> <span class="number">0.8924190</span> <span class="number">0.04205953</span> <span class="number">0.5941420</span></div><div class="line"><span class="number">9</span>    I  <span class="number">9</span> <span class="number">0.5514350</span> <span class="number">0.32792072</span> <span class="number">0.2891597</span></div><div class="line"><span class="number">10</span>   J <span class="number">10</span> <span class="number">0.4566147</span> <span class="number">0.95450365</span> <span class="number">0.1471136</span></div><div class="line"></div><div class="line">df_tmp4&lt;-df %&gt;% select(<span class="number">1</span>:<span class="number">3</span>) %&gt;% arrange(a) %&gt;% </div><div class="line">  mutate(new_id=<span class="number">1</span>:<span class="number">10</span>,  <span class="comment"># 创建新变量，以此为排序</span></div><div class="line">         ymin = (<span class="number">1</span>-a)/<span class="number">2</span>,  <span class="comment"># 最小值，左边留空的值</span></div><div class="line">         ymax = a+(<span class="number">1</span>-a)/<span class="number">2</span>,  <span class="comment"># 最大值，右边留空的值</span></div><div class="line">         mid = <span class="number">0.5</span>)</div><div class="line">  var id         a new_id       ymin      ymax mid</div><div class="line"><span class="number">1</span>    <span class="literal">F</span>  <span class="number">6</span> <span class="number">0.0455565</span>      <span class="number">1</span> <span class="number">0.47722175</span> <span class="number">0.5227782</span> <span class="number">0.5</span></div><div class="line"><span class="number">2</span>    A  <span class="number">1</span> <span class="number">0.2875775</span>      <span class="number">2</span> <span class="number">0.35621124</span> <span class="number">0.6437888</span> <span class="number">0.5</span></div><div class="line"><span class="number">3</span>    C  <span class="number">3</span> <span class="number">0.4089769</span>      <span class="number">3</span> <span class="number">0.29551154</span> <span class="number">0.7044885</span> <span class="number">0.5</span></div><div class="line"><span class="number">4</span>    J <span class="number">10</span> <span class="number">0.4566147</span>      <span class="number">4</span> <span class="number">0.27169263</span> <span class="number">0.7283074</span> <span class="number">0.5</span></div><div class="line"><span class="number">5</span>    G  <span class="number">7</span> <span class="number">0.5281055</span>      <span class="number">5</span> <span class="number">0.23594726</span> <span class="number">0.7640527</span> <span class="number">0.5</span></div><div class="line"><span class="number">6</span>    I  <span class="number">9</span> <span class="number">0.5514350</span>      <span class="number">6</span> <span class="number">0.22428249</span> <span class="number">0.7757175</span> <span class="number">0.5</span></div><div class="line"><span class="number">7</span>    B  <span class="number">2</span> <span class="number">0.7883051</span>      <span class="number">7</span> <span class="number">0.10584743</span> <span class="number">0.8941526</span> <span class="number">0.5</span></div><div class="line"><span class="number">8</span>    D  <span class="number">4</span> <span class="number">0.8830174</span>      <span class="number">8</span> <span class="number">0.05849130</span> <span class="number">0.9415087</span> <span class="number">0.5</span></div><div class="line"><span class="number">9</span>    H  <span class="number">8</span> <span class="number">0.8924190</span>      <span class="number">9</span> <span class="number">0.05379048</span> <span class="number">0.9462095</span> <span class="number">0.5</span></div><div class="line"><span class="number">10</span>   E  <span class="number">5</span> <span class="number">0.9404673</span>     <span class="number">10</span> <span class="number">0.02976636</span> <span class="number">0.9702336</span> <span class="number">0.5</span></div><div class="line"></div><div class="line">---------------------------------------------</div><div class="line">ggplot(df_tmp4,aes(new_id,mid)) +  <span class="comment"># x轴为对应的各个指标</span></div><div class="line">  geom_linerange(aes(ymin=ymin,ymax=ymax,</div><div class="line">                     colour=factor(new_id)),</div><div class="line">                size=<span class="number">15</span>,</div><div class="line">                alpha=<span class="number">0.5</span>,show.legend = <span class="literal">F</span>)+</div><div class="line">  scale_x_continuous(breaks = <span class="number">1</span>:<span class="number">10</span>,</div><div class="line">                     labels = df_tmp4$var)+</div><div class="line">  coord_flip()</div><div class="line">  </div><div class="line">  </div><div class="line">-------------------------------------------  </div><div class="line">ggplot(df_tmp4,aes(new_id,mid))+  <span class="comment">#  geom_step(colour="grey50")+</span></div><div class="line">  geom_crossbar(aes(ymin=ymin,ymax=ymax),</div><div class="line">                size=<span class="number">0</span>,</div><div class="line">                fill=<span class="string">"skyblue"</span>,  </div><div class="line">                colour=<span class="string">"grey50"</span>,</div><div class="line">                width=<span class="number">1</span>)+</div><div class="line">  scale_x_continuous(breaks = <span class="number">1</span>:<span class="number">10</span>,</div><div class="line">                     labels = df_tmp4$var)+</div><div class="line">  coord_flip()</div></pre></td></tr></table></figure></p>
<h4 id="其他图形"><a href="#其他图形" class="headerlink" title="其他图形"></a>其他图形</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">errorbar</div><div class="line"><span class="comment"># 误差棒</span></div><div class="line">errorbarh</div><div class="line"><span class="comment"># 水平误差棒</span></div><div class="line"></div><div class="line">rug</div><div class="line"><span class="comment"># 边际地毯图(轴须图)</span></div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">blank</div><div class="line"><span class="comment"># 空白</span></div><div class="line"></div><div class="line">contor</div><div class="line"><span class="comment"># 等高线图</span></div><div class="line"></div><div class="line">crossbar</div><div class="line"><span class="comment"># 带水平中心线的盒子图</span></div><div class="line"></div><div class="line">hex</div><div class="line"><span class="comment"># 六边形二维热点图</span></div><div class="line"></div><div class="line">map</div><div class="line"><span class="comment"># 基准地图里多边形</span></div><div class="line"></div><div class="line">ploygon</div><div class="line"><span class="comment"># 多边型(相当于一个有填充的路径)</span></div><div class="line"></div><div class="line">raster</div><div class="line"><span class="comment"># 高效的矩形瓦片图</span></div><div class="line"></div><div class="line">rect</div><div class="line"><span class="comment"># 二维矩阵图</span></div><div class="line"></div><div class="line">ribbon</div><div class="line"><span class="comment"># 色带图(连续的x值所对应y的范围)</span></div><div class="line"></div><div class="line">violin</div><div class="line"><span class="comment"># 小提琴图</span></div><div class="line"></div><div class="line">tile</div><div class="line"><span class="comment"># 瓦片图</span></div></pre></td></tr></table></figure>
<h3 id="text-文本注释"><a href="#text-文本注释" class="headerlink" title="text - 文本注释"></a>text - 文本注释</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">geom_text()</div><div class="line">geom_text(aes(label=var)) / geom_text(aes(label=rownames(var)))</div><div class="line"> (x,y, alpha=, color=, size=, hjust=, vjust=,,nudge_x=<span class="number">0</span>,nugde_y=<span class="number">0</span>, angle=, fontface=, family=, lineheight=, show.legend=<span class="literal">NA</span>/<span class="literal">F</span>/<span class="literal">T</span>, check_overlap=<span class="literal">F</span>, na.rm=<span class="literal">F</span> )</div><div class="line"></div><div class="line"><span class="comment"># hjust=0(右侧)，=1(左侧)，=0.5(居中，默认)；若小于0，则继续向右</span></div><div class="line"><span class="comment"># vjust=0(向上)，=1(向下), =0.5(居中，默认); 若小于0，则继续向上；</span></div><div class="line"><span class="comment">## vjust/yjust ，可以是 0(right/bottom) 和 1(left/top)，或者是字符串("left","right","middle","bottom","center","top"); 或者是 字符串 ("inward","outward")</span></div><div class="line"><span class="comment">## nudge_x=2.5 ，x轴方向，向右微调2.5</span></div><div class="line"><span class="comment"># 常用字体大小 size=4 ; 5.5; </span></div><div class="line"></div><div class="line"><span class="comment">## 标签显示为百分比</span></div><div class="line">label=paste(<span class="number">100</span>*mydata$scope,<span class="string">"%"</span>,sep=<span class="string">""</span>)</div><div class="line"><span class="comment"># ggplot() + geom_text(data=mydata,aes(x=Order,y=help+scope/2+.035,label=paste(100*mydata$scope,"%",sep="")),col="white",size=5.5)</span></div><div class="line"></div><div class="line">p &lt;- ggplot(mtcars, aes(x=wt, y=mpg, label=rownames(mtcars)))</div><div class="line">p + geom_text()</div><div class="line">p + geom_text(size=<span class="number">10</span>) <span class="comment"># Change size of the label[变更标签的大小]</span></div><div class="line">p &lt;- p + geom_point()</div><div class="line"></div><div class="line"><span class="comment"># Set aesthetics to fixed value[设置为固定值的美学]</span></div><div class="line">p + geom_text()</div><div class="line">p + geom_point() + geom_text(hjust=<span class="number">0</span>, vjust=<span class="number">0</span>)</div><div class="line">p + geom_point() + geom_text(angle = <span class="number">45</span>)</div><div class="line"></div><div class="line"><span class="comment"># Add aesthetic mappings[审美映射]</span></div><div class="line">p + geom_text(aes(colour=factor(cyl)))</div><div class="line">p + geom_text(aes(colour=factor(cyl))) + scale_colour_discrete(l=<span class="number">40</span>)</div><div class="line"></div><div class="line">p + geom_text(aes(size=wt))</div><div class="line">p + geom_text(aes(size=wt)) + scale_size(range=c(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Add an annotation not from a variable source[添加注释，而不是从一个变量源]</span></div><div class="line">c &lt;- ggplot(mtcars, aes(wt, mpg)) + geom_point()</div><div class="line">c + geom_text(data = <span class="literal">NULL</span>, x = <span class="number">5</span>, y = <span class="number">30</span>, label = <span class="string">"plot mpg vs. wt"</span>)</div><div class="line"><span class="comment"># Or, you can use annotate[或者，您可以使用注释]</span></div><div class="line">c + annotate(<span class="string">"text"</span>, label = <span class="string">"plot mpg vs. wt"</span>, x = <span class="number">2</span>, y = <span class="number">15</span>, size = <span class="number">8</span>, colour = <span class="string">"red"</span>)</div><div class="line"></div><div class="line"></div><div class="line">---------------------------------------------------------------------------------------</div><div class="line">geom_label() </div><div class="line"><span class="comment"># draws a rectangle behind the text, making it easier to read.</span></div></pre></td></tr></table></figure>
<blockquote>
<p>aes(label=rownames(var)) 可在任何几何对象中出现</p>
<blockquote>
<p>geom_point(aes(laber=rownames(var)))</p>
</blockquote>
</blockquote>
<h3 id="图形属性"><a href="#图形属性" class="headerlink" title="图形属性"></a>图形属性</h3><h4 id="linetype"><a href="#linetype" class="headerlink" title="linetype"></a>linetype</h4><table>
<thead>
<tr>
<th style="text-align:center">符号</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>1</strong></td>
<td style="text-align:center"><strong>solid - 实线</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>2</strong></td>
<td style="text-align:center"><strong>dashed - 虚线</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>3</strong></td>
<td style="text-align:center"><strong>dotted - 点</strong></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">dotdash - 破折号</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">longdash - 长破折号</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">twodash - 双破折号</td>
</tr>
</tbody>
</table>
<h4 id="position"><a href="#position" class="headerlink" title="position"></a>position</h4><table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>stack</strong></td>
<td><strong>堆叠</strong></td>
<td>堆砌条形图</td>
</tr>
<tr>
<td><strong>fill</strong></td>
<td><strong>堆叠并高度标准化为1</strong></td>
<td>百分比堆砌条形图</td>
</tr>
<tr>
<td><strong>dodge</strong></td>
<td><strong>避免重叠，并排放置</strong></td>
<td>分组条形图</td>
</tr>
<tr>
<td><strong>jitter</strong></td>
<td><strong>给点添加扰动，避免重叠</strong></td>
<td></td>
</tr>
<tr>
<td><strong>identity</strong></td>
<td><strong>不做任何调整</strong></td>
</tr>
</tbody>
</table>
<blockquote>
<p>identity ，不适合条形图，因为后面画的条形会挡住先画的</p>
</blockquote>
<h4 id="side"><a href="#side" class="headerlink" title="side"></a>side</h4><p>地毯图geom_rug的位置；</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>b</td>
<td>底部</td>
</tr>
<tr>
<td>l</td>
<td>左侧</td>
</tr>
<tr>
<td>r</td>
<td>右侧</td>
</tr>
<tr>
<td>t</td>
<td>顶部</td>
</tr>
<tr>
<td>bl</td>
<td>左下</td>
</tr>
<tr>
<td>“tl” 、 “tr”、”br”</td>
<td>左上、右上、右下</td>
</tr>
</tbody>
</table>
<h4 id="shape"><a href="#shape" class="headerlink" title="shape"></a>shape</h4><p><img src="http://chf2012.oss-cn-hangzhou.aliyuncs.com/daily_pic/S软件应用_r图形属性_线条+形状+位置.png" alt=""></p>
<h4 id="fontface"><a href="#fontface" class="headerlink" title="fontface"></a>fontface</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fontface= <span class="string">"plain"</span>, <span class="string">"italic"</span>, <span class="string">"bold"</span>, <span class="string">"bold.italic"</span></div></pre></td></tr></table></figure>
<p><br></p>
<h3 id="统计变换"><a href="#统计变换" class="headerlink" title="统计变换"></a>统计变换</h3><p><strong>常用统计变换</strong></p>
<table>
<thead>
<tr>
<th>统计变换</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>stat_identity</strong></td>
<td><strong>不做任何统计变换</strong></td>
</tr>
<tr>
<td>stat_boxplot</td>
<td>计算组成箱线图的各种元素值</td>
</tr>
<tr>
<td>stat_density</td>
<td>一维密度估计</td>
</tr>
<tr>
<td>stat_density2d</td>
<td>二维密度估计</td>
</tr>
<tr>
<td>stat_smooth</td>
<td>添加拟合曲线</td>
</tr>
<tr>
<td><strong>stat_summary</strong></td>
<td><strong>对每个x所对应的y值做统计描述</strong></td>
</tr>
<tr>
<td>stat_unique</td>
<td>删除重复值</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>stat_bin</strong></td>
<td><strong>count - 直方图</strong></td>
</tr>
<tr>
<td></td>
<td><strong>density - 频率多边形图</strong></td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">密度直方图</div><div class="line"><span class="comment"># ggplot(diamonds, aes(carat)) + geom_histogram(aes(y=..density..), binwidth=0.1)  </span></div><div class="line"></div><div class="line"></div><div class="line">添加拟合曲线</div><div class="line"><span class="comment"># p &lt;- ggplot(diamonds, aes(x=carat,y=price,color=cut))</span></div><div class="line"><span class="comment"># p + geom_point(color='green',alpha=0.2)+ stat_smooth()</span></div></pre></td></tr></table></figure>
<p><strong>统计变换 stat_xx</strong></p>
<table>
<thead>
<tr>
<th>统计变换</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>stat_bin</td>
<td>计算封箱(bin)数据</td>
</tr>
<tr>
<td>bin2d</td>
<td>计算封箱内的观测值个数</td>
</tr>
<tr>
<td>bindot</td>
<td>计算“点直方图”封箱数据</td>
</tr>
<tr>
<td>binhex</td>
<td>计算“六边形热图”封箱数据</td>
</tr>
<tr>
<td>boxplot</td>
<td>计算组成箱线图的各种元素值</td>
</tr>
<tr>
<td>contour</td>
<td>三维数据的等高线</td>
</tr>
<tr>
<td>density</td>
<td>一维密度估计</td>
</tr>
<tr>
<td>density2d</td>
<td>二维密度估计</td>
</tr>
<tr>
<td>function</td>
<td>添加新的函数</td>
</tr>
<tr>
<td><strong>identity</strong></td>
<td><strong>不对数据进行统计变换</strong></td>
</tr>
<tr>
<td>qq</td>
<td>计算qq图的相关值</td>
</tr>
<tr>
<td><strong>quantile</strong></td>
<td><strong>计算连续的分位数</strong></td>
</tr>
<tr>
<td><strong>smooth</strong></td>
<td><strong>添加光滑曲线</strong></td>
</tr>
<tr>
<td>spoke</td>
<td>将角度和半径转换成xend和yend</td>
</tr>
<tr>
<td>sum</td>
<td>计算每个单一值的频数[有助于解决散点图的图形重叠问题]</td>
</tr>
<tr>
<td>summary</td>
<td>对每个x对应的y值做统计描述</td>
</tr>
<tr>
<td>summary2d</td>
<td>对二维矩形封箱设定函数</td>
</tr>
<tr>
<td>summaryhex</td>
<td>对二维六边形封箱设定函数</td>
</tr>
<tr>
<td>unique</td>
<td>删除重复值</td>
</tr>
<tr>
<td>ydensity</td>
<td>小提琴图，计算一维y轴方向的核密度函数的估计值</td>
</tr>
</tbody>
</table>
<h2 id="作图规范"><a href="#作图规范" class="headerlink" title="作图规范"></a>作图规范</h2><p><strong>标准作图规范</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">ggplot(mtcars, aes(disp,hp))  <span class="comment"># 绘制对象(数据，图形属性aes)</span></div><div class="line"> </div><div class="line">+ geom_point(aes(color=factor(cyl)))  <span class="comment"># 图层(几何对象)-设定;若要分组，必须为因子factor变量</span></div><div class="line">     <span class="comment"># geom_point(color="blue")  # 图层(几何对象)-映射</span></div><div class="line">     <span class="comment"># stat_(） # 统计变化</span></div><div class="line">  </div><div class="line">+ goem_text(aes(label=cyl, color=cyl), size=, vjust=<span class="number">0.5</span>,hjust=<span class="number">0.5</span>,nudge_x=<span class="number">0.5</span>, nudge_y=<span class="number">0.5</span>, show.length=<span class="literal">F</span>)  <span class="comment"># 标签; hjust=0(向右),vjust=0(向上); nudge_x=0.5 向x轴方向微调0.5</span></div><div class="line"></div><div class="line">+ annotate(<span class="string">"text"</span>, x = <span class="number">4</span>, y = <span class="number">25</span>, label = <span class="string">"Some text"</span>)</div><div class="line"></div><div class="line">+ xlim(<span class="number">0</span>,<span class="number">10</span>)  <span class="comment"># x轴的定义域，表示只选取该范围内的数值进行作图；超出部分则删除; </span></div><div class="line">    <span class="comment"># xlim(0,max(mtcars$disp))  # 必须有data$var</span></div><div class="line">    <span class="comment"># xlim("a","b","c")  # 离散型</span></div><div class="line">    <span class="comment"># xlim(as.Date(c("2008-05-01","2008-08-01"))  # 日期型</span></div><div class="line">  </div><div class="line">+ sacle_y_continuous(</div><div class="line">      limits=c(min(mtcars$hp),<span class="number">300</span>),</div><div class="line">      breaks=c(<span class="number">100</span>,<span class="number">150</span>,<span class="number">400</span>),  <span class="comment"># =c(seq(0,200,20))  指定坐标轴上应显示哪些刻度线的值 或一个连续型标度在一个图例中将被如何分段（即显示哪些刻度的值）</span></div><div class="line">      labels=c(<span class="string">"100k"</span>,<span class="string">"150k"</span>,<span class="string">"400k"</span>)   <span class="comment"># 指定了应在断点处显示的标签</span></div><div class="line">   </div><div class="line">+ labs(x=<span class="string">""</span>, y=<span class="string">""</span>, title=<span class="string">""</span>, subtitle=<span class="string">""</span>)  <span class="comment"># 坐标轴的标签名称</span></div><div class="line">  </div><div class="line">+ scale_x_discrete(breaks=rev(levels(mtcars$hp)))  <span class="comment"># 转置</span></div><div class="line">    <span class="comment"># scale_x_reverse()  # 转置-连续型变量</span></div><div class="line">  </div><div class="line">+ scale_y_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">30</span>)) +  scale_x_continuous(breaks=seq(<span class="number">0</span>, <span class="number">420</span>, <span class="number">15</span>))</div><div class="line"><span class="comment"># 设置x/y轴显示的相对比例; 同 coord_equal(ratio=)</span></div><div class="line"> </div><div class="line">+ sacle_color_brewer(palette=<span class="string">""</span>) + scale_fill_hue() <span class="comment"># 离散型标度的颜色设置 </span></div><div class="line">    <span class="comment">#  scale_color_manual(values=c())  手动自定义设置颜色</span></div><div class="line">    <span class="comment"># scale_color_gradient（low="", high="")  连续型标度的颜色设置； 双色；</span></div><div class="line">  </div><div class="line">+ guides(fill=guide_legend((title=, title.position=<span class="string">"top"</span>,label.position=<span class="string">"top"</span>, nrow=<span class="number">2</span>,reverse=<span class="literal">F</span>)  <span class="comment"># 设置图例</span></div><div class="line">    <span class="comment"># guides(fill=FALSE)  删除图例</span></div><div class="line">  </div><div class="line"> + facet_grid(.~ y, margins=<span class="literal">T</span>, space=<span class="string">"fixed"</span>)  <span class="comment"># 网格型分面 margins=c("col","col") 所需展示的边界图的变量</span></div><div class="line">    <span class="comment"># facet_wrap(~y, ncol=2, scales="free_x")  # 封装型分面</span></div><div class="line"></div><div class="line">+ coord_flip()  <span class="comment"># 坐标轴翻转</span></div><div class="line">+ coord_equal(ratio=<span class="number">2</span>, xlim, ylim)    y/x轴的比例</div><div class="line">                           </div><div class="line">+ theme1  <span class="comment"># theme1 &lt;- theme_minimal() + theme(plot.title=element_text(hjust=0.5, face="bold"), axis.line =element_line(linetype=1))</span></div><div class="line">+ theme(axis.line=element_line(linetype=<span class="number">1</span>,size=<span class="number">1</span>), axis.title.x=element_text(), panel.grid.minor=element_blank(), plot.title=element_text(face=<span class="string">"bold"</span>,size=, hjust=<span class="number">0.5</span>), plot.background=element_rect(fill=,color=))  <span class="comment"># theme(主题元素= 主题性质) axis/legend/panel/plot/strip</span></div><div class="line"></div><div class="line">+ plot.margin = unit(c(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),<span class="string">"lines"</span>)  <span class="comment"># 图形边界 top/right/bottom/left</span></div><div class="line">                           </div><div class="line">grid.arrange(p1,p2,...pn, nrow=<span class="number">2</span>)  <span class="comment"># library(gridExtra) 组图</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">--------------------------------------------------------------------</div><div class="line">ggplot(data=, aes(x=, y= )) +</div><div class="line">	geom_xx(<span class="keyword">...</span>) + stat_xx(<span class="keyword">...</span>) + </div><div class="line">	annotate(<span class="keyword">...</span>) + </div><div class="line">	scale_xx(<span class="keyword">...</span>) + coord_xx(<span class="keyword">...</span>) + guides(<span class="keyword">...</span>) + theme(<span class="keyword">...</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># mtcars，R中自带的数据集</span></div></pre></td></tr></table></figure>
<p><strong>可对图形分别进行设定与修改 - 基础图形可被保存</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">创建绘图对象</div><div class="line"><span class="comment"># p &lt;- ggplot(mtcars, aes(x=mpg, y=wt))</span></div><div class="line"></div><div class="line">设定与修改</div><div class="line">p + geom_point(aes(colour=factor(cyl))</div><div class="line">p + geom_point(aes(y=disp))</div></pre></td></tr></table></figure>
<p>–</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">做不同运算的图形</div><div class="line"><span class="comment"># ggplot(huron, aes(year))</span></div><div class="line">+ geom_line(aes(y=level-<span class="number">5</span>), color=<span class="string">"blue"</span>)</div><div class="line">+ geom_line(aes(y=level-<span class="number">5</span>), color=<span class="string">"red"</span>)</div></pre></td></tr></table></figure>
<h2 id="作图问题"><a href="#作图问题" class="headerlink" title="作图问题"></a>作图问题</h2><h3 id="图形基本处理"><a href="#图形基本处理" class="headerlink" title="图形基本处理"></a>图形基本处理</h3><ul>
<li>矢量图形(PDF, PostScript, SVG，AI,) </li>
<li>位图(PNG, JPEG, TIFF，bmp，jpg)</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">summary()  <span class="comment"># 查看结构</span></div><div class="line"></div><div class="line">print()  <span class="comment"># 呈现</span></div><div class="line"></div><div class="line"></div><div class="line">-----------------------------------------------------------------------------------</div><div class="line">保存</div><div class="line">ggsave()  <span class="comment"># 保存到磁盘</span></div><div class="line">--ggsave(<span class="string">"name.png"</span>, [plot=plot_name] width=, height=)  </div><div class="line"><span class="comment"># plot_name为创建图像的名称；若忽略，则对最佳的图像保存</span></div><div class="line"></div><div class="line">save()  <span class="comment"># 缓存保存到磁盘; 可保存一个图形对象的完整副本，并可用load()来重现该函数</span></div></pre></td></tr></table></figure>
<br>

<h3 id="图片保存"><a href="#图片保存" class="headerlink" title="图片保存"></a>图片保存</h3><p>21.5寸显示频：1920px $\times$ 1080px （比值 = 1.7777）</p>
<p>电脑显示频 -16:9 （比值 = 1.777）</p>
<p>电脑显示频 - 4:3  （比值 = 1.333）</p>
<p><strong>savePlot 的妙用（在R中的使用，非Rstudio）</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">savePlot(filename = <span class="string">"Rplot"</span>,</div><div class="line">         type = c(<span class="string">"wmf"</span>, <span class="string">"emf"</span>, <span class="string">"png"</span>, <span class="string">"jpg"</span>, <span class="string">"jpeg"</span>, <span class="string">"bmp"</span>,</div><div class="line">                  <span class="string">"tif"</span>, <span class="string">"tiff"</span>, <span class="string">"ps"</span>, <span class="string">"eps"</span>, <span class="string">"pdf"</span>),</div><div class="line">         device = dev.cur(),</div><div class="line">         restoreConsole = <span class="literal">TRUE</span>)</div><div class="line"><span class="comment"># JPEG quality is 75% ;    TIFF 无压缩。</span></div><div class="line"><span class="comment"># 所以这个命令在Rstudio上没法运行，在在R编辑器下运行成功</span></div></pre></td></tr></table></figure>
<p><strong>粘贴复制（rstudio）</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export - copy to clipboard</div><div class="line">生成图片以后，点击copy to clipboard,调整合适的大小，然后选择copy as的类型（bitmap,metafile）, 确认后，然后就可以将图片粘贴到你想要他到的地方了，得到的是矢量图(metafile)</div><div class="line"></div><div class="line"><span class="comment"># 点击 export默认的单位是像素</span></div></pre></td></tr></table></figure>
<p><strong>导出高清的图</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">tiff(filename = <span class="string">"test.tif"</span>,width = <span class="number">15</span>,height = <span class="number">18</span>,units =<span class="string">"cm"</span>,compression=<span class="string">"none"</span>,bg=<span class="string">"white"</span>,res=<span class="number">600</span>)</div><div class="line"><span class="comment"># res设置图片分辨率; units指定长宽的单位，px(oixeis,默认的)，in(inches),cm或者mm。compression为压缩方式，lzw压缩之后图片较小。可选的方式为none,rle,zlw,jpeg,zip。</span></div><div class="line"></div><div class="line"></div><div class="line">dev.new()</div><div class="line">pdf(file=<span class="string">"example.pdf"</span>, width=<span class="number">12</span>, height=<span class="number">8</span>) <span class="comment">#矢量图，pdf格式</span></div><div class="line">svg(file=<span class="string">"example.svg"</span>, width=<span class="number">12</span>, height=<span class="number">8</span>) <span class="comment">#矢量图，svg格式</span></div><div class="line">tiff(file=<span class="string">"example.tiff"</span>, width=<span class="number">12</span>, height=<span class="number">8</span>， units=<span class="string">"in"</span>, compression=<span class="string">"lzw"</span>, res=<span class="number">150</span>) <span class="comment">#位图，tiff格式，常用于文章投稿。</span></div><div class="line">dev.off()</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 默认的单位unit是英寸</span></div><div class="line">ggsave(<span class="string">"myplot.png"</span>, width=<span class="number">8</span>, height=<span class="number">8</span>, unit=<span class="string">"cm"</span>, dpi=<span class="number">300</span>)</div><div class="line"></div><div class="line"></div><div class="line">------------------------------------------------------------------------------</div><div class="line">改变字体</div><div class="line"> </div><div class="line">install.packages(<span class="string">"extrafont"</span>)</div><div class="line"><span class="keyword">library</span>(extrafont)  <span class="comment"># Find and save information about fonts installed on your system</span></div><div class="line">font_import()  <span class="comment"># List the fonts</span></div><div class="line">fonts()</div><div class="line">After the one-time setup is done, there are tasks you need to do <span class="keyword">in</span> each R session:</div><div class="line"><span class="keyword">library</span>(extrafont)  <span class="comment"># Register the fonts with R</span></div><div class="line">loadfonts()</div><div class="line"> </div><div class="line"><span class="comment"># On Windows, you may need to tell it where Ghostscript is installed</span></div><div class="line"><span class="comment"># (adjust the path to match your installation of Ghostscript)</span></div><div class="line">Sys.setenv(R_GSCMD = <span class="string">"C:/Program Files/gs/gs9.05/bin/gswin32c.exe"</span>) <span class="comment"># Finally, you can create a PDF file and embed fonts into it, as in Figure 14-4:</span></div><div class="line"><span class="keyword">library</span>(ggplot2)</div><div class="line">ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point() +</div><div class="line">    ggtitle(<span class="string">"Title text goes here"</span>) +</div><div class="line">    theme(text = element_text(size = <span class="number">16</span>, family=<span class="string">"Impact"</span>))</div><div class="line">ggsave(<span class="string">"myplot.pdf"</span>, width=<span class="number">4</span>, height=<span class="number">4</span>)</div><div class="line">embed_fonts(<span class="string">"myplot.pdf"</span>)</div></pre></td></tr></table></figure>
<h4 id="图片不清晰"><a href="#图片不清晰" class="headerlink" title="图片不清晰"></a>图片不清晰</h4><p>R中生成的图片，保存为.tiff格式，有3M，在word里还是模糊</p>
<ol>
<li>一般情况下，如果需要在word中插入图片，分为两种方法：复制黏贴与插入图片菜单。同时，由于word文档往往为表述性质使用，因此并不需要分辨率很高的图片，像我个人使用都是800*600的jpg格式,单张图片尺寸保持在100k~200k之间刚好。然后如果插入图片较多，往往会造成word文档尺寸较大，不便于使用MMS工具传输，所以会使用wrod中的图片处理工具压缩文档中的所有图片。</li>
<li>关于图片模糊，事实上在给定显示设备参数不变的状态下会有两种情况，<strong>一种是图片分辨率太低，还有一种是图片分辨率太高。</strong>解决方法是根据你最终输出的需求（出版物，电子文档等）来调整相应输出设备分辨率参数，并把其作为模版保存下来即可</li>
</ol>
<h3 id="为图形添加注释-annotate"><a href="#为图形添加注释-annotate" class="headerlink" title="为图形添加注释 - annotate"></a>为图形添加注释 - annotate</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 一次只添加一个位置上的图形</span></div><div class="line"></div><div class="line">当x/y轴均为连续型的数值变量时，当annotate中的x/y引用对象时，必须是数值，可用as.numeric()来转换</div><div class="line"><span class="comment"># peak &lt;- filter(data, var==max(var))</span></div><div class="line"><span class="comment"># peak_x &lt;- as.numeric(peak[1,1])</span></div><div class="line"><span class="comment"># peak_y &lt;- as.numeric(peak[1,2])</span></div><div class="line"></div><div class="line">p + annotate(<span class="string">"text"</span>, x = <span class="number">4</span>, y = <span class="number">25</span>, label = <span class="string">"Some text"</span>)</div><div class="line">p + annotate(<span class="string">"rect"</span>, xmin = <span class="number">3</span>, xmax = <span class="number">4.2</span>, ymin = <span class="number">12</span>, ymax = <span class="number">21</span>, alpha = <span class="number">.2</span>)</div><div class="line">p + annotate(<span class="string">"segment"</span>, x = <span class="number">2.5</span>, xend = <span class="number">4</span>, y = <span class="number">15</span>, yend = <span class="number">25</span>, colour = <span class="string">"blue"</span>)</div><div class="line">p + annotate(<span class="string">"pointrange"</span>, x = <span class="number">3.5</span>, y = <span class="number">20</span>, ymin = <span class="number">12</span>, ymax = <span class="number">28</span>,colour = <span class="string">"red"</span>, size = <span class="number">1.5</span>)</div></pre></td></tr></table></figure>
<h3 id="项目排序顺序"><a href="#项目排序顺序" class="headerlink" title="项目排序顺序"></a>项目排序顺序</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">先设置好顺序 - factor</div><div class="line"></div><div class="line">按当前排序来指定顺序</div><div class="line"><span class="comment"># data$col &lt;- factor(data$col, levles=data$col, order=TRUE)</span></div><div class="line"><span class="comment">## arrange(data, col)  升序排列</span></div><div class="line">自定义顺序</div><div class="line"><span class="comment"># data$col &lt;- factor(data$col, levels=c("col1","col2"),order=TRUE)</span></div><div class="line"></div><div class="line"></div><div class="line">----------------------------------------------------------------------------------</div><div class="line">标度变换</div><div class="line"><span class="comment"># scale_x_discrete(limits=c("col","col")</span></div><div class="line"><span class="comment"># scale_x_discrete(limits=data$col)</span></div></pre></td></tr></table></figure>
<h3 id="遮盖问题"><a href="#遮盖问题" class="headerlink" title="遮盖问题"></a>遮盖问题</h3><ul>
<li><strong>图形相互覆盖无法看清</strong></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">点的大小与形状 </div><div class="line"><span class="comment"># geom_xxx(shape=)</span></div><div class="line"><span class="comment">## shape=1(中空的点)</span></div><div class="line"><span class="comment">## shape="." (像素大小的点)</span></div><div class="line"></div><div class="line">透明度；最小透明度为<span class="number">1</span>/<span class="number">256</span></div><div class="line"><span class="comment"># geom_xxx( alpha = [1/256 ,1] )</span></div><div class="line"></div><div class="line">添加随机扰动 - jitter ；[当数据存在一定离散性]</div><div class="line"><span class="comment"># td &lt;- ggplot(diamonds, aes(table,depth)) + xlim(50,70) + ylim(50,70)</span></div><div class="line"><span class="comment">## 直接添加 - td +geom_point ;     td + geom_jitter()  # 默认扰动量为40%</span></div><div class="line"><span class="comment">## 调整后变更扰动率 - jit &lt;- positon_jitter(width=0.5);    td +geom_jitter(position=jit)</span></div><div class="line"></div><div class="line">将点分箱，并统计每个箱中点的数量，在可视化这个数量</div><div class="line"><span class="comment"># d &lt;- ggplot(diamonds, aes(carat,price)) + xlim(1,3)  # 此时并无图形显示</span></div><div class="line"><span class="comment"># d + stat_binhex()  # 默认分箱数 # 即使没有几何对象也能做出图形</span></div><div class="line"><span class="comment"># d + stat_binhex(bins=10)  # 共10个封箱 # 默认为30个</span></div><div class="line"></div><div class="line">用stat_density2d做二维密度估计，并将等高线添加到散点图中</div></pre></td></tr></table></figure>
<h3 id="含权重数据"><a href="#含权重数据" class="headerlink" title="含权重数据"></a>含权重数据</h3><ul>
<li><p><strong>点/线 - size = 权重变量</strong></p>
</li>
<li><p><strong>复杂情况 - weight = 权重变量</strong></p>
<p>​</p>
</li>
</ul>
<h3 id="交互式作图-ggplotly"><a href="#交互式作图-ggplotly" class="headerlink" title="交互式作图 - ggplotly"></a>交互式作图 - ggplotly</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(plotly)</div><div class="line">ggplotly(object)</div></pre></td></tr></table></figure>
<h3 id="统计摘要：为统计量绘图"><a href="#统计摘要：为统计量绘图" class="headerlink" title="统计摘要：为统计量绘图"></a>统计摘要：为统计量绘图</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">单独的摘要计算函数</div><div class="line"><span class="comment"># fun.y / fun.ymin / fun.ymax</span></div><div class="line"></div><div class="line">统一的摘要统计函数</div><div class="line"><span class="comment"># fun.data</span></div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/软件应用/" rel="tag"># 软件应用</a>
          
            <a href="/tags/程序编程/" rel="tag"># 程序编程</a>
          
            <a href="/tags/r/" rel="tag"># r</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/27/软件应用_程序编程/R/ggplot2/R语言_ggplot2/" rel="next" title="R语言_ggplot2">
                <i class="fa fa-chevron-left"></i> R语言_ggplot2
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/28/软件应用_程序编程/Regular-expression/正则表达式/" rel="prev" title="正则表达式">
                正则表达式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
  <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODMzNi80OTA4"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jimmy_Cai" />
          <p class="site-author-name" itemprop="name">Jimmy_Cai</p>
          <p class="site-description motion-element" itemprop="description">向死而生。做一个有品质的单身汪。</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">128</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/1998962ab991" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/jerry-cai-35/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/chf2012" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/facelife2012/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据结构"><span class="nav-number">1.</span> <span class="nav-text">数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-绘图对象-数据-图形属性-aes"><span class="nav-number">2.</span> <span class="nav-text">1. 绘图对象(数据+图形属性[aes])</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据"><span class="nav-number">2.1.</span> <span class="nav-text">数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图形属性-aes"><span class="nav-number">2.2.</span> <span class="nav-text">图形属性-aes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分组"><span class="nav-number">2.2.1.</span> <span class="nav-text">分组</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-图层-几何对象"><span class="nav-number">3.</span> <span class="nav-text">2. 图层(几何对象)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设定"><span class="nav-number">3.1.</span> <span class="nav-text">设定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#映射"><span class="nav-number">3.2.</span> <span class="nav-text">映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-图层-统计变换-位置调整"><span class="nav-number">4.</span> <span class="nav-text">3. 图层(统计变换+位置调整)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#统计变化-stat-xx"><span class="nav-number">4.1.</span> <span class="nav-text">统计变化 - stat_xx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-标度变换-scale"><span class="nav-number">5.</span> <span class="nav-text">4. 标度变换(scale)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#位置标度-坐标轴"><span class="nav-number">5.1.</span> <span class="nav-text">位置标度 - 坐标轴</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴标签名称"><span class="nav-number">5.1.1.</span> <span class="nav-text">坐标轴标签名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#坐标轴刻度范围"><span class="nav-number">5.1.2.</span> <span class="nav-text">坐标轴刻度范围</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#刻度值的分段显示-转换"><span class="nav-number">5.1.3.</span> <span class="nav-text">刻度值的分段显示 + 转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#刻度值的变换"><span class="nav-number">5.1.4.</span> <span class="nav-text">刻度值的变换 </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#颜色标度"><span class="nav-number">5.2.</span> <span class="nav-text">颜色标度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#离散型的手动标度"><span class="nav-number">5.3.</span> <span class="nav-text">离散型的手动标度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图例标度-guides"><span class="nav-number">5.4.</span> <span class="nav-text">图例标度 - guides</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-分面-facet"><span class="nav-number">6.</span> <span class="nav-text">5. 分面(facet)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网格型"><span class="nav-number">6.1.</span> <span class="nav-text">网格型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装型"><span class="nav-number">6.2.</span> <span class="nav-text">封装型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#封装型-标度控制"><span class="nav-number">6.2.1.</span> <span class="nav-text">封装型 - 标度控制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分面的标签控制"><span class="nav-number">6.3.</span> <span class="nav-text">分面的标签控制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-坐标系-coord"><span class="nav-number">7.</span> <span class="nav-text">6. 坐标系(coord)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#笛卡尔坐标-cartesian"><span class="nav-number">7.1.</span> <span class="nav-text">笛卡尔坐标 -  cartesian() </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非笛卡尔坐标"><span class="nav-number">7.2.</span> <span class="nav-text">非笛卡尔坐标</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-主题-theme"><span class="nav-number">8.</span> <span class="nav-text">7. 主题(theme)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主题与设置"><span class="nav-number">8.1.</span> <span class="nav-text">主题与设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主题元素-元素函数"><span class="nav-number">8.2.</span> <span class="nav-text">主题元素+元素函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#主题元素"><span class="nav-number">8.2.1.</span> <span class="nav-text">主题元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元素函数"><span class="nav-number">8.2.2.</span> <span class="nav-text">元素函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一页多图"><span class="nav-number">8.3.</span> <span class="nav-text">一页多图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#组图"><span class="nav-number">8.3.1.</span> <span class="nav-text">组图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子图-viewport-print"><span class="nav-number">8.3.2.</span> <span class="nav-text">子图 - viewport()+print</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性参考"><span class="nav-number">9.</span> <span class="nav-text">属性参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#几何对象-点-geom-xx"><span class="nav-number">9.1.</span> <span class="nav-text">几何对象 - 点 - geom_xx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#point-散点图"><span class="nav-number">9.1.1.</span> <span class="nav-text">point - 散点图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#几何对象-线"><span class="nav-number">9.2.</span> <span class="nav-text">几何对象 - 线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#几何对象-面"><span class="nav-number">9.3.</span> <span class="nav-text">几何对象 - 面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bar-条形图"><span class="nav-number">9.3.1.</span> <span class="nav-text">bar - 条形图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#histogram-直方图"><span class="nav-number">9.3.2.</span> <span class="nav-text">histogram - 直方图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他面图"><span class="nav-number">9.3.3.</span> <span class="nav-text">其他面图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#几何对象-非常规图形"><span class="nav-number">9.4.</span> <span class="nav-text">几何对象 - 非常规图形</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#漏斗图"><span class="nav-number">9.4.1.</span> <span class="nav-text">漏斗图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他图形"><span class="nav-number">9.4.2.</span> <span class="nav-text">其他图形</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#text-文本注释"><span class="nav-number">9.5.</span> <span class="nav-text">text - 文本注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图形属性"><span class="nav-number">9.6.</span> <span class="nav-text">图形属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#linetype"><span class="nav-number">9.6.1.</span> <span class="nav-text">linetype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#position"><span class="nav-number">9.6.2.</span> <span class="nav-text">position</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#side"><span class="nav-number">9.6.3.</span> <span class="nav-text">side</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shape"><span class="nav-number">9.6.4.</span> <span class="nav-text">shape</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fontface"><span class="nav-number">9.6.5.</span> <span class="nav-text">fontface</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#统计变换"><span class="nav-number">9.7.</span> <span class="nav-text">统计变换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#作图规范"><span class="nav-number">10.</span> <span class="nav-text">作图规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#作图问题"><span class="nav-number">11.</span> <span class="nav-text">作图问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#图形基本处理"><span class="nav-number">11.1.</span> <span class="nav-text">图形基本处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片保存"><span class="nav-number">11.2.</span> <span class="nav-text">图片保存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#图片不清晰"><span class="nav-number">11.2.1.</span> <span class="nav-text">图片不清晰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为图形添加注释-annotate"><span class="nav-number">11.3.</span> <span class="nav-text">为图形添加注释 - annotate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目排序顺序"><span class="nav-number">11.4.</span> <span class="nav-text">项目排序顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遮盖问题"><span class="nav-number">11.5.</span> <span class="nav-text">遮盖问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#含权重数据"><span class="nav-number">11.6.</span> <span class="nav-text">含权重数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#交互式作图-ggplotly"><span class="nav-number">11.7.</span> <span class="nav-text">交互式作图 - ggplotly</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#统计摘要：为统计量绘图"><span class="nav-number">11.8.</span> <span class="nav-text">统计摘要：为统计量绘图</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jimmy_Cai</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("JjHJaD5nSfH7Snv1iJOyYCXJ-gzGzoHsz", "LoREb7wzyOhQIbmS4skuPfxv");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
